// abc2svg - ABC to SVG translator
// @source: https://chiselapp.com/user/moinejf/repository/abc2svg
// Copyright (C) 2014-2019 Jean-Francois Moine - LGPL3+
// commit [cb89c2bb23]
var abc2svg={C:{BLEN:1536,BAR:0,CLEF:1,CUSTOS:2,GRACE:4,KEY:5,METER:6,MREST:7,NOTE:8,PART:9,REST:10,SPACE:11,STAVES:12,STBRK:13,TEMPO:14,BLOCK:16,REMARK:17,FULL:0,EMPTY:1,OVAL:2,OVALBARS:3,SQUARE:4,SL_ABOVE:1,SL_BELOW:2,SL_AUTO:3,SL_HIDDEN:4,SL_DOTTED:8},Abc:function(w){function A(a,c){if(!a)return a;var b=new a.constructor,d;for(d in a)a.hasOwnProperty(d)&&(b[d]=c&&"object"==typeof a[d]?A(a[d],c-1):a[d]);return b}function fa(a,c,b,d){var e,f,g;if(w.errbld){switch(a){case 0:a="warn";break;case 1:a=
"error";break;default:a="fatal"}w.errbld(a,c,b,d)}else{if(void 0!=d&&0<=d){for(e=g=0;;){f=l.file.indexOf("\n",e);if(0>f||f>d)break;g++;e=f+1}e=d-e}d="";b&&(d=b,g&&(d+=":"+(g+1)+":"+(e+1)),d+=" ");switch(a){case 0:d+="Warning: ";break;case 1:d+="Error: ";break;default:d+="Internal bug: "}w.errmsg(d+c,g,e)}}function J(a,c,b,d,e,f,g){var m;w.textrans&&(m=w.textrans[b])&&(b=m);3<arguments.length&&(b=b.replace(/\$./g,function(a){switch(a){case "$1":return d;case "$2":return e;case "$3":return f;default:return g}}));
c&&c.fname?fa(a,b,c.fname,c.istart):fa(a,b)}function qa(){this.index=0;qa.prototype["char"]=function(){return this.buffer[this.index]};qa.prototype.next_char=function(){return this.buffer[++this.index]};qa.prototype.get_int=function(){for(var a=0,c=this.buffer[this.index];"0"<=c&&"9">=c;)a=10*a+Number(c),c=this.next_char();return a}}function p(a,c,b,d,e,f){J(a,{fname:l.fname,istart:l.istart+l.line.index},c,b,d,e,f)}function ta(a){/eval *\(|Function|setTimeout|setInterval/.test(a)?p(1,"Unsecure code"):
eval('"use strict"\n'+a)}function T(a,c,b,d){a=u[a];var e=b/Aa*256|0;b=(b+d)/Aa*256|0;0>e&&(e=0);256<=b&&(b=255,e>b&&(e=b));if(c)for(c=a.top[e++];e<=b;)c<a.top[e]&&(c=a.top[e]),e++;else for(c=a.bot[e++];e<=b;)c>a.bot[e]&&(c=a.bot[e]),e++;return c}function Q(a,c,b,d,e){a=u[a];var f=b/Aa*256|0;b=(b+d)/Aa*256|0;0>f&&(f=0);256<=b&&(b=255,f>b&&(f=b));if(c)for(;f<=b;)a.top[f]<e&&(a.top[f]=e),f++;else for(;f<=b;)a.bot[f]>e&&(a.bot[f]=e),f++}function nd(a,c){switch(c){case h.SL_ABOVE:return!0;case h.SL_BELOW:return!1}return a.multi&&
0!=a.multi?0<a.multi:a.p_v.have_ly?a.pos.voc!=h.SL_ABOVE:!1}function Uc(a){if(!a.ldst){var c,b,d,e,f,g=a.s;e=a.start;c=e.s;b=c.x+3;e=e.ix;0<e&&(f=oa[e-1]);a.st=g.st;a.lden=!1;a.has_val=!0;if(e=nd(g,g.pos.dyn))a.up=!0;f&&f.s==c&&(a.up&&!f.up||!a.up&&f.up)&&(d=f.dd,od[d.func]&&(f=f.x+f.val+4,f>b&&(b=f)));a.defl.noen?(c=a.x-b,20>c&&(b=a.x-20-3,c=20)):(f=g.x,(g=oa[a.ix+1])&&g.s==c&&(a.up&&!g.up||!a.up&&g.up)&&(d=g.dd,od[d.func]&&(f-=5)),c=f-b-4,20>c&&(b-=.5*(20-c),c=20));a.val=c;a.x=b;a.y=T(a.st,e,b,
c);e||(b=a.dd,a.y-=b.h)}}function Gc(a){if(!a.ldst){var c,b,d,e,f=a.dd,g=a.s,m=g.st,q=a.start.s,n=q.x;a.prev&&(n=a.prev.x+10,b=a.prev.y);a.st=m;if(4!=f.func)switch(f.glyph){case "8va":case "15ma":c=1;break;default:c=0<=g.multi}a.defl.noen?(d=a.x-n,20>d&&(n=a.x-20-3,d=20)):(d=g.x-n-6,g.type==h.NOTE&&(d-=6),20>d&&(n-=.5*(20-d),d=20));f=a.dd;b||(b=T(m,c,n,d));c?(e=u[q.st].topbar+2,b<e&&(b=e)):(b-=f.h,e=u[q.st].botbar-2,b>e&&(b=e));a.lden=!1;a.has_val=!0;a.val=d;a.x=n;a.y=b;c&&(b+=f.h);Q(m,c,n,d,b);c?
q.ymx=g.ymx=b:q.ymn=g.ymn=b}}function Ie(a){if(!a.ldst)if(a.start)Gc(a);else{var c,b,d=a.s,e=a.dd,f=d.x,g=e.wl+e.wr,m=u[d.st].topbar+2,q=u[d.st].botbar-2;d.nhd&&(f+=d.notes[0<=d.stem?0:d.nhd].shhd);c=-1;if(4==e.func)c=0;else if(d.pos)switch(d.pos.orn){case h.SL_ABOVE:c=1;break;case h.SL_BELOW:c=0}switch(e.glyph){case "accent":case "roll":!c||0>c&&(0>d.multi||!d.multi&&0<d.stem)?(c=T(d.st,!1,d.x-e.wl,g)-2,c>q&&(c=q),c-=e.h,Q(d.st,!1,d.x,0,c),b=!0,d.ymn=c):(c=T(d.st,!0,d.x-e.wl,g)+2,c<m&&(c=m),Q(d.st,
!0,d.x-e.wl,g,c+e.h),d.ymx=c+e.h);break;case "brth":case "lphr":case "mphr":case "sphr":c=m+1;"brth"==e.glyph&&c<d.ymx&&(c=d.ymx);for(d=d.ts_next;d&&!d.seqst;d=d.ts_next);f+=.45*((d?d.x:Aa)-f);break;default:0==e.name.indexOf("invert")&&(b=!0),"invertedfermata"!=e.name&&(0<c||0>c&&0<=d.multi)?(c=T(d.st,!0,d.x-e.wl,g)+2,c<m&&(c=m),Q(d.st,!0,d.x-e.wl,g,c+e.h),d.ymx=c+e.h):(c=T(d.st,!1,d.x-e.wl,g)-2,c>q&&(c=q),c-=e.h,Q(d.st,!1,d.x-e.wl,g,c),"fermata"==e.name&&(b=!0),d.ymn=c)}b&&(c+=e.h,a.inv=!0);a.x=
f;a.y=c}}function re(a){var c,b,d;if(d=pd[a])if(c=d.match(/(\d+)\s+(.+?)\s+([0-9.]+)\s+([0-9.]+)\s+([0-9.]+)/)){var e=Number(c[1]),f=parseFloat(c[3]),g=parseFloat(c[4]),m=parseFloat(c[5]);if(isNaN(e))J(1,null,"%%deco: bad C function value '$1'",c[1]);else if((0>e||10<e)&&(32>e||41<e))J(1,null,"%%deco: bad C function index '$1'",e);else if(5==e&&(e=3),7==e&&(e=6),0>f||0>g||0>m)J(1,null,"%%deco: cannot have a negative value '$1'",d);else if(50<f||80<g||80<m)J(1,null,"%%deco: abnormal h/wl/wr value '$1'",
d);else{b=sc[a];b||(b={name:a},sc[a]=b);b.func=0==b.name.indexOf("head-")?9:e;b.glyph=c[2];b.h=f;b.wl=g;b.wr=m;if(a=d.replace(c[0],"").trim())'"'==a[0]&&(a=a.slice(1,-1)),b.str=a;6==b.func&&void 0==b.str&&(b.str=b.name);d=b.name.slice(-1);if("("==d||")"==d&&0>b.name.indexOf("("))if(b.str=null,c=b.name.slice(0,-1)+("("==d?")":"("),a=sc[c])"("==d?(b.dd_en=a,a.dd_st=b):(b.dd_st=a,a.dd_en=b);else if(a=re(c),!a)return;return b}}else J(1,null,"Invalid decoration '$1'",a);else t.decoerr&&J(1,null,"Unknown decoration '$1'",
a)}function tc(a,c,b){var d,e,f,g,m=a.length;for(d=0;d<m;d++){e=a[d];f=sc[e];if(!f&&(f=re(e),!f))continue;switch(f.func){case 0:if(c.type==h.BAR&&"dot"==f.name){c.bar_dotted=!0;break}case 1:case 2:if(!c.notes){J(1,c,N.must_note_rest,f.name);continue}break;case 8:if(c.type!=h.NOTE){J(1,c,N.must_note,f.name);continue}g=c.notes[c.nhd];g.a_dcn||(g.a_dcn=[]);g.a_dcn.push(f.name);continue;case 9:if(!c.notes){J(1,c,N.must_note_rest,f.name);continue}for(e=0;e<=c.nhd;e++)g=c.notes[e],g.a_dcn||(g.a_dcn=[]),
g.a_dcn.push(f.name);continue;case 10:if(c.notes)for(e=0;e<=c.nhd;e++)c.notes[e].color=f.name;else c.color=f.name;continue;case 32:c.invis=!0;continue;case 33:if(c.type!=h.BAR){J(1,c,"!beamon! must be on a bar");continue}c.beam_on=!0;continue;case 34:if(c.type!=h.NOTE||!b||b.type!=h.NOTE||c.dur!=b.dur){J(1,c,"!$1! must be on the last of a couple of notes",f.name);continue}c.trem2=!0;c.beam_end=!0;c.beam_st=!1;b.beam_st=!0;b.beam_end=!1;c.ntrem=b.ntrem=Number(f.name[4]);for(e=0;e<=c.nhd;e++)c.notes[e].dur*=
2;for(e=0;e<=b.nhd;e++)b.notes[e].dur*=2;continue;case 35:if(c.type!=h.NOTE){J(1,c,"!xstem! must be on a note");continue}c.xstem=!0;continue;case 36:if(c.type!=h.NOTE){J(1,c,N.must_note,f.name);continue}"1"==f.name[6]?c.beam_br1=!0:c.beam_br2=!0;continue;case 37:c.rbstop=1;continue;case 38:if(c.type!=h.NOTE){J(1,c,N.must_note,f.name);continue}c.trem1=!0;c.ntrem=f.name.length;continue;case 39:if(c.type!=h.NOTE){J(1,c,N.must_note,f.name);continue}c.feathered_beam="a"==f.name[5]?1:-1;continue;case 40:c.stemless=
!0;continue;case 41:c.rbstop=2;continue}c.a_dd||(c.a_dd=[]);c.a_dd.push(f)}}function qd(a){var c,b,d=0,e=a.a_dd,f=e.length;for(b=0;b<f;b++)switch(c=e[b],c.func){case 1:7>d&&(d=7);break;case 2:14>d&&(d=14);break;case 3:switch(c.glyph){case "brth":case "lphr":case "mphr":case "sphr":20>a.wr&&(a.wr=20)}}0!=d&&a.prev&&a.prev.type==h.BAR&&(d-=3);return d}function Ng(){function a(a){var b,c=a.x-a.wl,d=oa.length;for(a=0;a<d;a++)b=oa[a],b.ix=a,b.s.x=b.x=c,b.defl.nost=!0}function c(a){var b;if(a.a_dd){var c,
d,e=a.a_dd.length;for(c=0;c<e;c++){b=a.a_dd[c];switch(b.func){default:d=0;break;case 3:case 4:d=a.pos.orn;break;case 6:d=a.pos.vol;break;case 7:d=a.pos.dyn}if(d!=h.SL_HIDDEN&&(d={s:a,dd:b,st:a.st,ix:oa.length,defl:{},x:a.x,y:a.y},oa.push(d),b.dd_en?d.ldst=!0:b.dd_st&&(d.lden=!0,d.defl.nost=!0),Og[b.func]))hf[b.func](d)}}if(a.notes)for(b=0;b<a.notes.length;b++)if(a.notes[b].a_dcn){var n;d=a;for(var B=b,r=d.notes[B],v=r.a_dcn.length,e=0;e<v;e++){n=r.a_dcn[e];c=sc[n];if(!c&&(c=re(n),!c))continue;switch(c.func){case 0:case 1:case 3:case 4:case 8:break;
default:J(1,null,"Cannot have !$1! on a head",c.name);continue;case 9:r.invis=!0;break;case 10:r.color=c.name;continue;case 32:r.invis=!0;continue;case 40:d.stemless=!0;continue}n={s:d,dd:c,st:d.st,m:B,ix:0,defl:{},x:d.x,y:3*(r.pit-18)};oa.push(n);c.dd_en?n.ldst=!0:c.dd_st&&(n.lden=!0,n.defl.nost=!0)}}}var b,d;for(b=V;b;b=b.ts_next){switch(b.type){case h.CLEF:case h.KEY:case h.METER:continue}break}for(0!=oa.length&&a(b);b;b=b.ts_next){switch(b.type){case h.BAR:case h.MREST:case h.NOTE:case h.REST:case h.SPACE:break;
case h.GRACE:for(d=b.extra;d;d=d.next)c(d);default:continue}c(b)}(function(){var a,b,c,d,h,n,B,r,v=oa.length;for(a=0;a<v;a++)if(c=oa[a],c.ldst){h=c.dd;n=h.dd_en;r=c.s;B=r.v;for(b=a+1;b<v&&(d=oa[b],d.start||d.dd!=n||d.s.v!=B);b++);if(b==v)for(B=r.st,b=a+1;b<v&&(d=oa[b],d.start||d.dd!=n||d.s.st!=B);b++);b==v&&(d={s:c.s,st:c.st,dd:n,ix:oa.length-1,x:Aa-6,y:c.s.y,lden:!0,defl:{noen:!0}},d.x<r.x+10&&(d.x=r.x+10),void 0!=c.m&&(d.m=c.m),oa.push(d));d.start=c;d.defl.nost=c.defl.nost;"trill("==h.name&&0<a&&
"trill"==oa[a-1].dd.name&&(d.prev=oa[a-1])}for(a=0;a<v;a++)d=oa[a],d.lden&&!d.start&&(r=d.s,c={s:uf(r),st:d.st,dd:d.dd.dd_st,ix:oa.length-1,y:r.y,ldst:!0},c.x=c.s.x,void 0!=d.m&&(c.m=d.m),oa.push(c),d.start=c)})()}function vf(a,c,b,d,e){var f=Je(a,d);a=f[0];var g=f[1],f=f[2];W('<g transform="translate(X,Y) scale(F)">\n',c+4,b+4,e);switch(a){case h.OVAL:c="HD";break;case h.EMPTY:c="Hd";break;default:c="hd"}ca(-ic,ra,c);c=4;if(g){b=9;0<f&&(b+=4);switch(a){case h.SQUARE:b+=3;break;case h.OVALBARS:case h.OVAL:b+=
2;break;case h.EMPTY:b+=1}c=b*g;for(b-=ic;0<=--g;)ca(b,ra,"dot"),b+=3.5}d<h.BLEN&&(0>=f?Vc(-ic,ra,21):(Vc(-ic,ra,21,!1,f),6>c&&(c=6)));z+="</g>\n";return(c+15)*e}function wf(a){var c=0;a.tempo_wh1&&(c=a.tempo_wh1[0]);a.tempo_wh0&&(c+=a.tempo_wh0[0]);a.tempo_wh2&&(c+=a.tempo_wh2[0]);return c}function xf(a,c,b){var d,e,f=.7*D.curfont.size/12;pa("tempo");D.curfont.box&&(D.curfont.box=!1,e=c);a.tempo_str1&&(la(c,b,a.tempo_str1,null,null,a.tempo_wh1),c+=a.tempo_wh1[0]+3);if(a.tempo_notes){for(d=0;d<a.tempo_notes.length;d++)c+=
vf(a,c,b,a.tempo_notes[d],f);la(c,b,a.tempo_str0,null,null,a.tempo_wh0);c+=a.tempo_wh0[0];c=a.tempo?c+5:c+vf(a,c,b,a.new_beat,f)}a.tempo_str2&&la(c,b,a.tempo_str2,null,null,a.tempo_wh2);e&&(D.curfont.box=!0,a.tempo_str2&&(c+=a.tempo_wh2[0]+3),d=D.curfont.size+4,z+='<rect class="stroke" x="',kb(e-2,'" y="',b+d-1),z+='" width="'+(c-e+2).toFixed(1)+'" height="'+d.toFixed(1)+'"/>\n');a.del=!0}function Pg(a,c,b,d){function e(a){return 6*Math.round((a+12)/6)-12-a}var f=a?3.5:5;a=a?1.8:3.2;if(0<c){c=d-(b-
1)*f-a;if(26<c)return 0;b=d}else{b=d+(b-1)*f+a;if(-2>b)return 0;c=d}d=e(b-.25);c=e(c+.25);return d*d>c*c?c:d}function yf(a){var c,b,d=A(a);d.invis=!0;delete d.extra;delete d.text;delete d.a_gch;delete d.a_ly;delete d.a_dd;d.notes=A(a.notes);for(c=0;c<=d.nhd;c++)b=d.notes[c]=A(a.notes[c]),delete b.a_dcn;return d}function zf(a){function c(a,b,c,d,e,f){var g=e.s1,m=g.nflags;g.ntrem&&(m-=g.ntrem);g.trem2&&f>m&&(g.dur>=h.BLEN/2?(a=g.x+6,b=e.s2.x-6):g.dur<h.BLEN/4&&(a+=5,b-=6));c=e.a*a+e.b-c;b=(b-a)/C.scale;
e=e.a*b*C.scale;Xd(a,c,!0);z+="l"+b.toFixed(1)+" "+(-e).toFixed(1)+"v"+d.toFixed(1)+"l"+(-b).toFixed(1)+" "+e.toFixed(1)+'z"/>\n'}var b,d,e,f,g,m,q,n,B,r,v,k,t=a.s1,l=a.s2;qb(t,"beam");t.grace?(g=3.5,m=3.2,f=.29,q=1.8):(g=5,m=8,f=.34,q=3.2);e=t.stem;t.stem!=l.stem&&t.nflags<l.nflags&&(e=l.stem);0>e&&(q=-q);c(t.xs-f,l.xs+f,0,q,a,1);n=0;for(b=t;b.type==h.NOTE&&b.stem!=e&&(b.ys=a.a*b.xs+a.b-u[b.st].y+g*(b.nflags-1)*b.stem-q),b!=l;b=b.next);t.feathered_beam&&(n=g/(l.xs-t.xs),0<t.feathered_beam?(n=-n,
g=n*t.xs):g=n*l.xs,n*=e);f=0;for(d=2;d<=a.nflags;d++)for(f+=g,0!=n&&(a.a+=n),b=t;;b=b.next){if(!(b.type!=h.NOTE||b.nflags<d))if(b.trem1&&d>b.nflags-b.ntrem)k=b.dur>=h.BLEN/2?b.x:b.xs,c(k-5,k+5,(f+2.5)*e,q,a,d);else{for(r=b;b!=l;){B=b.next;if(B.type==h.NOTE||B.type==h.REST)if(B.trem1){if(B.nflags-B.ntrem<d)break}else if(B.nflags<d)break;if(B.beam_br1||B.beam_br2&&2<d)break;b=B}for(v=b;v.type!=h.NOTE;)v=v.prev;k=r.xs;if(r==v)if(r==t)k+=m;else if(r==l)k-=m;else if(r.beam_br1||r.beam_br2&&2<d)k+=m;else{for(B=
r.next;B.type!=h.NOTE;)B=B.next;if(B.beam_br1||B.beam_br2&&2<d)k-=m;else{for(r=r.prev;r.type!=h.NOTE;)r=r.prev;k=r.nflags<B.nflags||r.nflags==B.nflags&&r.dots<B.dots?k+m:k-m}}c(k,v.xs,f*e,q,a,d)}if(b==l)break}t.tmp?lb(t):l.tmp&&lb(l);zb(t,"beam")}function Af(a){function c(a,b,c){for(var d,e;!E.st_print[b];){if(E.staves[b].flags&c)return;b++}for(d=e=b;;){E.st_print[d]&&(e=d);if(E.staves[d].flags&c)break;d++}b=u[b].y+u[b].topbar*u[b].staffscale;e=u[e].y+u[e].botbar*u[e].staffscale;c&514?(a+=ic-6,c=
ra-e,b=(b-e)/24,z+='<text transform="translate('+a.toFixed(1)+","+c.toFixed(1)+") scale(2.5,"+b.toFixed(2)+')">'+te.brace.c+"</text>\n"):(a+=ic-5,c=ra-b-3,b=b-e+2,z+='<path d="m'+a.toFixed(1)+" "+c.toFixed(1)+"\n\tc10.5 1 12 -4.5 12 -3.5c0 1 -3.5 5.5 -8.5 5.5\n\tv"+b.toFixed(1)+'\n\tc5 0 8.5 4.5 8.5 5.5c0 1 -1.5 -4.5 -12 -3.5"/>\n')}var b,d,e=E.nstaff,f=0;for(b=0;;b++){E.staves[b].flags&5&&f++;if(E.st_print[b])break;E.staves[b].flags&10&&f--;if(b==e)break}for(d=e;d>b&&!E.st_print[d];d--);if(b!=d||
0!=f)for(d=u[d].y+u[d].botbar*u[d].staffscale,b=u[b].y+u[b].topbar*u[b].staffscale-d,Xd(a,d),z+="v"+(-b).toFixed(1)+'"/>\n',b=0;b<=e;b++)E.staves[b].flags&1&&c(a,b,2),E.staves[b].flags&4&&c(a,b,8),E.staves[b].flags&256&&c(a-6,b,512),E.staves[b].flags&1024&&c(a-6,b,2048)}function Yd(a,c,b,d,e){if(d)if(d==e)b=-1==b?-2:2;else if(2*d!=e){ca(a,c,"acc"+b+"_"+d+"_"+e);return}ca(a,c,"acc"+b)}function Bf(a,c,b,d,e){var f,g;f=u[d];d=f.y;var m=f.stafflines,h=6*(m.length-1),n=f.botline;if(/[\[|]/.test(m)){c%
6&&(c+=3);b%6&&(b-=3);if(0<=m.indexOf("-")&&(c>n&&c<h||b>n&&b<h||c<=n&&b>=h)){f=c;for(g=b;f>n&&"-"==m[f/6];)f-=6;for(;g<h&&"-"==m[g/6];)g+=6;for(;f<g;f+=6)"-"==m[f/6]&&ca(a,d+f,e)}for(;c<n;c+=6)ca(a,d+c,e);for(;b>h;b-=6)ca(a,d+b,e)}}function Qg(a){switch(a){case "[":case "[]":return"";case "|:":case "|::":case "|:::":return"["+a;case ":|":case "::|":case ":::|":return a+"]";case "::":return t.dblrepbar}return a}function Hc(a,c){var b,d,e,f,g,m=Array(a.nhd+1);if(a.dots){for(g=0;g<=a.nhd;g++)d=3*(a.notes[g].pit-
18),0==d%6&&(d=a.dot_low?d-3:d+3),m[g]=d;for(g=0;g<a.nhd;g++)if(!(m[g+1]>m[g])){for(d=g;0<d&&!(m[d]>m[d-1]+6);)d--;if(3*(a.notes[d].pit-18)-m[d]<m[g+1]-3*(a.notes[g+1].pit-18))for(;d<=g;)m[d++]-=6;else m[g+1]=m[g]+6}}e=a.notes[0>a.stem?a.nhd:0];b=g=a.x+e.shhd*C.scale;d=u[a.st].y;if(a.grace)f="ghl";else switch(f="hl",a.head){case h.OVALBARS:case h.OVAL:b=g-.3;f="hl1";break;case h.SQUARE:b=g-2,f="hl1"}Bf(b,3*(a.notes[0].pit-18),3*(a.notes[a.nhd].pit-18),a.st,f);e=u[a.st].y+3*(e.pit-18);a.stemless?a.xstem&&
(b=a.ts_prev,f=(0<b.stem?b.y:b.ys)-a.y,f+=u[b.st].y-d,f/=a.p_v.scale,Vc(g,e,f)):(f=a.ys-a.y,b=a.nflags,a.ntrem&&(b-=a.ntrem),!c||0>=b?(0<a.nflags&&(f=0<=a.stem?f-1:f+1),Vc(g,e,f,a.grace)):Vc(g,e,f,a.grace,b,t.straightflags));if(c&&a.trem1){e=a.ntrem||0;f=3*(a.notes[0<a.stem?a.nhd:0].pit-18);a.head==h.FULL||a.head==h.EMPTY?(g+=(a.grace?Wc:3.5)*a.stem,f=0<a.stem?f+(6+5.4*e):f-11.4):f=0<a.stem?f+(5+5.4*e):f-10.4;f/=a.p_v.scale;for(W('<path d="mX Y\n\t',g-4.5,d+f);;){z+="l9 -3v3l-9 3z";if(0>=--e)break;
z+="m0 5.4"}z+='"/>\n'}g=a.x;for(d=0;d<=a.nhd;d++){var q=void 0,n,B,r=void 0,v;f=g;e=a;n=d;var k=m;b=!1;var l=e.notes[n],p=u[e.st].y,y=3*(l.pit-18);B=l.shhd*C.scale;var x=f+B,Ke=y+p,se=Je(e,l.dur);v=se[0];var w=se[1],se=se[2];0==y%6&&B!=(0<e.stem?e.notes[0].shhd:e.notes[e.nhd].shhd)&&(B=0,30<=y?(B=y,B%6&&(B-=3)):-6>=y&&(B=y,B%6&&(B+=3)),B&&ca(x,B+p,"hl"));if(!l.invis)if(e.grace)r="ghd",x-=4.5*C.scale;else if(l.map&&l.map[0])v=e.head,(r=l.map[0][v])||(r=l.map[0][l.map[0].length-1]),v=r.indexOf("/"),
0<=v&&(r=0<=e.stem?r.slice(0,v):r.slice(v+1));else if(e.type==h.CUSTOS)r="custos";else switch(v){case h.OVAL:r="HD";break;case h.OVALBARS:if(e.head!=h.SQUARE){r="HDD";break}case h.SQUARE:-4<se?r="breve":(r="longa",q=0<e.stem);Sb||!e.next||e.next.type!=h.BAR||e.next.next||(w=0);break;case h.EMPTY:r="Hd";break;default:r="hd"}void 0!=l.color?b=uc(l.color):l.map&&l.map[2]&&(b=uc(l.map[2]));r&&(q&&(Zd(x,Ke,0,1,-1),x=Ke=0),Z.psxygl(x,Ke,r)||ca(x,Ke,r),q&&$d());if(w)for(q=f+(7.7+e.xmx)*C.scale,void 0==k[n]&&
(k[n]=3*(e.notes[n].pit-18),0==(e.notes[n].pit&1)&&(k[n]+=3)),n=k[n]+p;0<=--w;)ca(q,n,"dot"),q+=3.5;l.acc&&(f-=l.shac*C.scale,e.grace?(Zd(f,y+p,0,.75),Yd(0,0,l.acc,l.micro_n,l.micro_d),$d()):Yd(f,y+p,l.acc,l.micro_n,l.micro_d));0!=b&&uc(b)}}function Cf(a){var c=a;for(a=a.next;a;a=a.next){if(a.rbstop)return a;c=a}return c}function uf(a){for(;a.prev;)if(a=a.prev,a.rbstart)return a;for(a=a.p_v.sym;a.type!=h.CLEF;)a=a.ts_prev;a.next&&a.next.type==h.KEY&&(a=a.next);return a.next&&a.next.type==h.METER?
a.next:a}function Df(a,c,b,d,e,f,g){var m,h,n=.3;h=d-c;0>h&&(h=-h);m=b-a;40<m&&.7>h/m&&(n=.3+.002*(m-40),.7<n&&(n=.7));var B=.5*(a+b);m=.5*(c+d);var r,v;r=a+.45*(B+n*(a-B)-a);v=c+.45*(m+n*(c-m)+f-c);B=b+.45*(B+n*(b-B)-b);n=d+.45*(m+n*(d-m)+f-d);m=.03*(b-a);h=2*e;f=.2+.001*(b-a);.6<f&&(f=.6);f*=e;e=C.v?C.scale:1;z=g?z+'<path class="stroke" stroke-dasharray="5,5" d="M':z+'<path d="M';kb(a," ",c);z+="c"+((r-a)/C.scale).toFixed(1)+" "+((c-v)/e).toFixed(1)+" "+((B-a)/C.scale).toFixed(1)+" "+((c-n)/e).toFixed(1)+
" "+((b-a)/C.scale).toFixed(1)+" "+((c-d)/e).toFixed(1);g||(z+="\n\tv"+(-f).toFixed(1)+"c"+((B-m-b)/C.scale).toFixed(1)+" "+((d+f-n-h)/e).toFixed(1)+" "+((r+m-b)/C.scale).toFixed(1)+" "+((d+f-v-h)/e).toFixed(1)+" "+((a-b)/C.scale).toFixed(1)+" "+((d+f-c)/e).toFixed(1));z+='"/>\n'}function Le(a,c,b,d,e){for(var f=a,g,m,q,n,B,r,v,k,l;f.v!=c.v;)f=f.ts_next;switch(e&7){case h.SL_ABOVE:l=1;break;case h.SL_BELOW:l=-1;break;default:a:{for(l=f;;){if(l.multi){l=l.multi;break a}if(l==c)break;l=l.next}l=0}if(!l)a:{var p;
if(f.grace&&0<f.stem)l=-1;else{for(l=f;;l=l.next){if(l.type==h.NOTE){if(!l.stemless){if(0>l.stem){l=1;break a}p=!0}22>l.notes[0].pit&&(q=!0)}if(l==c)break}l=p||q?-1:1}}}n=1;p=f.st;q=!1;Tb(f.st);if(f!=c)for(g=f.next;;){if(g.type==h.NOTE||g.type==h.REST)n++,g.st!=p&&(q=!0,g.st<p&&(p=g.st));if(g==c)break;g=g.next}q&&J(2,f,"*** multi-staves slurs not treated yet");q=a.x;a.notes&&a.notes[0].shhd&&(q+=a.notes[0].shhd);if(a!=c)a=c.x,c.notes&&(a+=c.notes[0].shhd);else{for(g=c.ts_next;g&&g.type!=h.STAVES;g=
g.ts_next);a=g?g.x:Aa}0<=b?b=3*(f.notes[b].pit-18)+5*l:(b=0<l?f.ymx+2:f.ymn-2,f.type==h.NOTE&&(0<l?0<f.stem&&(q+=5,f.beam_end&&-1<=f.nflags&&!f.in_tuplet&&(0<f.nflags?(q+=2,b=f.ys-3):b=f.ys-6)):0>f.stem&&(--q,c.grace?b=f.y-8:f.beam_end&&-1<=f.nflags&&(!f.in_tuplet||f.ys<b+3)&&(0<f.nflags?(q+=2,b=f.ys+3):b=f.ys+6))));0<=d?d=3*(c.notes[d].pit-18)+5*l:(d=0<l?c.ymx+2:c.ymn-2,c.type==h.NOTE&&(0<l?0<c.stem&&(a+=1,c.beam_st&&-1<=c.nflags&&!c.in_tuplet&&(d=c.ys-6)):0>c.stem&&(a-=5,c.beam_st&&-1<=c.nflags&&
!c.in_tuplet&&(d=c.ys+6))));f.type!=h.NOTE&&(b=d+1.2*l,q=f.x+.5*f.wr,q>a-12&&(q=a-12));c.type!=h.NOTE&&(d=f.type==h.NOTE?b+1.2*l:b,f!=c&&(a=c.x-.3*c.wl));3<=n&&(f.next.type!=h.BAR&&f.next.x<q+48&&(0<l?(v=f.next.ymx-2,b<v&&(b=v)):(v=f.next.ymn+2,b>v&&(b=v))),c.prev&&c.prev.type!=h.BAR&&c.prev.x>a-48&&(0<l?(v=c.prev.ymx-2,d<v&&(d=v)):(v=c.prev.ymn+2,d>v&&(d=v))));r=(d-b)/(a-q);if(.5<r||-.5>r)r=.5<r?.5:-.5,0<r*l?b=d-r*(a-q):d=b+r*(a-q);v=d-b;8<v?v=8:-8>v&&(v=-8);g=v;0>g&&(g=-g);k=.5*g;g=.3*v;0<v*l?(a-=
k,d-=g):(q+=k,b+=g);f.grace&&(q=f.x-.5*Wc);c.grace&&(a=c.x+1.5*Wc);k=0;r=(d-b)/(a-q);if(f!=c&&f.v==c.v){B=b-r*q;for(g=f.next;g!=c;g=g.next)if(g.st==p)switch(g.type){case h.NOTE:case h.REST:0<l?(v=3*(g.notes[g.nhd].pit-18)+6,v<g.ymx&&(v=g.ymx),v-=r*g.x+B,v>k&&(k=v)):(v=3*(g.notes[0].pit-18)-6,v>g.ymn&&(v=g.ymn),v-=r*g.x+B,v<k&&(k=v));break;case h.GRACE:for(m=g.extra;m;m=m.next)0<l?(v=3*(m.notes[m.nhd].pit-18)+6,v<m.ymx&&(v=m.ymx),v-=r*m.x+B,v>k&&(k=v)):(v=3*(m.notes[0].pit-18)-6,v>m.ymn&&(v=m.ymn),
v-=r*m.x+B,v<k&&(k=v))}b+=.45*k;d+=.45*k;k*=.65}n=3<n?(.08*(a-q)+12)*l:(.03*(a-q)+8)*l;0<l?(n<3*k&&(n=3*k),40<n&&(n=40)):(n>3*k&&(n=3*k),-40>n&&(n=-40));v=d-b;0>v&&(v=-v);0<l?n<.8*v&&(n=.8*v):n>-.8*v&&(n=-.8*v);n*=t.slurheight;Df(q,b,a,d,l,n,e&h.SL_DOTTED);r=(d-b)/(a-q);B=b-r*q+.4*n;if(f.v==c.v)for(g=f;g!=c;g=g.next)g.st==p&&(v=r*g.x+B,g.ymx<v?g.ymx=v:g.ymn>v&&(g.ymn=v),g.next==c?(k=a,c.sl1&&(k-=5)):k=g.next.x,g!=f&&(q=g.x),k-=q,Q(p,0<l,q,k,v));return(0<l?h.SL_ABOVE:h.SL_BELOW)|e&h.SL_DOTTED}function jf(a,
c){for(var b,d,e,f,g,m,q,n=a;;){if(!n||n==c){if(!e||!(n=e.next)||n==c)break;e=null}if(n.type==h.GRACE)e=n,n=n.extra;else if(n.type!=h.NOTE&&n.type!=h.REST&&n.type!=h.SPACE||!n.slur_start&&!n.sl1)n=n.next;else{d=null;b=n.next;for(g=!1;;)if(b)if(b.type==h.GRACE)f=b,b=b.extra;else{if(b.type==h.BAR&&(":"==b.bar_type[0]||"|]"==b.bar_type||"[|"==b.bar_type||b.text&&"1"!=b.text[0])){d=b;break}if(b.type==h.NOTE||b.type==h.REST||b.type==h.SPACE){if(b.slur_end||b.sl2){d=b;break}if(b.slur_start||b.sl1){if(f){for(d=
b;d.next;d=d.next);if(d.next=f.next)f.next.prev=d;d=null}jf(b,c);f&&f.next&&(f.next.prev.next=null,f.next.prev=f)}if(b==c)break}b=b.next}else if(f)b=f.next,f=null;else{if(!e||g)break;b=e.next;g=!0}if(!b)d=Cf(n);else if(!d){n=b;if(n==c)break;continue}if(e){for(b=n;b.next;b=b.next);if(b.next=e.next)e.next.prev=b;e.slur_start=h.SL_AUTO}f&&(f.prev.next=f.extra,f.extra.prev=f.prev,f.slur_start=h.SL_AUTO);if(n.slur_start)m=n.slur_start&15,n.slur_start>>=4,b=-1;else{for(b=0;b<=n.nhd&&!n.notes[b].sl1;b++);
m=n.notes[b].sl1&15;n.notes[b].sl1>>=4;n.sl1--}g=-1;q=0;if(d.type!=h.NOTE&&d.type!=h.REST&&d.type!=h.SPACE||!d.slur_end&&!d.sl2)d.type==h.BAR&&(":"==d.bar_type[0]||"|]"==d.bar_type||"[|"==d.bar_type||d.text&&"1"!=d.text[0])||(q=1);else if(d.slur_end)d.slur_end--;else{for(g=0;g<=d.nhd&&!d.notes[g].sl2;g++);d.notes[g].sl2--;d.sl2--}m=Le(n,d,b,g,m);q&&(d.p_v.slur_start||(d.p_v.slur_start=0),d.p_v.slur_start<<=4,d.p_v.slur_start+=m);e&&e.next&&(e.next.prev.next=null,e.next.prev=e);f&&(f.prev.next=f,f=
f.extra.prev=null);if(!n.slur_start&&!n.sl1){if(n==c)break;n=n.next}}}}function kf(a,c){var b,d,e,f,g,m,q,n,B,r,k,l,t,p;f=a.st;Tb(a.st);for(b=a;b;b=b.next)if(b.type!=h.NOTE&&b.type!=h.REST){if(b.type==h.GRACE)for(e=b.extra;e;e=e.next)if(e.slur_start||e.sl1)g=!0}else{if(b.slur_start||b.slur_end||b.sl1||b.sl2)g=!0;b.st<f&&(f=b.st);if(0==c){if(b.tp1&&kf(b,1),b.te0)break}else if(b.te1)break}if(b){if(g){jf(a,b);if(a.slur_start||a.sl1)return;for(d=a.next;d!=b;d=d.next)if(d.slur_start||d.slur_end||d.sl1||
d.sl2)return;if(b.slur_end||b.sl2)return}0==c?(t=a.tp0,a.tp0=0,p=a.tq0):(t=a.tp1,a.tp1=0,p=a.tq1);if(1!=a.tf[0]){(e=a.tf[3])||(e=0<a.stem?h.SL_ABOVE:h.SL_BELOW);if(a==b)g=!0;else if(1==a.tf[1])g=!0,Le(a,b,-1,-1,e);else if(2==a.tf[0]||a.type!=h.NOTE||b.type!=h.NOTE)g=!1;else{g=!0;for(d=a;;d=d.next){if(d.type!=h.NOTE&&d.type!=h.REST){if(d.type==h.GRACE||d.type==h.SPACE)continue;g=!1;break}if(d==b)break;if(d.beam_end){g=!1;break}}if(g&&!a.beam_st&&!a.beam_br1&&!a.beam_br2)for(d=a.prev;d;d=d.prev)if(d.type==
h.NOTE||d.type==h.REST){d.nflags>=a.nflags&&(g=!1);break}if(g&&!b.beam_end)for(d=b.next;d;d=d.next)if(d.type==h.NOTE||d.type==h.REST){!d.beam_br1&&!d.beam_br2&&d.nflags>=b.nflags&&(g=!1);break}}if(g){if(1!=a.tf[2]){B=(b.x+a.x)/2;k=a==b?0:(b.ys-a.ys)/(b.x-a.x);g=a.ys-k*a.x;l=k*B+g;e==h.SL_ABOVE?(r=T(f,1,B-4,8),r>l&&(g+=r-l),g+=2):(r=T(f,0,B-4,8),r<l&&(g+=r-l),g-=10);for(d=a;!(d.x>=B);d=d.next);0<a.stem*b.stem&&(B=0<a.stem?B+1.5:B-1.5);r=k*B+g;0==a.tf[2]?Ef(B,r,t):Ef(B,r,t+":"+p);e==h.SL_ABOVE?(r+=
10,d.ymx<r&&(d.ymx=r),Q(f,!0,B-3,6,r)):(d.ymn>r&&(d.ymn=r),Q(f,!1,B-3,6,r))}}else{0!=a.tf[1]&&J(2,a,"'what' value of %%tuplets not yet coded");(e=a.tf[3])||(e=0<=a.multi?h.SL_ABOVE:h.SL_BELOW);if(e==h.SL_ABOVE){a.st==b.st?g=n=u[f].topbar+4:(g=a.ymx,n=b.ymx);m=a.x-4;if(a.st==f){for(d=a;!d.dur;d=d.next);r=T(f,1,d.x-4,8);r>g&&(g=r);0<a.stem&&(m+=3)}if(b.st==f){for(d=b;!d.dur;d=d.prev);r=T(f,1,d.x-4,8);r>n&&(n=r)}b.dur>b.prev.dur?q=b.next?b.next.x-b.next.wl-5:Aa-6:(q=b.x+4,B=0<=b.stem?0:b.nhd,0<b.notes[B].shhd&&
(q+=b.notes[B].shhd),b.st==f&&0<b.stem&&(q+=3.5));B=.5*(m+q);r=.5*(g+n);k=(n-g)/(q-m);g=3*(b.notes[b.nhd].pit-a.notes[a.nhd].pit)/(q-m);0<g?0>k?k=0:k>g&&(k=g):0<k?k=0:k<g&&(k=g);k*k<.1*.1&&(k=0);n=0;for(d=a;d.dur&&d.st==f&&(l=r+(d.x-B)*k,g=T(f,1,d.x-4,8)+2,g-l>n&&(n=g-l)),d!=b;d=d.next);r+=n;g=r+k*(m-B);n=r+k*(q-B);r+=8;for(d=a;;d=d.next)if(d.st==f){l=r+(d.x-B)*k;d.ymx<l&&(d.ymx=l);if(d==b)break;Q(f,!0,d.x,d.next.x-d.x,l)}else if(d==b)break}else{m=a.x-7;b.dur>b.prev.dur?q=b.next?b.next.x-b.next.wl-
8:Aa-6:(q=b.x+2,0<b.notes[b.nhd].shhd&&(q+=b.notes[b.nhd].shhd));0<=a.stem&&(m+=2,q+=2);if(a.st==f){for(d=a;!d.dur;d=d.next);g=T(f,0,d.x-4,8)}else g=0;if(b.st==f){for(d=b;!d.dur;d=d.prev);n=T(f,0,d.x-4,8)}else n=0;B=.5*(m+q);r=.5*(g+n);k=(n-g)/(q-m);g=3*(b.notes[0].pit-a.notes[0].pit)/(q-m);0<g?0>k?k=0:k>g&&(k=g):0<k?k=0:k<g&&(k=g);k*k<.1*.1&&(k=0);n=0;for(d=a;d.dur&&d.st==f&&(l=r+(d.x-B)*k,g=T(f,0,d.x-4,8),g-l<n&&(n=g-l)),d!=b;d=d.next);r+=n-10;g=r+k*(m-B);n=r+k*(q-B);r-=2;for(d=a;;d=d.next){if(d.st==
f){if(d==b)break;l=r+(d.x-B)*k;d.ymn>l&&(d.ymn=l);Q(f,!1,d.x,d.next.x-d.x,l)}if(d==b)break}}1==a.tf[2]?(f=n-g,e=e==h.SL_ABOVE?-3:3,B=(q-m)/C.scale,z+='<path class="stroke" d="m',kb(m," ",g+4+e),z+="v"+e.toFixed(1)+"l"+B.toFixed(1)+" "+(-f).toFixed(1)+"v"+(-e).toFixed()+'"/>\n'):(b=m,d=g,m=q-m,q=n-g,r=e==h.SL_ABOVE,t=0==a.tf[2]?t.toString():t+":"+p,p=10*t.length,k=r?-3:3,W('<text style="font:italic 12px serif"\n\tx="X" y="Y" text-anchor="middle">A</text>\n',b+m/2,d+q/2,t),m/=C.scale,r||(d+=6),z+='<path class="stroke" d="m',
kb(b," ",d),z+="v"+k.toFixed(1)+"m"+m.toFixed(1)+" "+(-q).toFixed(1)+"v"+(-k).toFixed(1)+'"/>\n<path class="stroke" stroke-dasharray="'+((m-p)/2).toFixed(1)+" "+p.toFixed(1)+'" d="m',kb(b," ",d-k),z+="l"+m.toFixed(1)+" "+(-q).toFixed(1)+'"/>\n',l=.5*(g+n),e==h.SL_ABOVE?Q(f,!0,B-3,6,l+9):Q(f,!1,B-3,6,l))}}}else J(1,a,"No end of tuplet in this music line"),0==c?a.tp0=0:a.tp1=0}function ae(a,c,b,d,e){var f,g,m,q,n,k,r,l,t;for(f=0;f<b.length;f++){m=b[f];n=a.notes[m].pit;q=d[f];k=2!=e?c.notes[q].pit:n;
g=(a.notes[m].ti1&7)==h.SL_ABOVE?1:-1;l=a.x;t=a.notes[m].shhd;0<g?m<a.nhd&&n+1==a.notes[m+1].pit&&a.notes[m+1].shhd>t&&(t=a.notes[m+1].shhd):0<m&&n==a.notes[m-1].pit+1&&a.notes[m-1].shhd>t&&(t=a.notes[m-1].shhd);l+=.6*t;r=c.x;2!=e&&(t=c.notes[q].shhd,0<g?q<c.nhd&&k+1==c.notes[q+1].pit&&c.notes[q+1].shhd<t&&(t=c.notes[q+1].shhd):0<q&&k==c.notes[q-1].pit+1&&c.notes[q-1].shhd<t&&(t=c.notes[q-1].shhd),r+=.6*t);q=a.st;switch(e){case 0:n==k||n&1||(n=k);break;case 3:g=-g;case 1:l=a.x;l>r-20&&(l=r-20);n=
k;q=c.st;break;default:if(a!=c)r-=c.wl,c.type==h.BAR&&(r+=5);else{k=a.time+a.dur;for(r=a.ts_next;r&&!(r.time>k);r=r.ts_next);r=r?r.x:Aa}r<l+16&&(r=l+16)}20<r-l?(l+=3.5,r-=3.5):(l+=1.5,r-=1.5);n=3*(n-18);k=(.04*(r-l)+10)*g;Df(l,u[q].y+n,r,u[q].y+n,g,k,a.notes[m].ti1&h.SL_DOTTED)}}function jc(a,c,b){var d,e,f,g,m,q=[],n=[],k=[],r=a.nhd,l=a.time+a.dur;if(2==b){for(d=0;d<=r;d++)a.notes[d].ti1&&k.push(d);ae(a,c||a,k,k,b)}else{for(d=0;d<=r;d++)if(a.notes[d].ti1){e=-1;g=a.notes[d].opit||a.notes[d].pit;for(f=
c.nhd;0<=f;f--){m=c.notes[f].opit||c.notes[f].pit;switch(m-g){case 1:case -1:a.notes[d].acc!=c.notes[f].acc&&(e=f);default:continue;case 0:e=f}break}0<=e?(q.push(d),n.push(e)):k.push(d)}ae(a,c,q,n,b);if(k.length){for(c=a.ts_next;c&&c.time<l;)c=c.ts_next;for(;c&&c.time==l;){if(c.type==h.NOTE&&c.st==a.st){q.length=0;n.length=0;for(d=k.length;0<=--d;)for(e=k[d],g=a.notes[e].opit||a.notes[e].pit,f=c.nhd;0<=f;f--)if(m=c.notes[f].opit||c.notes[f].pit,m==g){q.push(e);n.push(f);k[d]=k.pop();break}if(0<q.length&&
(ae(a,c,q,n,1==b?1:0),0==k.length))return}c=c.ts_next}0!=k.length&&J(1,a,"Bad tie")}}}function Rg(a){var c,b,d;b=a.time+a.dur;d=a.st;for(c=a.ts_next;c;c=c.ts_next)if(c.st==d)if(c.time==b){if(c.type==h.NOTE)return c}else if(c.time>b)return a}function Sg(a){function c(a,b,c){if(a.type==h.GRACE)for(a=a.extra;a;a=a.next)a.ti1&&jc(a,b,c);else jc(a,b,c)}var b,d,e,f,g,m;for(b=a.sym;b;b=b.next){switch(b.type){case h.CLEF:case h.KEY:case h.METER:continue}break}m=a.s_rtie;for(d=b;d&&!d.dur&&d.type!=h.GRACE;d=
d.next)d.type==h.BAR&&d.text&&("1"==d.text[0]?m=a.s_tie:a.s_tie=m);if(d){a.s_tie&&(a.s_tie.x=b.x+b.wr,b=a.s_tie,a.s_tie=null,b.st=d.st,b.ts_next=d.ts_next,b.time=d.time-b.dur,jc(b,d,1));for(;;){for(b=d;b&&!b.ti1;b=b.next)if(m&&b.type==h.BAR&&b.text)if("1"==b.text[0])m=null;else if("|"!=b.bar_type){for(d=b.next;d&&d.type!=h.NOTE;d=d.next);if(!d){b=null;break}e=A(m);e.x=b.x;e.next=d;e.st=d.st;e.time=d.time-e.dur;jc(e,d,1)}if(!b)break;g=b.time+b.dur;for(d=b.next;d&&!d.dur;d=d.next)if(d.type==h.BAR&&
d.text){if("1"!=d.text[0])break;m=b}if(d){if(d.type!=h.NOTE&&d.type!=h.BAR){J(1,b,"Bad tie");continue}if(d.time!=g){e=Rg(b);if(e==b){J(1,b,"Bad tie");continue}d=e}}else{for(d=b.ts_next;d;d=d.ts_next)if(d.st==b.st&&!(d.time<g)){if(d.time>g){d=null;break}if(d.dur)break}if(!d){c(b,null,2);a.s_tie=b;break}}for(e=b.ts_next;e;e=e.ts_next)if(e.st==b.st){if(e.time>g)break;e.type==h.CLEF&&(f=!0)}f||b.st!=d.st?(f=!1,g=.4*(d.x-b.x),e=d.x,d.x-=g,d.x>b.x+32&&(d.x=b.x+32),c(b,d,2),d.x=e,e=b.x,b.x+=g,b.x<d.x-24&&
(b.x=d.x-24),jc(b,d,3),b.x=e):c(b,d,d.type==h.NOTE?0:2)}a.s_rtie=m}}function Tg(a){var c,b,d,e,f,g=[];for(d=E.nstaff;0<=d&&!E.st_print[d];d--);if(!(0>d)){for(b=0;b<x.length;b++)if(c=x[b],c.sym&&(d=E.voices[b].st,E.st_print[d])){if(c.new_name){e=2;break}c.snm&&(e=1)}if(e){for(b=0;b<x.length;b++)if(c=x[b],c.sym&&(d=E.voices[b].st,E.st_print[d]&&(c.new_name&&delete c.new_name,c=2==e?c.nm:c.snm))){if(E.staves[d].flags&512)for(;!(E.staves[d].flags&256);)d--;else if(E.staves[d].flags&2)for(;!(E.staves[d].flags&
1);)d--;g[d]=g[d]?g[d]+("\\n"+c):c}if(0!=g.length)for(pa("voice"),a=.5*-a,d=0;d<g.length;d++)if(g[d]){e=g[d].split("\\n");f=u[d].y+.5*u[d].topbar*u[d].staffscale+9*(e.length-1)-.3*D.curfont.size;b=d;if(E.staves[d].flags&256)for(;!(E.staves[b].flags&512);)b++;else if(E.staves[d].flags&1)for(;!(E.staves[b].flags&2);)b++;b!=d&&(f-=.5*(u[d].y-u[b].y));for(b=0;b<e.length;b++)c=e[b],la(a,f,c,"c"),f-=18}}}}function Ug(){var a,c,b,d,e,f,g,m,q;for(c=0;c<x.length;c++)q=x[c],1!=q.scale&&(q.scale_str='transform="scale('+
q.scale.toFixed(2)+')"');for(c=0;c<=R&&!D.st_print[c];c++);d=0;if(c>R)c--,q=u[c];else for(q=u[c],a=0;256>a;a++)m=q.top[a],d<m&&(d=m);a=d;m=c;var n,k,r=0,l=0,Ka=u[m].topbar+8,p=0,z=1,y=-100;for(g=V;g;g=g.ts_next)g.type!=h.TEMPO||g.del||(e||(e=g),n=wf(g),0==g.time&&40<g.x&&(g.x=40),k=T(m,!0,g.x-16,n),k>Ka&&(Ka=k),y>=g.x-16&&!(p&z>>1)&&(p|=z),z<<=1,y=g.x-16+n);if(e)for(gb(-1),pa("tempo"),l=D.curfont.size+8,k=2-l,f=k-l,0!=p&&(l*=2),d<Ka+l&&(r=Ka+l-d),g=e;g;g=g.ts_next)if(g.type==h.TEMPO&&!g.del){if(w.anno_start||
w.anno_stop)g.wl=16,g.wr=30,g.ymn=p&1?f:k,g.ymx=g.ymn+14,qb(g);xf(g,g.x-16,p&1?f:k);zb(g);p>>=1}Ka=u[m].topbar+6;for(g=V;g;g=g.ts_next)g.type==h.PART&&(b||(b=g,pa("parts"),f=D.curfont.size+2),n=Pa(g.text)[0],k=T(m,!0,g.x-10,n+3),Ka<k&&(Ka=k));if(b)for(gb(-1),D.curfont.box&&(f+=2),d<Ka+f+l&&(r=Ka+f+l-d),g=b;g;g=g.ts_next)if(g.type==h.PART){g.x-=10;if(w.anno_start||w.anno_stop)n=Pa(g.text)[0],g.wl=0,g.wr=n,g.ymn=-l-f,g.ymx=g.ymn+f,qb(g);la(g.x,2-l-f,g.text);zb(g)}d=a+r;if(!D.st_print[c])return d;d*=
q.staffscale;e=.5*t.staffsep+q.topbar*q.staffscale;d<e&&(d=e);d<q.ann_top&&(d=q.ann_top);q.y=-d;b=c;f=E.staves[b];for(c++;c<=R;c++)if(q=u[c],D.st_print[c]){e=f.sep||t.sysstaffsep;g=f.maxsep||t.maxsysstaffsep;f=0;if(q.staffscale==u[b].staffscale){for(a=0;256>a;a++)m=q.top[a]-u[b].bot[a],f<m&&(f=m);f*=q.staffscale}else for(a=0;256>a;a++)m=q.top[a]*q.staffscale-u[b].bot[a]*u[b].staffscale,f<m&&(f=m);e+=q.topbar*q.staffscale;f<e&&(f=e);g+=q.topbar*q.staffscale;f>g&&(f=g);d+=f;q.y=-d;b=c;f=E.staves[b]}for(a=
e=0;256>a;a++)m=u[b].bot[a],e>m&&(e=m);e>q.ann_bot&&(e=q.ann_bot);e*=u[b].staffscale;for(c=0;c<=R;c++)q=u[c],f=q.y,1!=q.staffscale&&(q.scale_str='transform="translate(0,'+(ra-f).toFixed(1)+") scale("+q.staffscale.toFixed(2)+')"');if(0==e){for(c=R;0<=c&&!D.st_print[c];c--);if(0>c)return d}f=-e;e=.5*t.staffsep;f<e&&(f=e);g=.5*t.maxstaffsep;f>g&&(f=g);return d+f}function Vg(a){function c(){var a,b,c,d=0;for(a=0;a<=E.nstaff;a++)0>k[a]?r[a]=l[a]=0:(b=u[a].staffscale,c=u[a].topbar*b,b*=u[a].botbar,0==d&&
(d=u[a].y+c),r[a]=u[a].y+b,l[a]=d-r[a],d=E.staves[a].flags&64?0:r[a])}function b(a,b,c){var d,e,f,g,m=0,h="",q=E.staves[a].stafflines,n=q.length;if(/[\[|]/.test(q))if(c-=b,gb(a),d=c/C.scale,Ic&&Ic.st_l==q&&Ic.st_ws==(d|0))ca(b,u[a].y,"stdef"+t.fullsvg);else{for(e=0;e<n;e++,m-=6)if("."!=q[e]){for(f=0;e<n;e++,m-=6,f-=6){switch(q[e]){case ".":case "-":continue;case g:h+="m-"+d.toFixed(1)+" "+f+"h"+d.toFixed(1);f=0;continue}void 0!=g&&(h+='"/>\n');g=q[e];h+='<path class="'+("["==g?"slthW":"slW")+'" d="m0 '+
m+"h"+d.toFixed(1);f=0}h+='"/>'}m=u[a].y;!Ic&&c>rd()-10?(Ic={st_l:q,st_ws:d|0},e="stdef"+t.fullsvg,Gb[e]=h.replace("path",'path id="'+e+'"'),ca(b,m,e)):W('<g transform="translate(X, Y)">\n'+h+"\n</g>\n",b,m)}}function d(a,b,c){var d,e,f=a.bar_type,g=a.st,m=u[g],q=a.x;0!=g&&a.ts_prev&&a.ts_prev.type!=h.BAR&&(c=m.topbar*m.staffscale);a.ymx=a.ymn+c;gb(-1);qb(a);e=m.y+12;"|||||"!=m.stafflines&&(e+=(m.topbar+m.botbar)/2-12);if(a.bar_mrep)if(gb(g),1==a.bar_mrep){for(d=a.prev;d.type!=h.REST;d=d.prev);y.push([d.x,
e,g,"mrep"])}else y.push([q,e,g,"mrep2"]),a.v==E.top_voice&&A.push([q,e+m.topbar-9,g,a.bar_mrep.toString()]);"||:"==f&&(f="[|:");for(d=f.length;0<=--d;){switch(f[d]){case "|":a.bar_dotted?p.push(new Float32Array([q,b,c,m.staffscale])):Ka.push(new Float32Array([q,b,c]));break;default:q-=3;w.push(new Float32Array([q+1.5,b,c]));break;case ":":q-=2,y.push([q+1,e-12,g,"rdots"])}q-=3}gb(-1);zb(a)}var e,f,g,m,q,n,k=[],r=[],l=[],Ka=[],p=[],w=[],y=[],A=[];Tg(a);for(e=0;e<=R;e++)k[e]=E.st_print[e]?0:-1;c();
Af(0);for(a=V;a;a=a.ts_next){if(n&&a.time!=n){for(e=n=0;e<=R;e++)E.st_print[e]||(k[e]=-1);c()}switch(a.type){case h.STAVES:q=a.ts_prev.type==h.BAR?a.ts_prev.x:0;if(!q){for(e=a.ts_next;e&&e.time==a.time;e=e.ts_next){switch(e.type){case h.BAR:case h.CLEF:case h.KEY:case h.METER:q=e.x;continue}break}e||(q=Aa)}m=a.sy;for(e=0;e<=R;e++)f=k[e],0>f?m.st_print[e]&&(k[e]=q?q:a.x-a.wl-2):m.st_print[e]&&m.staves[e].stafflines==E.staves[e].stafflines||(q?(g=q,n=a.time):(g=a.x-a.wl-2,k[e]=-1),b(e,f,g),m.st_print[e]&&
(k[e]=g));E=m;c();continue;case h.BAR:if(a.second||a.invis||!a.bar_type)break;e=a.st;d(a,r[e],l[e]);break;case h.STBRK:if(0==E.voices[a.v].range&&14<a.xmx){for(q=g=0;q<x.length;q++)0<E.voices[q].range&&g++;for(e=a.ts_next;e&&e.type==h.STBRK;e=e.ts_next)g--;0==g&&Af(a.x)}if(e=a.prev){g=e.x;e.type!=h.BAR&&(g+=e.wr);e=a.st;f=k[e];if(0<=f){if(f>=g)continue;b(e,f,g)}k[e]=a.x}}}for(e=0;e<=R;e++)if(!n||E.st_print[e])f=k[e],0>f||f>=Aa||b(e,f,Aa);(function(){var a,b,c,d,e=Ka.length;gb(-1);if(e){z+='<path class="bW" d="';
for(a=0;a<e;a++)b=Ka[a],W("MX Yv-F",b[0],b[1],b[2]);z+='"/>\n'}if(e=p.length)for(a=0;a<e;a++)b=p[a],c=(5*b[3]).toFixed(1),W('<path class="bW" stroke-dasharray="'+c+","+c+'" d="MX Yv-F"/>\n',b[0],b[1],b[2]);if(e=w.length){z+='<path class="bthW" d="';for(a=0;a<e;a++)b=w[a],W("MX Yv-F",b[0],b[1],b[2]);z+='"/>\n'}if(e=y.length)for(a=0;a<e;a++)b=y[a],gb(b[2]),ca(b[0],b[1],b[3]);if(e=A.length){pa("annotation");D.curfont.box&&(D.curfont.box=!1,d=!0);for(a=0;a<e;a++)b=A[a],gb(b[2]),la(b[0],b[1],b[3],"c");
d&&(D.curfont.box=!0)}})();gb(-1)}function kc(a){return!a||!/^(0|n|f)/i.test(a)}function Me(a,c){var b,d,e;if("-"==a[a.length-2]){b=a[a.length-1];if("1">b||"9"<b)return;a="u"+b+"font"}(b=t[a])||(b={name:"sans-serif",size:12});b=Object.create(b);b.fid=b.used=void 0;t[a]=b;if(d=c.match(/\s+(no)?box(\s|$)/))b.box=d[1]?!1:!0,c=c.replace(d[0],d[2]);if(d=c.match(/\s+class=(.*?)(\s|$)/))b["class"]=d[1],c=c.replace(d[0],d[2]);if(d=c.match(/\s+wadj=(.*?)(\s|$)/)){if("undefined"==typeof document)switch(d[1]){case "none":b.wadj=
"";break;case "space":b.wadj="spacing";break;case "glyph":b.wadj="spacingAndGlyphs";break;default:p(1,N.bad_val,"%%"+a)}c=c.replace(d[0],d[2])}(d=Jc(c))?(e=d[0],"*"!=e&&(e=e.replace("Times-Roman","serif"),e=e.replace("Times","serif"),e=e.replace("Helvetica","sans-serif"),e=e.replace("Courier","monospace"),b.name=e,b.swfac=0),1<d.length&&(d=d[d.length-1],"*"!=d&&(d=Number(d),isNaN(d)?p(1,N.bad_val,"%%"+a):(b.size=d,b.swfac=0)))):p(1,N.bad_val,"%%"+a)}function mb(a){var c=parseFloat(a);switch(a.slice(-2)){case "CM":case "cm":c*=
37.8;break;case "IN":case "in":c*=96;break;case "PT":case "pt":c*=.75}return c}function Ff(a,c){a=a.slice(0,3);"ste"==a&&(a="stm");Z.set_v_param("pos",a+" "+c)}function rb(){ga.chg&&(ga.chg=!1,ga.lm=t.leftmargin-t.printmargin,0>ga.lm&&(ga.lm=0),ga.rm=t.rightmargin-t.printmargin,0>ga.rm&&(ga.rm=0),ga.width=t.pagewidth-2*t.printmargin,100>ga.width-ga.lm-ga.rm&&(J(0,void 0,"Bad staff width"),ga.width=ga.lm+ga.rm+150),ic=ga.lm/t.scale)}function sd(a){var c=a.name,b="",d=c.match(/-?[bB]old/);d&&(b+="bold ",
c=c.replace(d[0],""));if(d=c.match(/-?[iI]talic/))b+="italic ",c=c.replace(d[0],"");if(d=c.match(/-?[oO]blique/))b+="oblique ",c=c.replace(d[0],"");return"font:"+b+a.size.toFixed(1)+"px "+c}function td(a){return a["class"]?"f"+a.fid+t.fullsvg+" "+a["class"]:"f"+a.fid+t.fullsvg}function sb(a){if(!a.used){a.used=!0;if(void 0==a.fid&&(a.fid=Kc.length,Kc.push(a),!a.swfac)){var c=Gf[a.name];c||(c=1.1);a.swfac=a.size*c}vc+="\n.f"+a.fid+t.fullsvg+" {"+sd(a)+"}"}}function lc(a){a+="font";var c=t[a];c||(p(1,
"Unknown font $1","$"+a[1]),c=D.curfont);sb(c);return c}function nb(a){var c,b,d="",e;for(c=0;;){e=a.indexOf("\\",c);if(0>e)break;d+=a.slice(c,e);c=a[++e];if(!c)return d+"\\";switch(c){case "0":case "2":if("0"!=a[e+1])break;if(b=Wg[a[e+2]]){d+=b;c=e+3;continue}break;case "u":c=Number("0x"+a.slice(e+1,e+5));if(isNaN(c)||32>c){d+=a[++e]+"\u0306";c=e+1;continue}d+=String.fromCharCode(c);c=e+5;continue;case "t":d+=" ";c=e+1;continue;default:if(b=Xg[a.slice(e,e+2)]){d+=b;c=e+2;continue}switch(c){case "`":d+=
a[++e]+"\u0300";c=e+1;continue;case "'":d+=a[++e]+"\u0301";c=e+1;continue;case "^":d+=a[++e]+"\u0302";c=e+1;continue;case "~":d+=a[++e]+"\u0303";c=e+1;continue;case "=":d+=a[++e]+"\u0304";c=e+1;continue;case "_":d+=a[++e]+"\u0305";c=e+1;continue;case ".":d+=a[++e]+"\u0307";c=e+1;continue;case '"':d+=a[++e]+"\u0308";c=e+1;continue;case "o":d+=a[++e]+"\u030a";c=e+1;continue;case "H":d+=a[++e]+"\u030b";c=e+1;continue;case "v":d+=a[++e]+"\u030c";c=e+1;continue;case "c":d+=a[++e]+"\u0327";c=e+1;continue;
case ";":d+=a[++e]+"\u0328";c=e+1;continue}}d+="\\"+c;c=e+1}return d+a.slice(c)}function Yg(a){var c,b;w.read_file?2<Hb?p(1,"Too many include levels"):(c=w.read_file(a))?(Hb++,b=A(l),Xc(a,c),b.state=l.state,l=b,Hb--):p(1,"Cannot read file '$1'",a):p(1,"No read_file support")}function Xc(a,c,b,d){function e(){var a,e=c.indexOf("K:",b);if(0>e)return!1;e=c.indexOf("\n",e);if(l.select.test(c.slice(l.bol,e)))return!0;a=/\n\w*\n/;a.lastIndex=e;n=a.exec(c)?a.lastIndex:d;return!1}function f(a,b){if(!a)return a;
0<=a.indexOf("%")&&(a=a.replace(/([^\\])%.*/,"$1").replace(/\\%/g,"%"));a=a.replace(/\s+$/,"");return b&&0<=a.indexOf("\\")?nb(a):a}function g(){Hf();O.W&&Zg(O.W);var a,b,c,d,e,f,g=t.infoname.split("\n"),m=g.length;for(a=0;a<m;a++)if(c=g[a][0],!(0>t.writefields.indexOf(c))&&(c=O[c])){d||(d=!0,pa("history"),ia(t.textspace),e=D.curfont.size*t.lineskipfac);f=g[a].slice(2);'"'==f[0]&&(f=f.slice(1,-1));ia(e);b=Pa(f);la(0,0,f,null,null,b);f=b[0];c=c.split("\n");la(f,0,c[0]);for(b=1;b<c.length;b++)ia(e),
la(f,0,c[b]);ia(.3*e);Ib();sb(D.curfont)}Lc();l.state=0;t=Ua.cfmt;O=Ua.info;Za=Ua.char_tb;za=Ua.glovar;Jb=Ua.maps;mc=Ua.mac;Yc=Ua.maci;l.tune_v_opts=null;l.scores=null;If();ga.chg=!0;rb()}function m(a,b){var d,e;if("end"!=a){b?(l.tune_v_opts||(l.tune_v_opts={}),d=l.tune_v_opts):(l.voice_opts||(l.voice_opts={}),d=l.voice_opts);for(d[a]=[];;){e=++n;if("%"!=c[e])break;n=c.indexOf("\n",n);if(c[e+1]==v){e+=2;u=0>n?c.slice(e):c.slice(e,n);x=u.match(/\S+/);switch(x[0]){default:d[a].push(f(u,!0));continue;
case "score":case "staves":case "tune":case "voice":e-=2}break}}n=l.eol=e-1}}function h(){var a,d,e,f,g=c.indexOf("K:",b),g=c.indexOf("\n",g);f=c.slice(l.bol,g);for(g in l.tune_opts)if(l.tune_opts.hasOwnProperty(g)&&(new RegExp(g)).test(f)){a=l.tune_opts[g];for(d=0;d<a.t_opts.length;d++)switch(e=a.t_opts[d],e.match(/\S+/)[0]){case "score":case "staves":l.scores||(l.scores=[]);l.scores.push(e);break;default:Z.do_pscom(e)}if(a=a.v_opts)for(d in a)a.hasOwnProperty(d)&&(l.tune_v_opts||(l.tune_v_opts=
{}),l.tune_v_opts[d]=l.tune_v_opts[d]?l.tune_v_opts[d].concat(a[d]):a[d])}}var n,k,r,v,Ka,u,x,y,w,z="\n";abc2svg.modules&&(abc2svg.modules.hooks.length||abc2svg.modules.g_hooks.length)&&$g();l.file=c;l.fname=a;void 0==b&&(b=0);d||(d=c.length);for(;b<d;b=l.eol+1){n=c.indexOf("\n",b);if(0>n||n>d)n=d;for(l.eol=n;;){n--;switch(c[n]){case " ":case "\t":continue}break}n++;if(n==b)1==l.state?(l.istart=b,p(1,"Empty line in tune header - ignored")):2<=l.state&&(g(),l.select&&(n=c.indexOf("\nX:",l.eol),0>n&&
(n=d),l.eol=n));else{l.istart=l.bol=b;l.iend=n;l.line.index=0;r=c[b];v=c[b+1];if("%"==r){if(0>l.prefix.indexOf(v))continue;"a"==c[b+2]&&"b"==c[b+3]&&"c"==c[b+4]&&" "==c[b+5]?(b+=6,r=c[b],v=c[b+1]):w=!0}else"I"==r&&":"==v&&(w=!0);if(w){if(w=!1,b+=2,u=c.slice(b,n),(x=u.match(/([^\s]+)\s*(.*)/))&&"%"!=x[1][0]){switch(x[1]){case "abcm2ps":case "ss-pref":l.prefix=x[2];continue;case "abc-include":Yg(f(x[2]));continue}if("begin"==x[1].slice(0,5))y=x[1].substr(5),k="\n"+r+v+"end"+y,a=c.indexOf(k,n),0>a?(p(1,
"No $1 after %%$2",k.slice(1),x[1]),l.eol=d):(Z.do_begin_end(y,f(x[2]),c.slice(n+1,a).replace(new RegExp("^"+r+v,"gm"),"")),l.eol=c.indexOf("\n",a+6),0>l.eol&&(l.eol=d));else{switch(x[1]){case "select":if(0!=l.state){p(1,N.not_in_tune,"%%select");continue}a=f(u.slice(7));'"'==a[0]&&(a=a.slice(1,-1));if(!a){delete l.select;continue}a=a.replace(/\(/g,"\\(");a=a.replace(/\)/g,"\\)");l.select=new RegExp(a,"m");continue;case "tune":if(0!=l.state){p(1,N.not_in_tune,"%%tune");continue}a=f(x[2]);if(!a){l.tune_opts=
{};continue}if("end"==a)continue;l.tune_opts||(l.tune_opts={});for(l.tune_opts[a]=a={t_opts:[]};;){b=++n;if("%"!=c[b])break;n=c.indexOf("\n",n);if(c[b+1]==v){b+=2;u=0>n?c.slice(b):c.slice(b,n);x=u.match(/([^\s]+)\s*(.*)/);switch(x[1]){case "tune":break;case "voice":m(f(x[2],!0),!0);continue;default:a.t_opts.push(f(u,!0));continue}break}}l.tune_v_opts&&(a.v_opts=l.tune_v_opts,l.tune_v_opts=null);l.eol=b-1;continue;case "voice":if(0!=l.state){p(1,N.not_in_tune,"%%voice");continue}a=f(x[2]);if(!a){l.voice_opts=
null;continue}m(a);continue}Z.do_pscom(f(u,!0))}}}else if(":"==v&&/[A-Za-z+]/.test(r)){for(b+=2;;){switch(c[b]){case " ":case "\t":b++;continue}break}u=f(c.slice(b,n),!0);if("+"==r){if(!Ka){p(1,"+: without previous info field");continue}z=" ";r=Ka}switch(r){case "X":if(0!=l.state){p(1,N.ignored,r);continue}if(l.select&&!e()){n=c.indexOf("\nX:",l.eol);0>n&&(n=d);l.eol=n;continue}Ua.cfmt=A(t);t.pos=A(t.pos);Ua.info=A(O,1);Ua.char_tb=A(Za);Ua.glovar=A(za);Ua.maps=A(Jb,1);Ua.mac=A(mc);Ua.maci=new Int8Array(Yc);
O.X=u;l.state=1;l.tune_opts&&h();continue;case "T":switch(l.state){case 0:continue;case 1:O.T=void 0==O.T?u:O.T+("\n"+u);continue}a=Ub("title");a.text=u;continue;case "K":switch(l.state){case 0:continue;case 1:O.K=u}ud(r,u);continue;case "W":if(0==l.state||0>t.writefields.indexOf(r))break;O.W=void 0==O.W?u:O.W+(z+u);break;case "m":if(2<=l.state){p(1,N.ignored,r);continue}if((!t.sound||"play"!=t.sound)&&0>t.writefields.indexOf(r))break;x=u.match(/(.*?)[= ]+(.*)/);if(!x||!x[2]){p(1,N.bad_val,"m:");
continue}mc[x[1]]=x[2];Yc[x[1].charCodeAt(0)]=1;break;case "s":if(3!=l.state||0>t.writefields.indexOf(r))break;ah(u," "==z);break;case "w":if(3!=l.state||0>t.writefields.indexOf(r))break;bh(u," "==z);if("\\"==u.slice(-1)){z=" ";Ka=r;continue}break;case "|":if(2>l.state)continue;l.line.buffer=f(c.slice(b,n),!0);Jf();continue;default:if(0<="ABCDFGHNOSZ".indexOf(r)){if(2<=l.state){p(1,N.ignored,r);continue}O[r]=O[r]?O[r]+(z+u):u}else{ud(r,u);continue}}z="\n";Ka=r}else Ka=void 0,2>l.state||(l.line.buffer=
f(c.slice(b,n),!0),Jf())}}Hb||(2<=l.state&&g(),l.state=0)}function Kf(a){var c,b,d,e,f,g=a.stem;e=a.nhd;if(0!=e){f=.78*Lf[a.head];a.grace&&(f*=.5);0<=g?(c=1,b=e+1,e=a.notes[0].pit):(f=-f,c=e-1,b=-1,e=a.notes[e].pit);for(var m=!1,q=0;c!=b;c+=g){d=a.notes[c].pit-e;e=a.notes[c].pit;if(0==d){if(m){d=a.notes[c].shhd=a.notes[c-g].shhd+f;q<d&&(q=d);continue}if(c+g!=b&&e+g==a.notes[c+g].pit){a.notes[c].shhd=-f;q<-f&&(q=-f);continue}}0>d&&(d=-d);if(3<d||2<=d&&a.head!=h.SQUARE)m=!1;else if(m=!m)a.notes[c].shhd=
f,q<f&&(q=f)}a.xmx=q}}function Mf(a,c){var b,d,e,f,g,m,h=a.length;for(b=h-1;0<=--b;)if((e=a[b].shhd)&&!(0<e))for(e=c-e,g=a[b].pit,d=h;0<=--d;)if(a[d].acc){f=a[d].pit;if(f<g-3)break;!(f>g+3)&&a[d].shac<e&&(a[d].shac=e)}for(b=h;0<=--b;)if(m=a[b].acc){e=a[b].shac;e||(e=a[b].shhd,e=0>e?c-e:c);g=a[b].pit;for(d=h;--d>b;)a[d].acc&&(f=a[d].pit,!(f>=g+4&&(f>g+4||0>m||0>a[d].acc))&&e>a[d].shac-6&&(f=a[d].shac+7,f>e&&(e=f)));a[b].shac=e}}function Kb(a,c){c?(a.ts_next=c,a.ts_prev=c.ts_prev,a.ts_prev&&(a.ts_prev.ts_next=
a),c.ts_prev=a):a.ts_next=a.ts_prev=null}function lb(a){a.next&&(a.next.prev=a.prev);a.prev?a.prev.next=a.next:a.p_v.sym=a.next;a.ts_next&&(a.seqst&&(a.ts_next.seqst?(a.ts_next.shrink+=a.shrink,a.ts_next.space+=a.space):(a.ts_next.seqst=!0,a.ts_next.shrink=a.shrink,a.ts_next.space=a.space)),a.ts_next.ts_prev=a.ts_prev);a.ts_prev&&(a.ts_prev.ts_next=a.ts_next);V==a&&(V=a.ts_next);Sb==a&&(Sb=a.ts_next)}function Nf(a,c,b){var d=a.p_v,e=a.st;a.type==h.BAR&&a.prev&&a.prev.type==h.BAR&&":"!=a.prev.bar_type[0]&&
(a=a.prev);d.last_sym=a.prev;d.last_sym||(d.sym=null);d.time=a.time;d=Zc(d,h.CLEF);d.next=a;a.prev=d;d.clef_type=c;d.clef_line=b;d.st=e;d.clef_small=!0;delete d.second;d.notes=[];d.notes[0]={pit:a.notes[0].pit};for(d.nhd=0;!a.seqst;)a=a.ts_prev;Kb(d,a);d.ts_prev.type!=h.CLEF&&(d.seqst=!0);return d}function Of(a,c,b){var d,e,f=0;for(e=0;e<a.a_gch.length;e++)switch(d=a.a_gch[e],d.type){case "<":d=d.wh[0]+c;d>b&&(b=d);break;case ">":d=d.wh[0]+a.wr,d>f&&(f=d)}a.wr<f&&(a.wr=f);return b}function Pf(a){var c,
b,d,e,f,g;switch(a.type){case h.NOTE:case h.REST:a.wr=e=ch[a.head];0<a.xmx&&(a.wr+=a.xmx+4);for(c=a.prev;c&&0==Ab[c.type];c=c.prev);if(c)switch(c.type){case h.BAR:case h.CLEF:case h.KEY:case h.METER:e+=3}for(b=0;b<=a.nhd;b++)d=a.notes[b].shhd,0>d&&e<-d+5&&(e=-d+5),a.notes[b].acc&&(d=a.notes[b].shac+(a.notes[b].micro?5.5:3.5),e<d&&(e=d));if(c)switch(c.type){case h.BAR:case h.CLEF:case h.KEY:case h.METER:e-=3}a.a_dd&&(e+=qd(a));a.beam_st&&a.beam_end&&0<a.stem&&0<a.nflags&&a.wr<a.xmx+9&&(a.wr=a.xmx+
9);if(a.dots){if(void 0==a.wl)switch(a.head){case h.SQUARE:case h.OVALBARS:a.xmx+=3;break;case h.OVAL:a.xmx+=1}a.wr<a.xmx+8&&(a.wr=a.xmx+8);2<=a.dots&&(a.wr+=3.5*(a.dots-1))}a.trem2&&a.beam_end&&20>e&&(e=20);d=e;if(c)switch(c.type){case h.NOTE:0<c.stem&&0>a.stem&&7>d&&(d=7);(27<a.y&&27<c.y||-3>a.y&&-3>c.y)&&6>d&&(d=6);c.ti1&&14>d&&(d=14);break;case h.CLEF:if(c.second||c.clef_small)break;d+=8;break;case h.KEY:d+=4}a.a_gch&&(d=Of(a,e,d));a.a_ly&&(d=Qf(a,d));a.wl=c&&c.type==h.GRACE?e-4.5:d;return;case h.SPACE:d=
a.width/2;a.wr=d;a.a_gch&&(d=Of(a,d,d));a.a_dd&&(d+=qd(a));a.wl=d;return;case h.BAR:if(a.norepbra)break;d=a.bar_type;switch(d){case "|":e=5;break;default:for(e=2+2.8*d.length,c=0;c<d.length;c++)switch(d[c]){case "[":case "]":e+=3;break;case ":":e+=2}}a.wl=e;a.wr=a.next&&a.next.type!=h.METER?7:5;for(c=a.prev;c;c=c.prev)if(0!=Ab[c.type]){c.type==h.GRACE&&(a.wl-=8);break}a.a_dd&&(a.wl+=qd(a));a.text&&4>a.text.length&&a.next&&a.next.a_gch&&(pa("repeat"),a.wr+=Pa(a.text)[0]+2);return;case h.CLEF:if(a.invis){a.wl=
a.wr=1;return}a.wl=a.clef_small?9:12;a.wr=a.clef_small?7:12;return;case h.KEY:a.wl=3;g=4;if(a.k_a_acc){if(e=f=a.k_a_acc.length)b=a.k_a_acc[0].acc;for(c=1;c<f;c++)d=a.k_a_acc[c],d.pit>a.k_a_acc[c-1].pit+6||d.pit<a.k_a_acc[c-1].pit-6?e--:d.acc!=b&&(g+=3),b=d.acc}else e=a.k_sf,f=a.k_old_sf&&(t.cancelkey||0==e)?a.k_old_sf:0,0<=e*f?(0>e&&(e=-e),0>f&&(f=-f),f>e&&(e=f)):(e-=f,0>e&&(e=-e),g+=3);a.wr=5.5*e+g;return;case h.METER:d=0;a.x_meter=[];for(c=0;c<a.a_meter.length;c++)switch(f=a.a_meter[c],f.top[0]){case "C":case "c":case "o":a.x_meter[c]=
d+6;d+=12;break;case ".":case "|":a.x_meter[c]=a.x_meter[c-1];break;default:e=0;f=!f.bot||f.top.length>f.bot.length?f.top:f.bot;for(b=0;b<f.length;b++)switch(f[b]){case "(":d+=4;case ")":case "1":e+=4;break;default:e+=12}a.x_meter[c]=d+e/2;d+=e}a.wl=0;a.wr=d+6;return;case h.MREST:a.wl=6;a.wr=66;return;case h.GRACE:var m;f=t.gracespace[0];c=t.gracespace[1];b=t.gracespace[2];e=a.extra;a.prev&&a.prev.type==h.BAR&&(f-=3);for(e.beam_st=!0;;e=e.next){Kf(e);Mf(e.notes,7);m=0;for(g=e.nhd;0<=g;g--)e.notes[g].shac>
m&&(m=e.notes[g].shac);f+=m;e.x=f;0>=e.nflags&&(e.beam_st=!0,e.beam_end=!0);g=e.next;if(!g){e.beam_end=!0;break}0>=g.nflags&&(e.beam_end=!0);e.beam_end&&(g.beam_st=!0,f+=c/4);0>=e.nflags&&(f+=c/4);e.y>g.y+8&&(f-=1.5);f+=c}(g=a.next)&&g.type==h.NOTE&&(e.y>=3*(g.notes[g.nhd].pit-18)?--b:e.beam_st&&e.y<3*(g.notes[g.nhd].pit-18)-4&&(b+=2));a.wl=f+b;a.wr=0;a.a_ly&&Qf(a,d);return;case h.STBRK:a.wl=a.xmx;a.next&&a.next.type==h.CLEF?(a.wr=2,delete a.next.clef_small):a.wr=8;return;case h.CUSTOS:a.wl=a.wr=
4;return;case h.TEMPO:pa("tempo");a.tempo_str1&&(a.tempo_wh1=Pa(a.tempo_str1));a.tempo_notes&&(a.tempo_str0="= ",a.tempo_ca&&(a.tempo_str0+=a.tempo_ca),a.tempo&&(a.tempo_str0+=a.tempo),a.tempo_wh0=Pa(a.tempo_str0));a.tempo_str2&&(a.tempo_wh2=Pa(a.tempo_str2));break;case h.BLOCK:case h.PART:case h.REMARK:case h.STAVES:break;default:J(2,a,"set_width - Cannot set width for symbol $1",a.type)}a.wl=a.wr=0}function Rf(a,c){var b,d,e;be>=h.BLEN/2?c=be>=h.BLEN?c/4:c/2:!a.next&&c>=h.BLEN&&(c/=2);b=c>=h.BLEN/
4?c<h.BLEN/2?5:c<h.BLEN?6:c<2*h.BLEN?7:c<4*h.BLEN?8:9:c>=h.BLEN/8?4:c>=h.BLEN/16?3:c>=h.BLEN/32?2:c>=h.BLEN/64?1:0;d=c-(h.BLEN/16/8<<b);e=hb[b];0!=d&&(0>d?e=hb[0]*c/(h.BLEN/16/8):(9<=b&&(b=8),e+=(hb[b+1]-hb[b])*d/c));return e}function Mc(a){var c,b,d=a.ts_prev.time;c=a.time-d;if(0==c){switch(a.type){case h.MREST:return a.wl}return 0}if(a.ts_prev.type==h.MREST)return 71;for(b=Rf(a,c);!a.dur;){switch(a.type){case h.BAR:return.9*b-7;case h.CLEF:return b-a.wl-a.wr;case h.BLOCK:case h.PART:case h.REMARK:case h.STAVES:case h.TEMPO:a=
a.ts_next;if(!a)return b;continue}break}if(a.dur&&c<=h.BLEN/4)for(c=a;c;){if(!c.beam_st){b*=.9;break}c=c.ts_next;if(!c||c.seqst)break}if(a.type==h.NOTE&&-1<=a.nflags&&0<a.stem){var e=!0;for(c=a.ts_prev;c&&c.time==d;c=c.ts_prev)if(c.type==h.NOTE&&(-1>c.nflags||0<c.stem)){e=!1;break}if(e){for(c=a.ts_next;c&&c.time==a.time;c=c.ts_next)if(c.type==h.NOTE&&(-1>c.nflags||0>c.stem)){e=!1;break}e&&(b*=.9)}}return b}function Sf(a){var c={type:h.BAR,bar_type:"|",fname:a.fname,istart:a.istart,iend:a.iend,v:a.v,
p_v:a.p_v,st:a.st,dur:0,seqst:!0,invis:!0,time:a.time+a.dur,nhd:0,notes:[{pit:a.notes[0].pit}],wl:0,wr:0,prev:a,ts_prev:a,shrink:a.wr+3};return a.next=a.ts_next=c}function Nc(a){a.type=h.REST;delete a.in_tuplet;delete a.sl1;delete a.sl2;delete a.a_dd;delete a.a_gch;a.slur_start=a.slur_end=0}function dh(a){var c,b,d,e,f,g=a.repeat_n,m=a.repeat_k,q=a.st,n=a.v;a.repeat_n=0;if(0>g){d=g=-g;for(b=a.prev;b;b=b.prev)if(!b.dur){if(b.type==h.BAR){J(1,b,"Bar in repeat sequence");return}}else if(0>=--d)break;
if(b){f=a.time-b.time;d=m*g;for(c=a;c;c=c.next)if(!c.dur){if(c.type==h.BAR){J(1,c,"Bar in repeat sequence");return}}else if(0>=--d)break;if(c&&c.next){for(c=a.prev;c!=b;c=c.prev)if(c.type==h.NOTE){c.beam_end=!0;break}for(e=m;0<=--e;){d=g;a.dur&&d--;for(c=a.ts_next;0<d;)c.st==q&&(lb(c),c.v==n&&c.dur&&d--),c=c.ts_next;Nc(a);a.dur=a.notes[0].dur=f;a.rep_nb=-1;a.beam_st=!0;Z.set_width(a);a.seqst&&(a.space=Mc(a));a.head=h.SQUARE;for(a=c;a&&(a.st!=q||a.v!=n||!a.dur);a=a.ts_next);}}else J(1,a,N.not_enough_n)}else J(1,
a,N.not_enough_n)}else{d=g;for(c=a.prev.prev;c&&(c.type!=h.BAR&&c.time!=V.time||!(0>=--d));c=c.prev);if(c){f=a.time-c.time;d=1==g?m:g;for(c=a;c&&!(c.type==h.BAR&&0>=--d);c=c.next);if(c){d=m;if(2==g&&1<d){c=c.next;if(!c){J(1,a,N.not_enough_m);return}c.repeat_n=g;c.repeat_k=--d}f/=g;if(2==g){b=a;for(c=a.ts_next;;c=c.ts_next)if(c.st==q){if(c.v==n&&c.type==h.BAR)break;lb(c)}Nc(b);b.dur=b.notes[0].dur=f;b.invis=!0;b.seqst&&(b.space=Mc(b));c.bar_mrep=2;c.seqst&&(c.space=Mc(c));b=c.next;for(c=b.ts_next;;c=
c.ts_next)if(c.st==q){if(c.v==n&&c.type==h.BAR)break;lb(c)}Nc(b);b.dur=b.notes[0].dur=f;b.invis=!0;Z.set_width(b);b.seqst&&(b.space=Mc(b));c.seqst&&(c.space=Mc(c))}else for(b=a,e=m;0<=--e;){for(c=b.ts_next;;c=c.ts_next)if(c.st==q){if(c.v==n&&c.type==h.BAR)break;lb(c)}Nc(b);b.dur=b.notes[0].dur=f;b.beam_st=!0;b.seqst&&(b.space=Mc(b));c.seqst&&(c.space=Mc(c));if(1==m){b.rep_nb=1;break}b.rep_nb=m-e+1;b=c.next}}else J(1,a,N.not_enough_m)}else J(1,a,N.not_enough_m)}}function Ne(a,c){function b(a){if(t.custos&&
1==x.length)a:{for(var b,c,d=a;d.type!=h.NOTE;)if(d=d.next,!d)break a;b=a.p_v;b.last_sym=a.prev;b.time=a.time;b=Zc(b,h.CUSTOS);b.next=a;a.prev=b;Kb(b,a);b.seqst=!0;b.shrink=a.shrink;12>b.shrink&&(b.shrink=12);b.space=d.space;b.wl=0;b.wr=4;b.nhd=d.nhd;b.notes=[];for(c=0;c<a.notes.length;c++)b.notes[c]={pit:d.notes[c].pit,shhd:0,dur:h.BLEN/4};b.stemless=!0}a.nl=!0}function d(a){if(!a.next)return b(a),a;for(a=a.ts_next;a;a=a.ts_next)if(a.seqst){b(a);break}return a}for(var e,f;a;){if(!a.ts_next)return;
if(a.ts_next.seqst)break;a=a.ts_next}if(t.keywarn||t.timewarn)for(e=a.ts_next;e;e=e.ts_next){switch(e.type){case h.BAR:case h.CLEF:continue;case h.KEY:if(!t.keywarn)continue;case h.METER:if(e.type==h.METER&&!t.timewarn)continue;f=e.ts_prev;if(f==a){a=e;continue}lb(e);Kb(e,a.ts_next);for(a=e;;)if(e=e.ts_prev,e.v==a.v){a.next=e.next;a.prev=e;a.next.prev=a;e.next=a;break}a.type!=a.ts_prev.type?a.seqst||(a.seqst=!0,a.shrink=a.wl+a.prev.wr,a.space=a.ts_next.space,a.ts_next.space=0):delete a.seqst;e=f;
continue}if(Ab[e.type])break}if(c)return d(a);switch(a.type){case h.CLEF:case h.BAR:case h.STAVES:break;case h.GRACE:if(a=a.next,!a)return a;default:return d(a)}for(;a&&(!a.seqst||a.type==h.CLEF);a=a.ts_prev);for(e=0;;a=a.ts_next){if(!a)return a;if(a.seqst){if(0>e)break;switch(a.type){case h.STAVES:if(a.ts_prev&&a.ts_prev.type==h.BAR)break;for(;a.ts_next&&(0==Ab[a.ts_next.type]||a.ts_next.type==h.CLEF);)a=a.ts_next;if(!a.ts_next||a.ts_next.type!=h.BAR)continue;a=a.ts_next;case h.BAR:if(e)break;e=
1;continue;case h.STBRK:a.stbrk_forced?e=-1:lb(a);continue;case h.CLEF:if(e)break;continue;default:if(!e||a.prev&&a.prev.type==h.GRACE)continue}break}}b(a);return a}function Tf(){var a=x[0];Z.set_width(a.clef);Z.set_width(a.key);Z.set_width(a.meter);return[a.clef.wl+a.clef.wr+a.key.wl+a.key.wr,a.meter.wl+a.meter.wr]}function Uf(a,c){var b,d,e=0,f=1-t.maxshrink;do{a.seqst&&(b=a.shrink,e=(d=a.space)<b?e+b:e+(b*t.maxshrink+d*f),a.x=e);if(a==c)break;a=a.ts_next}while(a);return e}function vd(a){switch(a.type){case h.CLEF:if(a.second||
a.invis){a.ymx=a.ymn=12;break}a.y=6*(a.clef_line-1);switch(a.clef_type){default:a.ymx=a.y+28;a.ymn=a.y-14;break;case "c":a.ymx=a.y+13;a.ymn=a.y-11;break;case "b":a.ymx=a.y+7,a.ymn=a.y-12}a.clef_small&&(a.ymx-=2,a.ymn+=2);26>a.ymx&&(a.ymx=26);-1<a.ymn&&(a.ymn=-1);a.clef_octave&&(0<a.clef_octave?a.ymx+=12:a.ymn-=12);break;case h.KEY:a.ymx=2<a.k_sf?34:0<a.k_sf?30:26;a.ymn=-2;break;default:a.ymx=24,a.ymn=0}}function eh(){function a(a,b,c){var d=["15mb(","8vb(",null,"8va(","15ma("],e=["15mb)","8vb)",null,
"8va)","15ma)"];tc([(c?d:e)[2+b]],a)}var c,b,d,e=R+1,f=new Int16Array(Array(2*e)),g=new Int8Array(Array(e));for(b=0;b<=R;b++)f[b]=0,g[b]=0;for(c=V;c;c=c.ts_next){b=c.st;if(void 0!=c.ottava)for(;c.ottava.length;)c.ottava[0]?0==g[b]++&&(a(c,c.ottava[0],!0),f[b]=7*-c.ottava[0]):0==--g[b]&&(a(c,-f[b]/7),f[b]=0),c.ottava.shift();switch(c.type){case h.REST:if(1==x.length)break;case h.NOTE:if(b=f[b],0!=b&&!c.p_v.key.k_drum)for(e=c.nhd;0<=e;e--)d=c.notes[e],d.opit=d.pit,d.pit+=b}}}function lf(a,c,b){var d,
e,f,g;f=12;e=20;for(d=c;d&&(d.type!=h.STAVES||d==c);d=d.ts_next)if(d.st==a)if(d.type!=h.NOTE){if(d.type==h.CLEF){if("a"!=d.clef_type)break;lb(d)}}else d.notes[0].pit<e?e=d.notes[0].pit:d.notes[d.nhd].pit>f&&(f=d.notes[d.nhd].pit);if(19<=e||13<=e&&"b"!=b)return"t";if(13>=f||19>=f&&"t"!=b)return"b";"a"==b&&(b=16<=(f+e)/2?"t":"b");f=b;var m=d,q=null;for(d=c;d!=m&&(d.type!=h.STAVES||d==c);d=d.ts_next)if(d.st==a&&d.type==h.NOTE){g=d.time;if("t"==f){if(12<d.notes[0].pit||20<d.notes[d.nhd].pit){20<d.notes[0].pit&&
(q=d);continue}if((e=d.ts_prev)&&e.time==g&&e.st==a&&e.type==h.NOTE&&19<=e.notes[0].pit)continue;if((e=d.ts_next)&&e.st==a&&e.time==g&&e.type==h.NOTE&&19<=e.notes[0].pit)continue}else{if(12>d.notes[0].pit||20>d.notes[d.nhd].pit){12>d.notes[d.nhd].pit&&(q=d);continue}if((e=d.ts_prev)&&e.time==g&&e.st==a&&e.type==h.NOTE&&13>=e.notes[0].pit)continue;if((e=d.ts_next)&&e.st==a&&e.time==g&&e.type==h.NOTE&&13>=e.notes[0].pit)continue}if(q){g=d;for(e=d.ts_prev;e!=q;e=e.ts_prev)if(e.st==a){if(e.type==h.BAR&&
e.v==d.v){g=":"!=e.bar_type[0]?e:e.next;break}e.type==h.NOTE&&e.beam_st&&!e.p_v.second&&(g=e)}g.time==q.time?q=d:(q=d,f="t"==f?"b":"t",e=Nf(g,f,"t"==f?2:4),e.clef_auto=!0)}else f=b="t"==f?"b":"t",q=d}return b}function Vf(a,c,b){var d={type:a,fname:b.fname,v:c.v,p_v:c,st:c.st,time:b.time,next:c.last_sym.next};d.next&&(d.next.prev=d);c.last_sym.next=d;d.prev=c.last_sym;c.last_sym=d;Kb(d,b);d.ts_prev.type!=a&&(d.seqst=!0);b.type==a&&d.v!=b.v&&(delete b.seqst,b.shrink=0);return d}function fh(){var a,
c,b,d,e,f=x.length;for(e=0;e<f;e++)if(!(0>E.voices[e].range)){a=x[e];a.second=E.voices[e].second;a.last_sym=a.sym;for(b=E.voices[e].st;b<R&&!E.st_print[b];)b++;a.st=b}for(d=V;d&&d.type==h.CLEF;)e=d.v,0<=E.voices[e].range&&!E.voices[e].second&&(delete d.clef_small,a=d.p_v,a.last_sym=a.sym=d),d=d.ts_next;for(e=0;e<f;e++)a=x[e],a.sym&&a.sym.type==h.CLEF||0>E.voices[e].range||E.voices[e].second&&!a.bar_start||(b=E.voices[e].st,u[b]&&u[b].clef&&(c=A(u[b].clef),c.v=e,c.p_v=a,c.st=b,c.time=V.time,c.prev=
null,c.next=a.sym,c.next&&(c.next.prev=c),a.sym=c,a.last_sym=c,c.ts_next=d,c.ts_prev=d?d.ts_prev:null,c.ts_prev?(c.ts_prev.ts_next=c,delete c.seqst):(V=c,c.seqst=!0),d&&(d.ts_prev=c,d.type==h.CLEF&&delete d.seqst),delete c.clef_small,c.second=E.voices[e].second,E.st_print[b]||(c.invis=!0)));for(e=0;e<f;e++)if(!(0>E.voices[e].range||E.voices[e].second)&&E.st_print[E.voices[e].st])if(a=x[e],d&&d.v==e&&d.type==h.KEY)a.last_sym=d,d.k_old_sf=d.k_sf,d=d.ts_next;else if(b=a.key,b.k_sf||b.k_a_acc)c=Vf(h.KEY,
a,d),c.k_sf=b.k_sf,c.k_old_sf=b.k_sf,c.k_none=b.k_none,c.k_a_acc=b.k_a_acc,c.istart=b.istart,c.iend=b.iend,b.k_bagpipe&&(c.k_bagpipe=b.k_bagpipe,"p"==c.k_bagpipe&&(c.k_old_sf=3));if(ce&1){for(e=0;e<f;e++)a=x[e],b=a.meter,0>E.voices[e].range||E.voices[e].second||!E.st_print[E.voices[e].st]||0==b.a_meter.length||(d&&d.v==e&&d.type==h.METER?(a.last_sym=d,d=d.ts_next):(c=Vf(h.METER,a,d),c.istart=b.istart,c.iend=b.iend,c.wmeasure=b.wmeasure,c.a_meter=b.a_meter));ce&=-2}for(e=0;e<f;e++)a=x[e],b=a.bar_start,
a.bar_start=null,d&&d.v==e&&d.type==h.BAR?(a.last_sym=d,d=d.ts_next):!b||0>E.voices[e].range||!E.st_print[E.voices[e].st]||(b.next=a.last_sym.next,b.next&&(b.next.prev=b),a.last_sym.next=b,b.prev=a.last_sym,a.last_sym=b,Kb(b,d),b.time=V.time,b.ts_prev.type!=b.type&&(b.seqst=!0),d&&d.type==b.type&&b.v!=d.v&&delete d.seqst);Z.set_pitch(d);for(c=V;;){b=c;e=0;do Z.set_width(c),a=c.wl,c.prev&&(a+=c.prev.wr),a>e&&(e=a),c=c.ts_next;while(c!=d&&!c.seqst);b.shrink=e;b.space=0;if(c==d)break}if(c){a=0;do Z.set_width(c),
a<c.wl&&(a=c.wl),c=c.ts_next;while(c&&!c.seqst);d.shrink=b.wr+a}}function mf(a){var c,b,d,e,f,g=x.length,m=0;for(c=0;c<g;c++)if(b=x[c],!(0>E.voices[c].range)&&(d=(a||b.new_name)&&b.nm?b.nm:b.snm))for(f||(pa("voice"),f=D.curfont),b=0;;){e=d.indexOf("\\n",b);b=0>e?Pa(d.slice(b)):Pa(d.slice(b,e));b=b[0];b>m&&(m=b);if(0>e)break;b=e+1}f&&(m+=4*$c(" ")*D.curfont.swfac);b=.5;for(c=0;c<=E.nstaff;c++){if(E.staves[c].flags&1280){b=12;break}E.staves[c].flags&5&&(b=6)}m+=b;a&&(m+=t.indent);return m}function gh(a,
c){var b,d,e,f,g,m,q,n,k;if(a.shiftunison&&3<=a.shiftunison||(e=a.dur)>=h.BLEN||(f=c.dur)>=h.BLEN||a.stemless&&c.stemless||a.dots!=c.dots&&(a.shiftunison&&a.shiftunison&1||0!=a.dots*c.dots)||0<a.stem*c.stem)return!1;b=d=0;if(a.notes[0].pit>c.notes[0].pit){if(0>a.stem)return!1;for(;c.notes[d].pit!=a.notes[0].pit;)if(++d>c.nhd)return!1}else if(a.notes[0].pit<c.notes[0].pit){if(0>c.stem)return!1;for(;c.notes[0].pit!=a.notes[b].pit;)if(++b>a.nhd)return!1}if(c.notes[d].acc!=a.notes[b].acc)return!1;g=b;
q=d;n=a.notes[b].shhd;k=c.notes[d].shhd;do{b++;d++;if(b>a.nhd)break;if(d>c.nhd)break;if(c.notes[d].acc!=a.notes[b].acc)return!1;n<a.notes[b].shhd&&(n=a.notes[b].shhd);k<c.notes[d].shhd&&(k=c.notes[d].shhd)}while(c.notes[d].pit==a.notes[b].pit);if(b<=a.nhd){if(d<=c.nhd||0<c.stem)return!1}else if(d<=c.nhd&&0<a.stem)return!1;m=b;b=d;d=0;if(e!=f)if(e<f&&(e=f,f=a.dur),e<h.BLEN/2)c.dots?d=2:a.dots&&(d=1);else if(f<h.BLEN/4){if(a.shiftunison&&a.shiftunison&2)return!1;d=c.dur>=h.BLEN/2?2:1}else return!1;
0==d&&(d=a.p_v.scale<c.p_v.scale?2:1);if(1==d){for(d=q;d<b;d++)c.notes[d].invis=!0,delete c.notes[d].acc;for(d=0;d<=c.nhd;d++)c.notes[d].shhd+=n}else{for(b=g;b<m;b++)a.notes[b].invis=!0,delete a.notes[b].acc;for(b=0;b<=a.nhd;b++)a.notes[b].shhd+=k}return!0}function nf(a){var c,b,d,e=Oe[a.head],f=e,g=[];for(b=0;96>b;b++)g.push(-100);if(-2<a.nflags)for(0<a.stem?(f=-f,b=2*a.notes[0].pit,c=2*(Math.ceil((a.ymx-2)/3)+18)):(b=2*(Math.ceil((a.ymn+2)/3)+18),c=2*a.notes[a.nhd].pit),0>b&&(b=0),96<=c&&(c=95);b<=
c;)g[b++]=f;d=a.notes[0<a.stem?0:a.nhd].shhd;for(c=0;c<=a.nhd;c++)f=-a.notes[c].shhd+e+d,b=2*a.notes[c].pit,0>b?b=0:95<=b&&(b=94),f>g[b]&&(g[b]=f),a.head!=h.SQUARE&&--f,f>g[b-1]&&(g[b-1]=f),f>g[b+1]&&(g[b+1]=f);return g}function of(a){var c,b,d,e=Oe[a.head],f=e,g=0<a.nflags&&a.beam_st&&a.beam_end,m=[];for(b=0;96>b;b++)m.push(-100);if(-2<a.nflags)for(0>a.stem?(f=-f,b=2*(Math.ceil((a.ymn+2)/3)+18),c=2*a.notes[a.nhd].pit,d=b+4):(b=2*a.notes[0].pit,c=2*(Math.ceil((a.ymx-2)/3)+18)),0>b&&(b=0),96<c&&(c=
96);b<c;)m[b++]=f;if(g)if(0<a.stem)for(b=0==a.xmx?2*a.notes[a.nhd].pit:2*a.notes[0].pit,b+=4,0>b&&(b=0);96>b&&b<=c-4;b++)m[b]=11;else for(b=d,0>b&&(b=0);96>b&&b<=2*a.notes[0].pit-4;b++)m[b]=3.5;d=a.notes[0<a.stem?0:a.nhd].shhd;for(c=0;c<=a.nhd;c++)f=a.notes[c].shhd+e-d,b=2*a.notes[c].pit,0>b?b=0:95<=b&&(b=94),f>m[b]&&(m[b]=f),a.head!=h.SQUARE&&--f,f>m[b-1]&&(m[b-1]=f),f>m[b+1]&&(m[b+1]=f);return m}function hh(a){for(var c,b,d=a.p_v;a.type==h.CLEF||a.type==h.KEY||a.type==h.METER;)if(a.type==h.METER&&
a.time>d.sym.time&&(ce|=1),a=a.prev,!a)return;if(a.type==h.BAR&&(void 0!=a.text&&(d.bar_start=A(a),d.bar_start.bar_type="",delete a.text,delete a.a_gch),c=a.bar_type,":"!=c&&":"==c.slice(-1)))if(d.bar_start||(d.bar_start=A(a)),":"!=c[0]){if("||:"==c)return d.bar_start.bar_type="[|:",a.bar_type="||",!0;d.bar_start.bar_type=c;a.prev&&a.prev.type==h.BAR?lb(a):a.bar_type="|"}else{for(b=0;":"==c[b];)b++;if(b<c.length){a.bar_type=c.slice(0,b)+"|]";for(b=c.length-1;":"==c[b];)b--;d.bar_start.bar_type="[|"+
c.slice(b+1)}else b=c.length/2|0,a.bar_type=c.slice(0,b)+"|]",d.bar_start.bar_type="[|"+c.slice(b);return!0}}function ih(a){for(var c=V;c&&!c.nl;c=c.ts_next)c.st==a&&c.type!=h.CLEF&&(c.st++,c.invis=!0)}function Wf(a){switch(a.subtype){case "leftmargin":case "rightmargin":case "pagescale":case "pagewidth":case "scale":case "staffwidth":wd();Z.set_format(a.subtype,a.param);break;case "ml":wd();w.img_out(a.text);break;case "newpage":Lc();Va.newpage=!0;Ib();break;case "sep":rb();ia(a.sk1);z+='<path class="stroke"\n\td="M';
kb(a.x," ",0);z+="h"+a.l.toFixed(1)+'"/>\n';ia(a.sk2);break;case "text":xd(a.text,a.opt);break;case "title":yd(a.text,!0);break;case "vskip":ia(a.sk);break;default:J(2,a,"Block $1 not treated",a.subtype)}}function jh(){function a(a){var b=u[a],c=k.staves[a];b||(b=u[a]={});b.y=0;b.stafflines=c.stafflines;b.staffscale=c.staffscale;b.ann_top=b.ann_bot=0}function c(){var a,b,c,d=k.staves.length;for(a=0;a<d;a++)if(k.staves[a].flags&257){c=0;for(b=a;a<d;){c|=q[a]?1:2;if(k.staves[a].flags&514)break;a++}if(3==
c)for(;b<=a;)q[b]=!0,n[b++]=!0}}var b,d,e,f,g,m,q=[],n=[],k=E;R=f=k.nstaff;for(e=0;e<=f;e++)a(e);for(b=V;b&&!b.nl;b=b.ts_next){b.ts_next||(d=b);switch(b.type){case h.STAVES:c();k.st_print=new Uint8Array(q);k=b.sy;f=k.nstaff;if(R<f){for(e=R+1;e<=f;e++)a(e);R=f}q=[];continue;case h.BLOCK:Pe.push(b);lb(b);d&&(d=b.ts_prev);continue}e=b.st;if(!q[e]){switch(b.type){default:continue;case h.CLEF:e>R&&(u[e].clef=b,lb(b));continue;case h.BAR:if(b.bar_mrep||1<k.staves[e].staffnonote)break;continue;case h.GRACE:break;
case h.NOTE:case h.REST:case h.SPACE:case h.MREST:if(!(1<k.staves[e].staffnonote)){if(b.invis)continue;if(0==k.staves[e].staffnonote&&b.type!=h.NOTE)continue}}n[e]=q[e]=!0}}Sb=b;c();k.st_print=new Uint8Array(q);(function(){var a,b,c,d;for(a=0;a<=R;a++)if(b=u[a],n[a]){d=b.stafflines.length;b.topbar=6*(d-1);for(c=0;c<d-1&&"."==b.stafflines[c];c++);b.botline=b.botbar=6*c;c>=d-2&&("."!=b.stafflines[c]?(b.botbar-=6,b.topbar+=6):(b.botbar-=12,b.topbar+=12))}else b.botbar=b.topbar=0})();for(e=0;e<R;e++)n[e]||
ih(e);n[R]||(u[R].topbar=0);fh();D.st_print=new Uint8Array(n);if(Sb)for(b=Sb,delete b.nl,d=b.ts_prev,d.ts_next=null,g=x.length,f=0;f<g;f++){e=x[f];if(e.sym&&e.sym.time<=Sb.time){for(b=Sb.ts_prev;b;b=b.ts_prev)if(b.v==f){e.s_next=b.next;b.next=null;hh(b)&&(m=b.wl,Z.set_width(b),b.shrink+=b.wl-m);break}if(b)continue}e.s_next=e.sym;e.sym=null}d.type!=h.BAR&&(b=Sf(d),b.space=Mc(b),b.space<b.shrink&&d.type!=h.KEY&&(b.space=b.shrink))}function Xf(){for(var a=V,c=a.time;a;a=a.ts_next){if(a.time!=c){rb();
return}switch(a.type){case h.NOTE:case h.REST:case h.MREST:rb();return;default:continue;case h.STAVES:E=a.sy;break;case h.BLOCK:Wf(a)}lb(a);a.p_v.s_next==a&&(a.p_v.s_next=a.next)}V=null}function wc(a){a.fname=l.fname;a.istart=l.istart;a.iend=l.iend}function Yf(a){var c={type:h.CLEF,clef_line:2,clef_type:"t",v:k.v,p_v:k,time:k.time,dur:0},b=1;wc(c);switch(a[0]){case '"':b=a.indexOf('"',1);c.clef_name=a.slice(1,b);b++;break;case "a":if("u"==a[1]){c.clef_type="a";c.clef_auto=!0;b=4;break}b=4;case "C":c.clef_type=
"c";c.clef_line=3;break;case "b":b=4;case "F":c.clef_type="b";c.clef_line=4;break;case "n":b=4;c.invis=!0;break;case "t":if("e"==a[1]){c.clef_type="c";c.clef_line=4;break}b=6;case "G":break;case "p":b=4;case "P":c.clef_type="p";c.clef_line=3;k.key.k_sf=0;k.ckey.k_drum=!0;break;default:p(1,"Unknown clef '$1'",a);return}"1"<=a[b]&&"9">=a[b]&&(c.clef_line=Number(a[b]),b++);if("8"!=a[b+1])return c;switch(a[b]){case "^":c.clef_oct_transp=!0;case "+":c.clef_octave=7;break;case "_":c.clef_oct_transp=!0;
case "-":c.clef_octave=-7}return c}function xc(a,c){var b,d,e,f,g=[];if("0"==a[0])return 0;if(0<="123456789-+".indexOf(a[0])){d=3*parseInt(a);if(isNaN(d)||-108>d||108<d){p(1,"Bad transpose value");return}switch(a.slice(-1)){default:return d;case "#":d++;break;case "b":d+=2}return 0<d?d:d-3}if("instr"==c)if(e=a.indexOf("/"),t.sound)a=0>e?"c"+a:a.replace(/.*\//,"c");else{if(0>e)return 0;a=a.replace("/","")}e=new qa;e.buffer=a;for(b=0;2>b;b++){f=e.buffer[e.index]?nc(e):null;if(!f){p(1,"Bad transpose value");
return}f.pit+=124;d=12*(f.pit/7|0)+kh[f.pit%7];f.acc&&3!=f.acc&&(d+=f.acc);g[b]=d}d=3*(g[1]-g[0]);if(f)switch(f.acc){default:return d;case 2:case 1:d++;break;case -1:case -2:d+=2}return 0<d?d:d-3}function Zf(a){var c,b;if(c=a.match(/(.*?)[= ]*([!"].*[!"])/))if(a=c[1],b=c[2],b.slice(-1)!=b[0])p(1,"Lack of ending $1 in U:/%%user",b[0]);else if("\\"==a[0]&&("t"==a[1]?a="\t":a[1]||(a=" ")),c=a.charCodeAt(0),128<=c)p(1,N.not_ascii);else{switch(Za[c][0]){case "0":case "d":case "i":case " ":break;case '"':case "!":if(1<
Za[c].length)break;default:p(1,"Bad user character '$1'",a);return}switch(b){case "!beambreak!":b=" ";break;case "!ignore!":b="i";break;case "!nil!":case "!none!":b="d"}Za[c]=b}else p(1,'Lack of starting ! or " in U: / %%user')}function lh(a){if(a){if(/^[\]\[|.-]+$/.test(a))return a.replace(/\]/g,"[");a=parseInt(a);switch(a){case 0:return"...";case 1:return"..|";case 2:return".||";case 3:return".|||"}if(!(isNaN(a)||0>a||16<a))return"||||||||||||||||".slice(0,a)}}function Ub(a){a={type:h.BLOCK,subtype:a,
dur:0};2==l.state&&$a();var c=k;k=x[G.top_voice];ba(a);k=c;return a}function de(a){k.init||(k.init=!0,O.V&&(O.V["*"]&&(a=O.V["*"].concat(a)),O.V[k.id]&&(a=O.V[k.id].concat(a))));0!=a.length&&Z.set_vp(a)}function $f(a,c){0!=c.length&&(O.V||(O.V={}),O.V[a]?Array.prototype.push.apply(O.V[a],c):O.V[a]=c)}function ud(a,c){var b,d,e;switch(a){case "I":Z.do_pscom(c);break;case "L":2==l.state&&$a();if(b=c.match(/^1\/(\d+)(=(\d+)\/(\d+))?$/)){d=Number(b[1]);if(!d||0!=(d&d-1))break;d=h.BLEN/d;if(b[2]){e=Number(b[4]);
if(!e||0!=(e&e-1))break;e=Number(b[3])/e*h.BLEN}else e=d}else"auto"==c&&(d=e=-1);if(!e){p(1,"Bad L: value");break}2>l.state?za.ulen=d:(k.ulen=d,k.dur_fact=e/d);break;case "M":a:{b={type:h.METER,dur:0,a_meter:[]};e={};var f,g=0,m=0,q,n;wc(b);if(0==c.indexOf("none"))m=4,d=1;else for(d=0;m<c.length&&"="!=c[m];){switch(c[m]){case "C":e.top=c[m++];g||(f=g=4);break;case "c":case "o":e.top=c[m++];if(!g)switch(g="c"==c[m-1]?2:3,f=4,c[m]){case "|":f/=2;break;case ".":g*=3,f*=2}break;case ".":case "|":g=0;
e.top=c[m++];break;case "(":"("==c[m+1]&&(n=!0,e.top=c[m++],b.a_meter.push(e),e={});for(q=m+1;q<c.length&&")"!=c[q]&&"/"!=c[q];)q++;if(")"==c[q]&&"/"==c[q+1]){m++;continue}case ")":n="("==c[m];e.top=c[m++];b.a_meter.push(e);e={};continue;default:if("0">=c[m]||"9"<c[m]){p(1,"Bad char '$1' in M:",c[m]);break a}f=2;for(e.top=c[m++];;){for(;"0"<=c[m]&&"9">=c[m];)e.top+=c[m++];if(")"==c[m]){if("/"!=c[m+1])break;m++}if("/"==c[m]){m++;if("0">=c[m]||"9"<c[m]){p(1,"Bad char '$1' in M:",c[m]);break a}for(e.bot=
c[m++];"0"<=c[m]&&"9">=c[m];)e.bot+=c[m++];break}if(" "!=c[m]&&"+"!=c[m])break;if(m>=c.length||"("==c[m+1])break;e.top+=c[m++]}g=parseInt(e.top)}n||(e.bot&&(f=parseInt(e.bot)),d+=g*h.BLEN/f);b.a_meter.push(e);for(e={};" "==c[m];)m++;"+"==c[m]&&(e.top=c[m++],b.a_meter.push(e),e={})}if("="==c[m]){f=c.substring(++m).match(/^(\d+)\/(\d+)$/);if(!f){p(1,"Bad duration '$1' in M:",c.substring(m));break a}d=h.BLEN*f[1]/f[2]}b.wmeasure=d;0>t.writefields.indexOf("M")&&(b.a_meter=[]);if(3!=l.state){if(O.M=c,
za.meter=b,1<=l.state)for(za.ulen||(za.ulen=1>=d||d>=3*h.BLEN/4?h.BLEN/8:h.BLEN/16),f=0;f<x.length;f++)x[f].meter=b,x[f].wmeasure=d}else k.wmeasure=d,ue()?(k.meter=b,ce=0<=t.writefields.indexOf("M")?3:2):ba(b)}break;case "U":Zf(c);break;case "P":if(0==l.state)break;if(1==l.state){O.P=c;break}2==l.state&&$a();if(0>t.writefields.indexOf(a))break;b={type:h.PART,text:c,dur:0};f=x[G.top_voice];k.v!=f.v?k.time!=f.time||f.last_sym&&f.last_sym.type==h.PART||(n=k,k=f,ba(b),k=n):ba(b);break;case "Q":if(0==
l.state)break;a:{n=0;f={type:h.TEMPO,dur:0};wc(f);0>t.writefields.indexOf("Q")&&(f.del=!0);if('"'==c[0]){n=c.indexOf('"',1);if(0>n){p(1,"Unterminated string in Q:");break a}f.tempo_str1=c.slice(1,n);for(n++;" "==c[n];)n++}b=new qa;b.buffer=c;for(b.index=n;;){m=c[b.index];if(void 0==m||"0">=m||"9"<m)break;n=Lb(b);f.tempo_notes||(f.tempo_notes=[]);for(f.tempo_notes.push(h.BLEN*n[0]/n[1]);;){m=c[b.index];if(" "!=m)break;b.index++}}if("="==m){for(m=c[++b.index];" "==m;)m=c[++b.index];n=b.index;"c"==m&&
"a"==c[n+1]&&"."==c[n+2]&&" "==c[n+3]&&(f.tempo_ca="ca. ",b.index+=4);"/"!=c[b.index+1]?f.tempo=b.get_int():(n=Lb(b),f.new_beat=h.BLEN*n[0]/n[1]);for(m=c[b.index];" "==m;)m=c[++b.index]}if('"'==m){b.index++;n=c.indexOf('"',b.index+1);if(0>n){p(1,"Unterminated string in Q:");break a}f.tempo_str2=c.slice(b.index,n)}if(3!=l.state){if(1==l.state){O.Q=c;za.tempo=f;break a}$a()}k.v==G.top_voice&&(ba(f),za.tempo&&0==k.time&&(za.tempo.del=!0))}break;case "V":zd(c);break;case "K":if(0==l.state)break;a:{b:{f=
c;n=0;d={type:h.KEY,k_delta:0,dur:0};wc(d);e=1;switch(f[0]){case "A":d.k_sf=3;break;case "B":d.k_sf=5;break;case "C":d.k_sf=0;break;case "D":d.k_sf=2;break;case "E":d.k_sf=4;break;case "F":d.k_sf=-1;break;case "G":d.k_sf=1;break;case "H":switch(f[1]){case "P":case "p":d.k_bagpipe=f[1];d.k_sf="P"==f[1]?0:2;e++;break;default:p(1,"Unknown bagpipe-like key")}break;case "P":p(1,"K:P is deprecated");m=d.k_drum=!0;break;case "n":0==f.indexOf("none")&&(d.k_sf=0,d.k_none=!0,e=4);default:m=!0}if(!m){switch(f[e]){case "#":d.k_sf+=
7;e++;break;case "b":d.k_sf-=7,e++}f=f.slice(e).trim();switch(f.slice(0,3).toLowerCase()){default:if("m"!=f[0]||" "!=f[1]&&"\t"!=f[1]&&"\n"!=f[1]){m=!0;break}case "aeo":case "m":case "min":d.k_sf-=3;n=5;break;case "dor":d.k_sf-=2;n=1;break;case "ion":case "maj":break;case "loc":d.k_sf-=5;n=6;break;case "lyd":d.k_sf+=1;n=3;break;case "mix":--d.k_sf;n=4;break;case "phr":d.k_sf-=4,n=2}m||(f=f.replace(/\w+\s*/,""));0==f.indexOf("exp ")&&((f=f.replace(/\w+\s*/,""))||p(1,"No accidental after 'exp'"),d.k_exp=
!0);e=f[0];if("^"==e||"_"==e||"="==e){d.k_a_acc=[];m=new qa;m.buffer=f;do{e=nc(m);if(!e){n=[d,null];break b}d.k_a_acc.push(e);for(e=f[m.index];" "==e;)e=f[++m.index]}while("^"==e||"_"==e||"="==e);f=f.slice(m.index)}else d.k_exp&&0==f.indexOf("none")&&(d.k_sf=0,f=f.replace(/\w+\s*/,""))}d.k_delta=Mb[(d.k_sf+7)%7];d.k_mode=n;n=[d,Jc(f)]}f=n[0];n=n[1];if(f.k_sf&&!f.k_exp&&f.k_a_acc){var B=[],r=[],v=[],Ka=[];if(0<f.k_sf)for(g=0;g<f.k_sf;g++)B[g]=1,r[g]=[26,23,27,24,21,25,22][g];else for(g=0;g<-f.k_sf;g++)B[g]=
-1,r[g]=[22,25,21,24,20,23,26][g];e=f.k_a_acc.length;for(m=0;m<e;m++){q=f.k_a_acc[m];for(d=0;d<g;d++)if(r[d]==q.pit){B[d]=q.acc;q.micro_n&&(v[d]=q.micro_n,Ka[d]=q.micro_d);break}d==g&&(B[d]=q.acc,r[d]=q.pit,q.micro_n&&(v[d]=q.micro_n,Ka[d]=q.micro_d),g++)}for(m=0;m<g;m++)(q=f.k_a_acc[m])||(q=f.k_a_acc[m]={}),q.acc=B[m],q.pit=r[m],v[m]?(q.micro_n=v[m],q.micro_d=Ka[m]):(delete q.micro_n,delete q.micro_d)}switch(l.state){case 1:void 0!=f.k_sf||f.k_a_acc||(f.k_sf=0,f.k_none=!0);for(b=0;b<x.length;b++)m=
x[b],m.key=A(f),m.okey=A(f),m.ckey=A(f);l.ckey=f;0!=n.length&&$f("*",n);za.ulen||(za.ulen=h.BLEN/8);l.state=2;break a;case 2:$a(!0)}0!=n.length&&de(n);k.ckey.k_bagpipe||k.ckey.k_drum||(b=(t.transp||0)+(k.transp||0)+(k.shift||0));if(void 0==f.k_sf){if(!f.k_a_acc&&!b)break a;f.k_sf=k.okey.k_sf}k.okey=A(f);b&&(k.vtransp=b,Ad(f));f.k_old_sf=k.ckey.k_sf;k.ckey=f;ue()?(k.key=A(f),f.k_none&&(k.key.k_sf=0)):(b=k.last_sym)&&b.type==h.METER?(k.last_sym=b.prev,k.last_sym||(k.sym=null),ba(f),f.next=b,b.prev=
f,k.last_sym=b):ba(f)}break;case "N":case "R":O[a]=O[a]?O[a]+("\n"+c):c;break;case "r":if(!w.keep_remark||3!=l.state)break;b={type:h.REMARK,text:c,dur:0};ba(b);break;default:p(0,"'$1:' line ignored",a)}}function ag(){var a,c,b,d=l.line,e={type:h.BAR,fname:l.fname,istart:l.bol+d.index,dur:0,multi:0};va&&va.bar&&yc("|");za.new_nbar&&(e.bar_num=za.new_nbar,za.new_nbar=0);for(b=d["char"]();;){c=d.next_char();switch(c){case "|":case "[":case "]":case ":":b+=c;continue}break}":"==b[0]&&(1==b.length?(b=
"|",e.bar_dotted=!0):e.rbstop=2);ib&&Z.gch_build(e);sa&&(tc(sa,e),sa=null);l.ottava.length&&(a=e,k.cst!=k.st&&(a={type:h.SPACE,fname:l.fname,istart:l.bol+d.index,dur:0,multi:0,invis:!0,width:1},ba(a)),a.ottava=l.ottava,l.ottava=[]);switch(b.slice(-1)){case "[":if(/[0-9" ]/.test(c))break;b=b.slice(0,-1);d.index--;c="[";break;case ":":e.rbstop=2}if("0"<c&&"9">=c){"["==b.slice(-1)&&(b=b.slice(0,-1));for(e.text=c;;){c=d.next_char();if(0>"0123456789,.-".indexOf(c))break;e.text+=c}e.rbstop=2;e.rbstart=
2}else if('"'==c&&"["==b.slice(-1)){b=b.slice(0,-1);for(e.text="";;){c=d.next_char();if(!c){p(1,"No end of repeat string");return}if('"'==c){d.index++;break}"\\"==c&&(e.text+=c,c=d.next_char());e.text+=c}e.text=nb(e.text);e.rbstop=2;e.rbstart=2}"]"==b[0]&&(e.rbstop=2,1!=b.length?b=b.slice(1):e.invis=!0);e.iend=l.bol+d.index;e.rbstart&&k.norepbra&&!k.second&&(e.norepbra=!0);if(0>k.ulen){var f;if((a=k.last_sym)&&a.type!=h.MREST&&a.type!=h.BAR){for(;a.type!=h.BAR&&a.prev;)a=a.prev;c=a.time;d=k.time-
c;if(0==c){for(;a&&!a.dur;)a=a.next;a&&a.type==h.REST&&a.invis&&(c+=a.dur*k.wmeasure/d,a.prev?a.prev.next=a.next:k.sym=a.next,a.next&&(a.next.prev=a.prev),a=a.next)}if(k.wmeasure!=d){for(;a;a=a.next)if(a.time=c,a.dur&&!a.grace&&(a.dur=a.dur*k.wmeasure/d,a.dur_orig=a.dur_orig*k.wmeasure/d,c+=a.dur,a.type==h.NOTE||a.type==h.REST))for(f=0;f<=a.nhd;f++)a.notes[f].dur=a.notes[f].dur*k.wmeasure/d;k.time=e.time=c}}}if((a=k.last_sym)&&a.time==k.time)if(a.type==h.SPACE)a.time--;else if("["==b||"|:"==b){do{if(a.type==
h.BAR)break;if(Ab[a.type])break;a=a.prev}while(a);if(a&&a.type==h.BAR){if("["==b&&!a.text&&(0==k.st||G.staves[k.st-1].flags&64||e.norepbra)){e.text&&(a.text=e.text);e.a_gch&&(a.a_gch=e.a_gch);e.norepbra&&(a.norepbra=e.norepbra);e.rbstart&&(a.rbstart=e.rbstart);e.rbstop&&(a.rbstop=e.rbstop);return}if(a.st==k.st&&"|:"==b){if(":|"==a.bar_type){a.bar_type="::";a.rbstop=2;return}if("||"==a.bar_type){a.bar_type="||:";a.rbstop=2;return}}}}switch(b){case "[":e.rbstop=2;case "[]":case "[|]":e.invis=!0;b="[]";
break;case ":|:":case ":||:":b="::";break;case "||":if(!t.rbdbstop)break;case "[|":case "|]":e.rbstop=2}e.bar_type=b;k.lyric_restart||(k.lyric_restart=e);k.sym_restart||(k.sym_restart=e);ba(e);e.st=k.st;e.rbstart&&!k.norepbra&&0<k.st&&!(G.staves[k.st-1].flags&64)&&(a={type:h.BAR,fname:e.fname,istart:e.istart,iend:e.iend,bar_type:"[",multi:0,invis:!0,text:e.text,rbstart:2},ba(a),a.st=k.st,delete e.text,e.rbstart=0)}function Jc(a){if(!a)return[];a=a.match(/=?[^\s"=]+=?|".+?"/g);return a?a:(p(1,"Unterminated string"),
[])}function Je(a,c){var b,d,e;d=0;b=c;0!=b%12&&J(1,a,"Invalid note duration $1",b);b/=12;0==b&&J(1,a,"Note too short");for(e=5;0!=b&&!(b&1);b>>=1,e--);b>>=1;switch(b){case 0:break;case 1:d=1;break;case 3:d=2;break;case 7:d=3;break;default:J(1,a,"Invalid note duration $1",c),e+=(11-b)/4|0,d=4}e-=d;if(0<=e)b=h.FULL;else switch(e){default:J(1,a,"Note too long"),e=-4;case -4:b=h.SQUARE;break;case -3:b=t.squarebreve?h.SQUARE:h.OVALBARS;break;case -2:b=h.OVAL;break;case -1:b=h.EMPTY}return[b,d,e]}function Lb(a){var c,
b,d;Bd.lastIndex=a.index;c=Bd.exec(a.buffer);if(!c[0])return[1,1];b=c[1]||1;d=c[3]||1;c[3]||(d*=1<<c[2].length);a.index=Bd.lastIndex;return[b,d]}function nc(a){var c,b,d,e,f=a["char"]();switch(f){case "^":f=a.next_char();"^"==f?(c=2,f=a.next_char()):c=1;break;case "=":c=3;f=a.next_char();break;case "_":f=a.next_char(),"_"==f?(c=-2,f=a.next_char()):c=-1}if(c&&3!=c&&"1"<=f&&"9">=f||"/"==f)d=Lb(a),b=d[0],d=d[1],d=1==d?k?k.uscale:1:2*d,f=a["char"]();e=Cd.indexOf(f)+16;f=a.next_char();if(16>e)p(1,"'$1' is not a note",
a.buffer[a.index-1]);else{for(;"'"==f;)e+=7,f=a.next_char();for(;","==f;)e-=7,f=a.next_char();a={pit:e,shhd:0,shac:0,ti1:0};c&&(a.acc=c,b&&(a.micro_n=b,a.micro_d=d));return a}}function bg(a){var c,b="abcdefg"[(a.pit+77)%7];a.acc&&(b="__ _  ^ ^^ =".split(" ")[a.acc+2]+b);for(c=a.pit;30<=c;c-=7)b+="'";for(c=a.pit;23>c;c+=7)b+=",";return b}function Dd(){var a=l.line,c=0;"."!=a.buffer[a.index-1]||sa||(c=h.SL_DOTTED);switch(a.next_char()){case "'":return a.index++,c+h.SL_ABOVE;case ",":return a.index++,
c+h.SL_BELOW}return c+h.SL_AUTO}function pf(a){a.notes=a.notes.sort(function(a,b){return a.pit-b.pit})}function Jf(){function a(f){for(var v,u,x,y;;){v=r["char"]();if(!v)break;if("."==v)switch(r.buffer[r.index+1]){case "(":case "-":case "|":v=r.next_char()}u=v.charCodeAt(0);if(128<=u){p(1,N.not_ascii);r.index++;break}if(!f&&Yc[u]){y=0;for(x in mc)if(mc.hasOwnProperty(x)&&x[0]==v){if(0>x.indexOf("n")){if(r.buffer.indexOf(x,r.index)!=r.index)continue;r.index+=x.length}else{a:{y=void 0;var w,z,A=x;z=
1;for(w=r.index+1;z<A.length;z++,w++)if(A[z]!=r.buffer[w]){if("n"!=A[z]){y=void 0;break a}y=Cd.indexOf(r.buffer[w]);if(0>y){y=void 0;break a}for(;"'"==r.buffer[w+1];)y+=7,w++;for(;","==r.buffer[w+1];)y-=7,w++}r.index=w}if(!y)continue}var A=mc[x],D=y;y=r;w=l.istart;l.line=r=new qa;l.istart+=y.index;z=r;if(D){var C,E=D,Q="",J=A.length;for(i=0;i<J;i++)if(C=A[i],"h"<=C&&"z">=C){D=E+C.charCodeAt(0)-110;for(C="";0>D;)D+=7,C+=",";for(;14<D;)D-=7,C+="'";Q+=Cd[D]+C}else Q+=C;A=Q}z.buffer=A;a(!0);l.line=r=
y;l.istart=w;y=1;break}if(y)continue}u=Za[u];switch(u[0]){case " ":if(y=k.last_note)y.beam_end=!0,c&&(c.gr_shift=!0);break;case "\n":if(t.barsperstaff)break;0==G.voices[k.v].range&&k.last_sym&&(k.last_sym.eoln=!0);break;case "&":if(c){p(1,N.bad_char,v);break}v=r.next_char();if(")"==v){yc(")");break}yc("&");continue;case "(":v=r.next_char();if("0"<v&&"9">=v){u=r.get_int();y=mh[u];w=u;v=r["char"]();if(":"==v&&(v=r.next_char(),"0"<v&&"9">=v&&(y=r.get_int(),v=r["char"]()),":"==v))if(v=r.next_char(),"0"<
v&&"9">=v)w=r.get_int(),r["char"]();else{p(1,"Invalid 'r' in tuplet");continue}if(0==y||void 0==y)y=0==k.wmeasure%9?3:2;(m=g[++q])||(g[q]=m={});m.p=u;m.q=y;m.r=w;m.f=t.tuplets;m.fact=n*y/u;n=m.fact;continue}if("&"==v){if(c){p(1,N.bad_char,v);break}yc("(");break}B<<=4;r.index--;B+=Dd();continue;case ")":if(k.ignore)break;if(y=k.last_sym)switch(y.type){case h.NOTE:case h.REST:case h.SPACE:break;default:y=null}if(!y){p(1,N.bad_char,v);break}y.slur_end?y.slur_end++:y.slur_end=1;break;case "!":sa||(sa=
[]);if(1<u.length)y=u.slice(1,-1);else{y="";for(u=r.index;;){v=r.next_char();if(!v)break;if("!"==v)break;y+=v}if(!v){r.index=u;p(1,"No end of decoration");break}}void 0!=cg[y]?(za.ottava=!0,l.ottava.push(cg[y])):sa.push(y);break;case '"':dg(u);break;case "-":if(!k.last_note||k.last_note.type!=h.NOTE){p(1,"No note before '-'");break}v=Dd();y=k.last_note;for(u=0;u<=y.nhd;u++)y.notes[u].ti1?0==y.nhd&&p(1,"Too many ties"):y.notes[u].ti1=v;y.ti1=!0;c&&(c.ti1=!0);continue;case "[":y=r.buffer[r.index+1];
if(0<='|[]: "'.indexOf(y)||"1"<=y&&"9">=y){if(c){p(1,N.bar_grace);break}ag();continue}if(":"==r.buffer[r.index+2]){u=r.buffer.indexOf("]",r.index+1);if(0>u){p(1,"Lack of ']'");break}v=r.buffer.slice(r.index+3,u).trim();l.istart=l.bol+r.index;l.iend=l.bol+ ++u;r.index=0;ud(y,v);r.index=u;continue}case "n":y=Z.new_note(c,n);if(!y)continue;y.type==h.NOTE&&B&&(y.slur_start=B,B=0);if(c){0<=q&&(y.in_tuplet=!0);continue}0<=q&&y.notes&&(y.in_tuplet=!0,0<q?(g[0].p&&(y.tp0=g[0].p,y.tq0=g[0].q,y.tf=g[0].f,g[0].p=
0),g[0].r--,m.p&&(y.tp1=m.p,y.tq1=m.q,y.tf=m.f,m.p=0)):m.p&&(y.tp0=m.p,y.tq0=m.q,y.tf=m.f,m.p=0),m.r--,0==m.r&&(0==q--?(y.tp0?y.tp0=!1:y.te0=!0,n=1,k.time=Math.round(k.time),y.dur=k.time-y.time):(y.tp1?y.tp1=!1:y.te1=!0,m=g[0],0==m.r?(q--,y.te0=!0,n=1,k.time=Math.round(k.time),y.dur=k.time-y.time):n=m.fact)));continue;case "<":if(!k.last_note){p(1,"No note before '<'");break}if(c){p(1,"Cannot have a broken rhythm in grace notes");break}for(y="<"==v?1:-1;"<"==v||">"==v;)y*=2,v=r.next_char();k.brk_rhythm=
y;continue;case "i":break;case "{":if(c){p(1,"'{' in grace note");break}b=k.last_note;k.last_note=null;d=sa;sa=void 0;c={type:h.GRACE,fname:l.fname,istart:l.bol+r.index,dur:0,multi:0};switch(k.pos.gst){case h.SL_ABOVE:c.stem=1;break;case h.SL_BELOW:c.stem=-1;break;case h.SL_HIDDEN:c.stem=2}ba(c);v=r.next_char();if("/"==v){c.sappo=!0;break}continue;case "|":if(c){p(1,N.bar_grace);break}v=r.buffer[r.index-1];ag();"."==v&&(k.last_sym.bar_dotted=!0);continue;case "}":y=k.last_note;if(!c||!y){p(1,N.bad_char,
v);break}sa&&p(1,"Decoration ignored");y.gr_end=!0;c.extra=c.next;c.extra.prev=null;c.next=null;k.last_sym=c;c=null;if(!y.prev&&!k.ckey.k_bagpipe){for(u=0;u<=y.nhd;u++)y.notes[u].dur*=2;y.dur*=2;y.dur_orig*=2}k.last_note=b;sa=d;break;case "\\":if(!r.buffer[r.index+1]){e=!0;break}default:p(1,N.bad_char,v)}r.index++}}var c,b,d,e,f,g=[],m,q=-1,n=1,B=0,r=l.line;if(3!=l.state){if(2!=l.state)return;$a()}a();if(0<=q)for(p(1,"No end of tuplet"),f=k.last_note;f;f=f.prev)if(f.tp1&&(f.tp1=0),f.tp0){f.tp0=0;
break}c&&(p(1,"No end of grace note sequence"),k.last_sym=c.prev,k.last_note=b,c.prev&&(c.prev.next=null));t.breakoneoln&&k.last_note&&(k.last_note.beam_end=!0);e||t.barsperstaff||"\n"!=Za[10]||0!=G.voices[k.v].range||!k.last_sym||(k.last_sym.eoln=!0)}function $c(a){a=a.charCodeAt(0);if(128<=a){if(768<=a&&880>a)return 0;a=97}return eg[a]}function pa(a){"string"==typeof a&&(a=lc(a));eg="sans"==a.name.slice(0,4)?nh:fg;D.curfont=D.deffont=a}function gg(a){var c,b=D.curfont,d=b;z+=a.replace(/<|>|&[^&]*?;|&|  |\$./g,
function(a){switch(a){case "<":return"&lt;";case ">":return"&gt;";case "&":return"&amp;";case "  ":return" \u00a0";default:if("$"==a[0]){if("0"==a[1])c=D.deffont,sb(c);else if("1"<=a[1]&&"9">=a[1])c=lc("u"+a[1]);else break;a="";if(c!=d&&(d!=b&&(a="</tspan>"),d=c,d!=b))return a+'<tspan\n\tclass="'+td(c)+'">'}}return a});d!=b&&(z+="</tspan>",D.curfont=d)}function la(a,c,b,d,e,f){f||(f=Pa(b));z+='<text class="'+td(D.curfont);"j"!=d&&5<b.length&&D.curfont.wadj&&(z+='" lengthAdjust="'+D.curfont.wadj+'" textLength="'+
f[0].toFixed(1));z+='" x="';kb(a,'" y="',c+.2*f[1]);switch(d){case "c":a-=f[0]/2;z+='" text-anchor="middle">';break;case "j":z+='" textLength="'+e.toFixed(1)+'">';break;case "r":a-=f[0];z+='" text-anchor="end">';break;default:z+='">'}gg(b);z+="</text>\n";!e&&D.curfont.box&&(z+='<rect class="stroke" x="',kb(a-2,'" y="',c+f[1]),z+='" width="'+(f[0]+4).toFixed(1)+'" height="'+(f[1]+2).toFixed(1)+'"/>\n')}function rd(){return(ga.width-ga.lm-ga.rm-2)/t.scale}function yd(a,c){var b,d;if(a){rb();b=a;if(t.titletrim)if(d=
b.lastIndexOf(", "),0>d||"A">b[d+2]||"Z"<b[d+2])d=0;else if(1==t.titletrim){if(d<b.length-7||0<=b.indexOf(" ",d+3))d=0}else d<b.length-t.titletrim-2&&(d=0);!c&&0<=t.writefields.indexOf("X")&&(b=O.X+".  "+b);d&&(b=b.slice(d+2).trim()+" "+b.slice(0,d));a=t.titlecaps?b.toUpperCase():b;c?(pa("subtitle"),b=t.subtitlespace):(pa("title"),b=t.titlespace);d=Pa(a);ia(d[1]+b);t.titleleft?la(0,0,a,null,null,d):la(rd()/2,0,a,"c",null,d)}}function hg(a,c,b,d,e){if(!b){if(!d)return;b=d;d=null}d?la(a,c,b+" ("+d+
")",e):la(a,c,b,e)}function xd(a,c){if("s"!=c){pa("text");rb();var b,d,e=rd();d=D.curfont.size;var f=d*t.lineskipfac,g=d*t.parskipfac,m=Va.started?function(){}:Ib,h=Va.started?wd:Lc,n,k,r,l,u;m();switch(c){default:switch(c){case "c":e/=2;break;case "r":break;default:e=0}k=0;for(d=D.curfont;;){n=a.indexOf("\n",k);if(0>n){l=a.slice(k);b=Pa(l);D.curfont=d;ia(b[1]*t.lineskipfac);la(e,0,l,c,null,b);d=D.curfont;break}if(n==k){ia(g);h();for(sb(D.curfont);"\n"==a[n+1];)ia(f),n++;if(n==a.length)break;m()}else l=
a.slice(k,n),b=Pa(l),D.curfont=d,ia(b[1]*t.lineskipfac),la(e,0,l,c,null,b),d=D.curfont;k=n+1}ia(g);h();break;case "f":case "j":for(k=0;;){n=a.indexOf("\n\n",k);r=0>n?a.slice(k):a.slice(k,n);r=r.split(/\s+/);b=l=0;d=D.curfont;for(k=0;k<r.length;k++)u=Pa(r[k]+" ")[0],b+=u,b>=e&&(l=r.slice(l,k).join(" "),D.curfont=d,b=Pa(l),D.curfont=d,ia(b[1]*t.lineskipfac),la(0,0,l,c,e,b),d=D.curfont,l=k,b=u);0!=b&&(l=r.slice(l).join(" "),D.curfont=d,b=Pa(l),D.curfont=d,ia(b[1]*t.lineskipfac),la(0,0,l,null,null,b));
ia(g);h();if(0>n)break;for(;"\n"==a[n+2];)ia(f),n++;if(n==a.length)break;m();sb(D.curfont);k=n+2}}}}function Zg(a){function c(a,b,c){c=0;var d,e;"$"==a[c]&&"0"<=a[c+1]&&"9">=a[c+1]&&(c+=2);e=0;d=c;if("0"<=a[c]&&"9">=a[c]||"."==a[c+1]){for(;c<a.length&&(c++," "!=a[c]&&":"!=a[c-1]&&"."!=a[c-1]););for(e=c;" "==a[c];)c++}0!=e&&la(b,0,a.slice(d,e),"r");c<a.length&&la(b+5,0,a.slice(c),"l");return c>=a.length&&0==e}var b,d,e,f,g,m,h;pa("words");var n=rd()/2;m=(n-45)/($c("a")*D.curfont.swfac);f=0;a=a.split("\n");
g=a.length;for(d=0;d<g;d++){b=a[d];if(b.length>m){f=0;break}b?h=!0:h&&(f++,h=!1)}if(0<f){d=f=(f+1)/2|0;h=!1;for(m=0;m<g;m++){b=a[m];for(e=0;" "==b[e];)e++;if(e==b.length){if(h&&0>=--d)break;h=!1}else h=!0}b=m+1}else b=m=g;ia(t.wordsspace);for(d=0;d<m||b<g;d++)d<m&&0==a[d].length&&(Ib(),sb(D.curfont)),ia(t.lineskipfac*D.curfont.size),d<m&&c(a[d],45,0),b<g&&(c(a[b],20+n,1)&&0==--f&&(d<m?f++:b<a.length-1&&(n*=.6)),b++)}function Ed(a){return a.replace(/[Cco]\||[co]\.|./g,function(a){a=te["mtr"+a];return a.x||
a.y?'<tspan dx="'+a.x.toFixed(1)+'" dy="'+a.y.toFixed(1)+'">'+a.c+"</tspan>":a.c})}function ig(a){var c,b;if(!Fd[a])if(Fd[a]=!0,b=Gb[a]){for(c=0;;){a=b.indexOf('xlink:href="#',c);if(0>a)break;a+=13;c=b.indexOf('"',a);ig(b.slice(a,c))}ad+="\n"+b}else J(1,null,"Unknown glyph: '$1'",a)}function ee(){C.started&&(C.started=!1,z+="</g>\n");if(1!=C.scale||C.color)z+="<g ",1!=C.scale&&(z=0<=C.st?z+u[C.st].scale_str:z+x[C.v].scale_str),C.color&&(1!=C.scale&&(z+=" "),z+='color="'+C.color+'" fill="'+C.color+
'"'),z+=">\n",C.started=!0}function uc(a){if(a!=C.color){var c=C.color;C.color=a;ee();return c}}function gb(a){var c,b;a!=C.st&&1!=C.scale&&(C.scale=0);c=0<=a?u[a].staffscale:1;b=0<=a&&1!=c?u[a].y:ra;if(c!=C.scale||b!=C.dy)C.scale=c,C.dy=b,C.st=a,ee()}function bd(a){var c=a.p_v.scale;if(1==c)gb(a.st);else if(c!=C.scale||C.dy!=ra)C.scale=c,C.dy=ra,C.st=-1,C.v=a.v,ee()}function Tb(a,c){z&&(0>C.st?u[0].output+=z:1==C.scale?u[C.st].output+=z:u[C.st].sc_out+=z,z="");C.scale=0>a?1:c?1:u[a].staffscale;C.st=
a;C.dy=0}function jg(a,c,b){if(void 0!=a.istart){var d=a.type,e=a.ymx-a.ymn+4,f=a.wl||2,g=a.wr||2;a.grace&&(d=h.GRACE);b(c||kg[d],a.istart,a.iend,a.x-f-2,u[a.st].y+a.ymn+e-2,f+g+4,e,a)}}function oh(a,c){jg(a,c,w.anno_start)}function ph(a,c){jg(a,c,w.anno_stop)}function lg(){}function W(a,c,b,d,e){c=Gd(c);b=Hd(b);z+=a.replace(/X|Y|A|B|F|G/g,function(a){switch(a){case "X":return c.toFixed(1);case "Y":return b.toFixed(1);case "A":return d;case "B":return e;case "F":return d.toFixed(1);default:return e.toFixed(1)}})}
function Zd(a,c,b,d,e){W('<g transform="translate(X,Y',a,c);b&&(z+=") rotate("+b.toFixed(2));d&&(z=e?z+(") scale("+d.toFixed(2)+", "+e.toFixed(2)):z+(") scale("+d.toFixed(2)));z+=')">\n';C.g++}function $d(){C.g--;z+="</g>\n"}function Gd(a){return C.g?a:(a+ic)/C.scale}function Hd(a){return C.g?-a:1==C.scale?ra-a:0>C.st?(ra-a)/C.scale:C.dy-a}function kb(a,c,b){a=Gd(a);b=Hd(b);z+=a.toFixed(1)+c+b.toFixed(1)}function Xd(a,c,b){b?W('<path d="mX Y',a,c):W('<path class="stroke" d="mX Y',a,c)}function ca(a,
c,b){var d=te[b];d&&!Gb[b]?(a+=d.x*C.scale,c-=d.y,d.sc?W('<text transform="translate(X,Y) scale(A)">B</text>\n',a,c,d.sc,d.c):W('<text x="X" y="Y">A</text>\n',a,c,d.c)):Gb[b]?(ig(b),W('<use x="X" y="Y" xlink:href="#A"/>\n',a,c,b)):J(1,null,"no definition of $1",b)}function Ef(a,c,b){W('<text style="font:italic 12px serif"\n\tx="X" y="Y" text-anchor="middle">A</text>\n',a,c,b.toString())}function mg(a,c,b){var d,e=25+3*(b/20|0);d=15<b?(b-15)/e|0:0;W('<path class="stroke" stroke-width="1.2"\n\tstroke-dasharray="5,A"\n\td="mX YhB"/>\n',
a+(b-e*d-5)/2,c+6,Math.round((e-5)/C.scale),e*d+5)}function Vc(a,c,b,d,e,f){var g=d?Wc:3.5,h=-b;0>b&&(g=-g);a+=g*C.scale;0>C.st&&(h/=C.scale);W('<path class="sW" d="mX YvF"/>\n',a,c,h);if(e){c+=b;if(0<b)if(f)if(z+='<path d="',d)for(;0<=--e;)W("MX Yl3 1.5 0 2 -3 -1.5z\n",a,c),c-=3;else for(c+=1;0<=--e;)W("MX Yl7 3.2 0 3.2 -7 -3.2z\n",a,c),c-=5.4;else if(d)if(z+='<path d="',1==e)W("MX Yc0.6 3.4 5.6 3.8 3 10\n\t1.2 -4.4 -1.4 -7 -3 -7\n",a,c);else for(;0<=--e;)W("MX Yc1 3.2 5.6 2.8 3.2 8\n\t1.4 -4.8 -2.4 -5.4 -3.2 -5.2\n",
a,c),c-=3.5;else{ca(a,c,"flu"+e);return}else if(f){if(z+='<path d="',!d)for(c+=1;0<=--e;)W("MX Yl7 -3.2 0 -3.2 -7 3.2z\n",a,c),c+=5.4}else if(d)if(z+='<path d="',1==e)W("MX Yc0.6 -3.4 5.6 -3.8 3 -10\n\t1.2 4.4 -1.4 7 -3 7\n",a,c);else for(;0<=--e;)W("MX Yc1 -3.2 5.6 -2.8 3.2 -8\n\t1.4 4.8 -2.4 5.4 -3.2 5.2\n",a,c),c+=3.5;else{ca(a,c,"fld"+e);return}z+='"/>\n'}}function Id(a,c,b){W('<path class="stroke" stroke-width="0.8" d="mX YhF"/>\n',a,c+3,b)}function ng(a,c,b,d){var e=qh[b];e?(a+=e.dx,c+=e.dy,
e.def||(Oc+="\n."+b+" {"+e.style+"}",e.def=!0),W('<text x="X" y="Y" class="A"B>',a,c,b,e.anchor||""),pa("annotation"),gg(d),z+="</text>\n"):ca(a,c,b)}function og(a,c,b){Zd(a,c,270);a=0;for(b=Math.ceil(b/6);0<=--b;)ca(a,6,"ltr"),a+=6;$d()}function pg(a,c,b){c+=4;for(b=Math.ceil(b/6);0<=--b;)ca(a,c,"ltr"),a+=6}function qf(a,c,b,d,e){if(qg[b])qg[b](a,c,d,e);else J(1,null,"No function for decoration '$1'",b)}function ia(a){ra+=a}function wd(){if(!Na&&z&&w.img_out&&0!=ra){var a='<svg xmlns="http://www.w3.org/2000/svg" version="1.1"\n\txmlns:xlink="http://www.w3.org/1999/xlink"\n\tcolor="black" class="music" stroke-width=".7"',
c="";t.bgcolor&&(a+=' style="background-color: '+t.bgcolor+'"');ra*=t.scale;a=w.imagesize?a+("\n"+w.imagesize+' viewBox="0 0 '+ga.width.toFixed(0)+" "+ra.toFixed(0)+'">\n'):a+('\n\twidth="'+ga.width.toFixed(0)+'px" height="'+ra.toFixed(0)+'px">\n');if(Oc||vc||Nb)a+='<style type="text/css">'+Oc+vc,Nb&&(a=0<Nb.indexOf("(")?a+('\n.music{font:24px music}\n@font-face {\n  font-family:"music";\n  src:'+Nb+"}"):a+("\n.music{font:24px "+Nb+"}")),a+="\n</style>\n";(ad+=fe)&&(a+="<defs>"+ad+"\n</defs>\n");
1!=t.scale&&(a+='<g class="g" transform="scale('+t.scale.toFixed(2)+')">\n',c="</g>\n");rg&&rg.ps_flush(!0);w.img_out(a+z+c+"</svg>");vc=z="";if(t.fullsvg)for(Fd={},a=0;a<Kc.length;a++)Kc[a].used=!1;else fe=Oc=Nb="";ad="";ra=0}}function Ib(){!Na&&w.img_out&&(Lc(),w.page_format&&!Va.started&&(Va.started=!0,Va.newpage?(Va.newpage=!1,w.img_out('<div class="nobrk newpage">')):w.img_out('<div class="nobrk">')))}function Lc(){wd();Va.started&&(Va.started=!1,w.img_out("</div>"))}function rh(){function a(a,
c){var b;b=new RegExp(c);if(b.test(k.id)||b.test(k.nm))for(b=0;b<a.length;b++)Z.do_pscom(a[b])}var c;if(l.voice_opts)for(c in l.voice_opts)l.voice_opts.hasOwnProperty(c)&&a(l.voice_opts[c],c);if(l.tune_v_opts)for(c in l.tune_v_opts)l.tune_v_opts.hasOwnProperty(c)&&a(l.tune_v_opts[c],c)}function ba(a){a.fname||wc(a);k.ignore||(l.last_sym=a,(a.prev=k.last_sym)?k.last_sym.next=a:k.sym=a,k.last_sym=a);a.v=k.v;a.p_v=k;a.st=k.cst;a.time=k.time;a.dur&&!a.grace&&(k.time+=a.dur);a.pos=k.pos;k.second&&(a.second=
!0);k.floating&&(a.floating=!0)}function Zc(a,c){var b={type:c,dur:0},d;d=k;k=a;ba(b);k=d;d=b.prev;d||(d=b.next);d&&(b.fname=d.fname,b.istart=d.istart,b.iend=d.iend);return b}function sg(a){var c,b,d,e=a.nmes,f=a.dur/e,g=a.a_dd;a.type=h.REST;a.dur=a.dur_orig=f;d=a.next;c=a.p_v;c.last_sym=a;c.time=a.time+f;c.cst=a.st;for(b=a;0<--e;)b=Zc(c,h.BAR),b.bar_type="|",b=Zc(c,h.REST),a.invis&&(b.invis=!0),b.dur=b.dur_orig=f,c.time+=f;if(b.next=d)d.prev=b;b.a_dd=g}function tg(){var a,c,b;(c=za.tempo)&&0>=Wa&&
(b=G.top_voice,a=x[b],a.sym&&a.sym.type!=h.TEMPO&&(c=A(c),c.v=b,c.p_v=a,c.st=a.st,c.time=0,c.next=a.sym,c.next&&(c.next.prev=c),a.sym=c));for(b=0;b<x.length;b++){a=x[b];a.ignore&&(a.ignore=!1);for(c=a.sym;c&&!(c.time>=Wa);c=c.next);for(;c;c=c.next){switch(c.type){case h.GRACE:c.next&&c.next.type==h.BAR&&c.time--;if(!t.graceword)continue;for(a=c.next;a;a=a.next){switch(a.type){case h.SPACE:continue;case h.NOTE:a.a_ly&&(c.a_ly=a.a_ly,a.a_ly=null)}break}continue}if(c.feathered_beam){var d,e,f,g,m,q;
d=c;f=d.dur;var n=1;for(q=d;q&&!q.beam_end&&q.next;q=q.next)n++;if(1>=n)delete d.feathered_beam;else{m=q;e=f/2;a=f/(n-1);g=d.time;if(0<d.feathered_beam)for(q=d,d=n-1;q!=m;q=q.next,d--)f=(a*d|0)+e,q.dur=f,q.time=g,g+=f;else for(q=d,d=0;q!=m;q=q.next,d++)f=(a*d|0)+e,q.dur=f,q.time=g,g+=f;q.dur=q.time+q.dur-g;q.time=g}}}}}function ug(){var a,c,b,d,e,f,g,m=x.length;for(f=0;f<m;f++)if(a=x[f],c=a.clone){a.clone=null;for(b=a.sym;b&&!(b.time>=Wa);b=b.next);c.clef=A(a.clef);for(k=c;b;b=b.next)if(b.type!=h.STAVES){a=
A(b);if(b.notes)for(a.notes=[],g=0;g<=b.nhd;g++)a.notes.push(A(b.notes[g]));ba(a);c.second?a.second=!0:delete a.second;c.floating?a.floating=!0:delete a.floating;delete a.a_ly;if(d=a.extra)for(e=A(d),a=a.extra=e,a.v=c.v,a.p_v=c,a.st=c.st,d=d.next;d;d=d.next){e=A(d);if(d.notes)for(e.notes=[],g=0;g<=d.nhd;g++)e.notes.push(A(d.notes[g]));a.next=e;e.prev=a;a=e;a.v=c.v;a.p_v=c;a.st=c.st}}}}function vg(a){var c,b={voices:[],staves:[],top_voice:0};if(a)E=G=b;else{for(a=0;a<x.length;a++){if(0<=G.voices[a].range){c=
G.voices[a].st;c=G.staves[c];var d=x[a];void 0!=d.staffnonote&&(c.staffnonote=d.staffnonote);d.staffscale&&(c.staffscale=d.staffscale)}b.voices[a]=A(G.voices[a]);b.voices[a].range=-1;delete b.voices[a].second}for(c=0;c<G.staves.length;c++)b.staves[c]=A(G.staves[c]),b.staves[c].flags=0;G=G.next=b}}function ve(){var a;if(!k.ckey.k_bagpipe&&!k.ckey.k_drum&&(t.transp&&k.transp&&p(0,"Mix of old and new transposition syntaxes"),a=(t.transp||0)+(k.transp||0)+(k.shift||0),a!=(k.vtransp||0)))if(k.vtransp=
a,a=k.last_sym){for(;a.type!=h.KEY;){if(!a.prev){a=k.key;break}a=a.prev}Ad(a);k.ckey=A(a);k.key.k_none&&(a.k_sf=0)}else k.key=A(k.okey),Ad(k.key),k.ckey=A(k.key),k.key.k_none&&(k.key.k_sf=0)}function Hf(){var a,c;va&&(p(1,"No end of voice overlay"),yc(va.bar?"|":")"));if(0!=x.length){tg();ug();var b,d,e,f,g,m,q,n,k=x.length,l=[],t=[],u=-1;for(b=0;b<k;b++)l.push(x[b].sym);for(var z=1,A=E;;){if(A&&z)for(n=A,A=null,f=-1,t=[],b=0;b<k;b++)n.voices[b]?(e=n.voices[b].range,0>e||(t[e]=b,f++)):n.voices[b]=
{range:-1};d=c=1E6;for(e=0;e<k;e++){b=t[e];if(void 0==b)break;!(a=l[b])||a.time>c||(b=Ab[a.type],a.time<c?(c=a.time,d=b):b<d&&(d=b),a.type==h.MREST&&(1==a.nmes?sg(a):0<f&&(u=c)))}if(127<d)break;if(c==u){for(e=m=0;e<k;e++){b=t[e];if(void 0==b)break;if((a=l[b])&&a.time==c&&Ab[a.type]==d){if(a.type!=h.MREST){u=-1;break}if(0==m)m=a.nmes;else if(m!=a.nmes){u=-1;break}}}if(0>u)for(e=0;e<k;e++){b=t[e];if(void 0==b)break;(a=l[b])&&a.type==h.MREST&&sg(a)}}for(e=0;e<k;e++){b=t[e];if(void 0==b)break;if((a=l[b])&&
a.time==c&&Ab[a.type]==d){if(a.type==h.STAVES){A=a.sy;for(m=0;m<k&&void 0!=t[m];m++);for(q=0;q<k;q++)A.voices[q]&&(e=A.voices[q].range,0>e||0<=n.voices[q].range||(t[m++]=q))}z&&(z=0,a.seqst=!0);(a.ts_prev=g)?g.ts_next=a:V=a;g=a;l[b]=a.next}}z=d}if(V&&(Z.set_bar_num(),V)){w.get_abcmodel&&w.get_abcmodel(V,x,kg,O);w.img_out&&Z.output_music();for(a=0;a<x.length;a++)c=x[a],c.time=0,c.sym=c.last_sym=null,c.st=E.voices[a].st,c.second=E.voices[a].second,delete c.have_ly,c.hy_st=0,delete c.bar_start,delete c.slur_st,
delete c.s_tie,delete c.s_rtie;Wa=0}}}function Ad(a){var c=k.vtransp/3|0,c=(c&-2)+7*(c&1)+a.k_sf;switch((k.vtransp+210)%3){case 1:c=(c+4+48)%12-4;break;case 2:c=(c+7+48)%12-7;break;default:c=(c+5+48)%12-5}a.k_sf=c;a.k_delta=Mb[(c+7)%7]}function sh(a){var c,b,d=k.last_sym.prev;if(d)for(b=d.time;d;d=d.prev)switch(d.type){case h.BAR:if(d.time<b)return;for(;;){d=d.prev;if(!d)return;if(d.type==h.NOTE){if(d.time+d.dur==b)break;return}if(d.time<b)return}for(c=0;c<=d.nhd;c++)if(d.notes[c].pit==a&&d.notes[c].ti1)return d.notes[c].acc;
return;case h.NOTE:for(c=0;c<=d.nhd;c++)if(d.notes[c].pit==a)return d.notes[c].acc}}function wg(a,c){var b,d,e,f,g,m,q;b=[];e=!1;var n=m=d=g=f=0,t,r=c.match(/\w+|[^\s]/g);if(r){for(;;){t=r.shift();if(!t)break;switch(t){case "[":if(m||2<=g+d){p(1,N.misplaced,"[");e=!0;break}f|=0==g+d?4:1024;d++;n<<=8;n|=4;break;case "{":if(m||g||2<=d){p(1,N.misplaced,"{");e=!0;break}f|=d?256:1;g++;n<<=8;n|=1;break;case "(":if(m){p(1,N.misplaced,"(");e=!0;break}f|=16;m++;n<<=8;n|=16;break;case "*":!g||m||f&257||(f|=
128);break;case "+":f|=4096;break;default:if(/\w/.test(t)){for(q=t;;){t=r.shift();if(!t)break;switch(t){case "]":if(!(n&4)){p(1,N.misplaced,"]");e=!0;break}d--;f|=0==g+d?8:2048;n>>=8;continue;case "}":if(!(n&1)){p(1,N.misplaced,"}");e=!0;break}g--;f|=d?512:2;f&=-129;n>>=8;continue;case ")":if(!(n&16)){p(1,N.misplaced,")");e=!0;break}m--;f|=32;n>>=8;continue;case "|":f|=64;continue}break}b.push([q,f]);f=0;t&&r.unshift(t)}else p(1,"Bad voice ID in %%staves"),e=!0}}0!=n&&(p(1,"'}', ')' or ']' missing in %%staves"),
e=!0);q=e||0==b.length?void 0:b}else p(1,N.bad_val,"%%staves"),q=void 0;if(q){0!=x.length&&(tg(),ug());g=0;e=!0;for(f=0;f<x.length;f++)b=x[f],b.time>g&&(g=b.time),b.sym&&(e=!1);if(e||0==g&&0>Wa)for(f=0;f<G.voices.length;f++)G.voices[f].range=-1;else{for(f=0;f<G.voices.length;f++)if(0<=G.voices[f].range){k=x[f];break}k.time=g;b={type:h.STAVES,dur:0};ba(b);G.nstaff=R;vg();b.sy=G}Wa=g;for(f=0;f<x.length;f++)b=x[f],delete b.second,delete b.ignore,delete b.floating;for(e=m=0;e<q.length;e++){b=q[e][0];
b=Jd(b);b.time=g;f=b.v;0==e&&(G.top_voice=b.v);if(0<=G.voices[f].range){d=A(b);G.voices[x.length]=A(G.voices[f]);f=x.length;d.v=f;d.sym=d.last_sym=null;d.time=g;x.push(d);for(delete d.clone;b.clone;)b=b.clone;b=b.clone=d}q[e][0]=b;G.voices[f].range=m++}if("t"==a[1])for(e=0;e<q.length;e++)d=q[e][1],d&257&&3!=(d&3)&&768!=(d&768)&&0==q[e+1][1]&&!(d&16||q[e+2][1]&16)&&(q[e+2][1]&514?q[e+1][1]|=128:0==q[e+2][1]&&q[e+3][1]&514&&(q[e][1]|=16,q[e+1][1]|=32,q[e+2][1]|=16,q[e+3][1]|=32));g=-1;for(e=0;e<q.length;e++)if(d=
q[e][1],48==(d&48)&&(d&=-49,q[e][1]=d),b=q[e][0],d&128?(b.floating=!0,b.second=!0):(g++,G.staves[g]||(G.staves[g]={stafflines:"|||||",staffscale:1}),G.staves[g].flags=0),f=b.v,b.st=b.cst=G.voices[f].st=g,G.staves[g].flags|=d,d&16){for(d=b;e<q.length-1&&!(b=q[++e][0],f=b.v,q[e][1]&4096?(d.second=!0,d=b):b.second=!0,b.st=b.cst=G.voices[f].st=g,q[e][1]&32););G.staves[g].flags|=q[e][1]}0>g&&(g=0);G.nstaff=R=g;if("c"==a[1])for(g=0;g<R;g++)G.staves[g].flags^=64;for(f=0;f<x.length;f++)b=x[f],0>G.voices[f].range?
b.ignore=!0:(G.voices[f].second=b.second,g=b.st,!(0<g)||b.norepbra||G.staves[g-1].flags&64||(b.norepbra=!0));k=2<=l.state?x[G.top_voice]:null}}function yc(a){function c(a){var b,c;for(b=0;b<x.length;b++)if(c=x[b],c.id==a)return c;c=A(k);c.v=x.length;c.id=a;c.sym=c.last_sym=null;delete c.nm;delete c.snm;delete c.new_name;delete c.lyric_restart;delete c.lyric_cont;delete c.ly_a_h;delete c.sym_restart;delete c.sym_cont;delete c.have_ly;x.push(c);return c}var b,d,e;if(!k.ignore)if("|"==a||")"==a)k.last_note?
(k.last_note.beam_end=!0,va?(k.time!=va.p_voice.time&&(p(1,"Wrong duration in voice overlay"),k.time>va.p_voice.time&&(va.p_voice.time=k.time)),k=va.p_voice,va=null):p(1,"Erroneous end of voice overlay")):p(1,N.nonote_vo);else if("("==a)va?p(1,"Voice overlay already started"):va={p_voice:k,time:k.time};else if(k.last_note){k.last_note.beam_end=!0;a=k.voice_down;if(!a){a=c(k.id+"o");k.voice_down=a;a.time=0;a.second=!0;e=a.v;G.voices[e]={st:k.st,second:!0};var f=void 0!=k.clone?1:0;d=G.voices[k.v].range;
for(b=0;b<G.voices.length;b++)G.voices[b].range>d&&(G.voices[b].range+=f+1);G.voices[e].range=d+1;f&&(b=c(a.id+"c"),b.second=!0,e=b.v,G.voices[e]={second:!0,range:d+2},a.clone=b)}a.ulen=k.ulen;a.dur_fact=k.dur_fact;k.uscale&&(a.uscale=k.uscale);if(va)k!=va.p_voice&&k.time!=va.p_voice.time&&(p(1,"Wrong duration in voice overlay"),k.time>va.p_voice.time&&(va.p_voice.time=k.time));else{va={bar:!0,p_voice:k};b=a.time;for(d=k.last_sym;!(d.type==h.BAR||d.time<=b);d=d.prev);va.time=d.time}a.time=va.time;
k=a}else p(1,N.nonote_vo)}function ue(){var a;if(!k.sym)return!0;if(0!=k.time)return!1;for(a=k.last_sym;a;a=a.prev)if(0!=Ab[a.type])return!1;return!0}function xg(a){ue()?k.clef=a:(ba(a),a.clef_small=!0)}function Jd(a){var c,b,d=x.length;if(1==d&&x[0]["default"]&&(delete x[0]["default"],0==x[0].time))return c=x[0],c.id=a,t.transp&&2<=l.state&&(a=k,k=c,ve(),k=a),c;for(b=0;b<d;b++)if(c=x[b],c.id==a)return c;c={v:b,id:a,time:0,"new":!0,pos:{dyn:0,gch:0,gst:0,orn:0,stm:0,voc:0,vol:0},scale:1,ulen:za.ulen,
dur_fact:1,key:A(l.ckey),ckey:A(l.ckey),okey:A(l.ckey),meter:A(za.meter),wmeasure:za.meter.wmeasure,clef:{type:h.CLEF,clef_auto:!0,clef_type:"a",time:0},hy_st:0};x.push(c);G.voices[b]={range:-1};return c}function If(){R=-1;x=[];k=null;vg(!0);Wa=-1;D={};oa=[]}function zd(a){var c;a=Jc(a);var b=a.shift();if(b)if(0<b.indexOf(",")&&(c=b.split(","),b=c.shift()),2>l.state)0!=a.length&&$f(b,a),"*"!=b&&1==l.state&&Jd(b);else if("*"==b)p(1,"Cannot have V:* in tune body");else if(k=Jd(b),de(a),2==l.state&&
$a(),ve(),a=k.v,k["new"]&&(delete k["new"],0>Wa&&(k.st=k.cst=++R,G.nstaff=R,G.voices[a].st=R,G.voices[a].range=a,G.staves[R]={stafflines:k.stafflines||"|||||",staffscale:1}),0>G.voices[a].range&&0<=Wa&&(k.ignore=!0)),k.filtered||k.ignore||!l.voice_opts&&!l.tune_v_opts||(k.filtered=!0,rh()),c){var d,e;a=l.file;for(d=b=l.eol+1;;){e=a.indexOf("\n",d);if(0>e){e=0;break}if(/%.*|\n.*|.:.|\[.:/.test(a.slice(e+1,e+4)))break;d=e+1}Hb++;Xc(l.fname,a,b,e);for(d=0;d<c.length;d++)zd(c[d]),Xc(l.fname,a,b,e);Hb--}}
function $a(a){var c,b={type:h.STAVES,dur:0,sy:G};rb();var d,e,f,g,m,q,n,B=rd();Ib();ia(t.topspace);if(t.titleformat){var r,v,u,p,w;d={};e=A(th);f={A:t.infospace,C:t.composerspace,O:t.composerspace,R:t.infospace};g={};m="";q=t.titleformat;for(n=0;;){for(;" "==q[n];)n++;if(n>=q.length)break;c=q[n++];if("A">c||"Z"<c)"+"==c?0!=m.length&&"+"!=m.slice(-1)&&(m=m.slice(0,-1)+"+"):","==c&&("+"==m.slice(-1)&&(m=m.slice(0,-1)+"l"),m+="\n");else{if(d[c])g[c]++;else{if(!O[c])continue;d[c]=O[c].split("\n");g[c]=
1}m+=c;switch(q[n]){case "-":m+="l";n++;break;case "0":m+="c";n++;break;case "1":m+="r";n++;break;default:m+="c"}}}"+"==m.slice(-1)&&(m=m.slice(0,-1)+"l");m+="\n";var y={l:t.titlespace,c:t.titlespace,r:t.titlespace},z={l:0,c:.5*B,r:B},C={},E;q=m;for(n=0;;){C.l=C.c=C.r=p=0;for(u=n;;){c=q[u++];if("\n"==c)break;v=q[u++];if("+"==v)v=q[u+1];else if(0!=C[v])continue;if(E=d[c])(B=e[c])||(B="history"),r=lc(B),w=1.1*r.size,f[c]&&(w+=f[c]),p<w&&(p=w),C[v]=w}y.l+=p-C.l;y.c+=p-C.c;for(y.r+=p-C.r;;){c=q[n++];
if("\n"==c)break;v=q[n++];if(0!=d[c].length){E=d[c].shift();"+"==v&&(g[c]--,c=q[n++],v=q[n++],0<d[c].length&&(E=E?E+(" "+d[c].shift()):" "+d[c].shift()));(B=e[c])||(B="history");r=lc(B);w=1.1*r.size;f[c]&&(w+=f[c]);pa(r);u=z[v];p=y[v]+w;"Q"==c?(Pf(za.tempo),za.tempo.del||("l"!=v&&(r=wf(za.tempo),"c"==v&&(r*=.5),u-=r),xf(za.tempo,u,-p))):E&&la(u,-p,E,v);"T"==c&&(B=e.T="subtitle",f.T=t.subtitlespace);if(1>=g[c])for("T"==c&&(r=lc(B),w=1.1*r.size,f[c]&&(w+=f[c]),pa(r));0<d[c].length;)p+=w,E=d[c].shift(),
la(u,-p,E,v);g[c]--;y[v]=p}}y.c>y.l&&(y.l=y.c);y.r>y.l&&(y.l=y.r);if(n>=m.length)break;y.c=y.r=y.l}ia(y.l);ia(t.musicspace)}else{if(O.T&&0<=t.writefields.indexOf("T"))for(c=0;;){d=O.T.indexOf("\n",c);if(0>d){yd(O.T.substring(c),0!=c);break}yd(O.T.slice(c,d),0!=c);c=d+1}q=0;l.ckey.k_bagpipe&&!t.infoline&&0<=t.writefields.indexOf("R")&&(m=O.R);m&&(pa("composer"),la(0,-t.composerspace,m),q=t.composerspace);e=O.A;0<=t.writefields.indexOf("C")&&(f=O.C);0<=t.writefields.indexOf("O")&&(g=O.O);if(f||g||t.infoline){pa("composer");
ia(t.composerspace);0>t.aligncomposer?(y=0,v=" "):0==t.aligncomposer?(y=.5*B,v="c"):(y=B,v="r");n=q;if(f||g){0<=t.aligncomposer&&q!=n&&ia(q-n);for(c=0;;){ia(D.curfont.size);d=f?f.indexOf("\n",c):-1;if(0>d){hg(y,0,f?f.substring(c):null,g,v);break}la(y,0,f.slice(c,d),v);q+=D.curfont.size;c=d+1}n>q&&ia(n-q)}((m=m?null:O.R)||e)&&t.infoline&&(pa("info"),ia(D.curfont.size+t.infospace),hg(B,0,m,e,"r"),q+=D.curfont.size+t.infospace)}else n=t.composerspace;O.P&&0<=t.writefields.indexOf("P")&&(pa("parts"),
q=t.partsspace+D.curfont.size-q,0<q&&(n+=q),.01<n&&ia(n),la(0,0,O.P),n=0);ia(n+t.musicspace)}ce=0<=t.writefields.indexOf("M")?3:2;D.nbar=t.measurefirst;l.state=3;0==x.length?(zd("1"),k.clef.istart=k.key.istart,k.clef.iend=k.key.iend,k["default"]=!0):k||(k=x[0>Wa?0:G.top_voice]);k.init||a||(de([]),ve());for(a=0;a<x.length;a++)c=x[a],c.ulen=za.ulen,c.ckey.k_bagpipe&&!c.pos.stm&&(c.pos=A(c.pos),c.pos.stm=h.SL_BELOW);if(0>Wa){R=x.length-1;for(a=0;a<=R;a++)c=x[a],delete c["new"],c.st=c.cst=G.voices[a].st=
G.voices[a].range=a,G.staves[a]={stafflines:c.stafflines||"|||||",staffscale:1};G.nstaff=R}c=k;k=x[G.top_voice];ba(b);k=c}function ah(a,c){var b,d,e,f,g;if(!k.ignore){if(c){if(b=k.sym_cont,!b){p(1,"+: symbol line without music");return}}else if(k.sym_restart?(k.sym_start=b=k.sym_restart,k.sym_restart=null):b=k.sym_start,b||(b=k.sym),!b){p(1,"s: without music");return}for(e=0;;){for(;" "==a[e]||"\t"==a[e];)e++;d=a[e];if(!d)break;switch(d){case "|":for(;b&&b.type!=h.BAR;)b=b.next;if(!b){p(1,"Not enough measure bars for symbol line");
return}b=b.next;e++;continue;case "!":case '"':f=++e;e=a.indexOf(d,f);if(0>e){p(1,"!"==d?"No end of decoration":"No end of guitar chord");e=a.length;continue}g=a.slice(f-1,e+1);break;case "*":break;default:g=d.charCodeAt(0);if(128>g&&(g=Za[g],1<g.length&&("!"==g[0]||'"'==g[0]))){d=g[0];break}p(1,N.bad_char,d)}for(;b&&(b.type!=h.NOTE||b.grace);)b=b.next;if(!b){p(1,"Too many elements in symbol line");return}switch(d){case "!":tc([g.slice(1,-1)],b,b.prev);break;case '"':ib=b.a_gch,dg(g),ib&&Z.gch_build(b)}b=
b.next;e++}k.lyric_cont=b}}function bh(a,c){var b,d,e,f;if(!k.ignore){k.pos.voc!=h.SL_HIDDEN&&(k.have_ly=!0);if(c){if(b=k.lyric_cont,!b){p(1,"+: lyric without music");return}}else if(pa("vocal"),k.lyric_restart?(k.lyric_start=b=k.lyric_restart,k.lyric_restart=null,k.lyric_line=0):(k.lyric_line++,b=k.lyric_start),b||(b=k.sym),!b){p(1,"w: without music");return}for(e=0;;){for(;" "==a[e]||"\t"==a[e];)e++;if(!a[e])break;f=l.istart+e+2;switch(a[e]){case "|":for(;b&&b.type!=h.BAR;)b=b.next;if(!b){p(1,"Not enough measure bars for lyric line");
return}b=b.next;e++;continue;case "-":d="-\n";break;case "_":d="_\n";break;case "*":d="";break;default:if("\\"==a[e]&&e==a.length-1){k.lyric_cont=b;return}for(d="";a[e];){switch(a[e]){case "_":case "*":case "|":e--;case " ":case "\t":break;case "~":d+="\u00a0";e++;continue;case "-":d+="\n";break;case "\\":d+=a[++e];e++;continue;default:d+=a[e++];continue}break}}for(;b&&(b.type!=h.NOTE||b.grace);)b=b.next;if(!b){p(1,"Too many words in lyric line");return}d&&b.pos.voc!=h.SL_HIDDEN&&(d.match(/^\$\d/)&&
("0"==d[1]?pa("vocal"):pa("u"+d[1]),d=d.slice(2)),d={t:d,font:D.curfont,wh:Pa(d),istart:f,iend:f+d.length},b.a_ly||(b.a_ly=[]),b.a_ly[k.lyric_line]=d);b=b.next;e++}k.lyric_cont=b}}function Qf(a,c){var b,d,e,f,g,m,k,n,l=a.a_ly;for(k=f=0;k<l.length;k++)if(b=l[k])if(n=b.t,"-\n"==n||"_\n"==n)b.shift=0;else{m=b.wh[0];e=b.font.swfac;g=m+2*$c(" ")*e;a.type==h.GRACE?m=a.wl:"0"<=n[0]&&"9">=n[0]&&2<n.length||":"==n[1]||"("==n[0]||")"==n[0]?("("==n[0]?d=$c("(")*e:(d=n.indexOf("\u00a0"),pa(b.font),d=0<d?Pa(n.slice(0,
d))[0]:.2*m),m=.4*(m-d+2*$c(" ")*e),20<m&&(m=20),m+=d,"0"<=b.t[0]&&"9">=b.t[0]&&m>f&&(f=m)):(m=.4*g,20<m&&(m=20));b.shift=m;c<m&&(c=m);g-=m;m=2*$c(" ")*e;for(b=a.next;b;b=b.next){switch(b.type){case h.NOTE:case h.REST:if(b.a_ly&&b.a_ly[k])if("-\n"==b.a_ly[k].t||"_\n"==b.a_ly[k].t)g-=m;else break;else g-=9;if(0>=g)break;continue;case h.CLEF:case h.METER:case h.KEY:g-=10;continue;default:g-=5}break}g>a.wr&&(a.wr=g)}if(0<f)for(k=0;k<l.length;k++)(b=l[k])&&"0"<=b.t[0]&&"9">=b.t[0]&&(b.shift=f);return c}
function yg(a,c,b){var d,e,f,g,m,k,n,l,r,v;a.hy_st&1<<c&&(n=!0,a.hy_st&=~(1<<c));for(g=a.sym;g.type==h.CLEF||g.type==h.KEY||g.type==h.METER;g=g.next);e=g.prev?g.prev.x:V.x;for(r=0;g;g=g.next)if(k=g.a_ly?g.a_ly[c]:null)if(k.font!=D.curfont&&(D.curfont=k.font),d=k.t,f=k.wh[0],v=k.shift,n&&("_\n"==d?d="-\n":"-\n"!=d&&(mg(e,b,g.x-v-e),n=!1,e=g.x+g.wr)),l&&"_\n"!=d&&(Id(e+3,b,r-e+3),l=!1,e=g.x+g.wr),"-\n"==d||"_\n"==d)0==r&&e>g.x-18&&(e=g.x-18),"-"==d[0]?n=!0:l=!0,r=g.x-v;else{r=g.x-v;"\n"==d.slice(-1)&&
(d=d.slice(0,-1),n=!0);if(w.anno_start||w.anno_stop)m={st:g.st,istart:k.istart,iend:k.iend,x:r,y:b,ymn:b,ymx:b+D.curfont.size,wl:0,wr:f},qb(m,"lyrics");la(r,b,d,null,null,k.wh);zb(m,"lyrics");e=r+f}else switch(g.type){case h.REST:case h.MREST:l&&(Id(e+3,b,r-e),l=!1,e=g.x+g.wr)}n&&(r=Aa-10,r<e+10&&(r=e+10),mg(e,b,r-e),t.hyphencont&&(a.hy_st|=1<<c));for(a.s_next;g;g=g.next)if(g.type==h.NOTE){if(!g.a_ly)break;(k=g.a_ly[c])&&"_\n"==k.t&&(l=!0,r=Aa-15,r<e+12&&(r=e+12));break}l&&Id(e+3,b,r-e+3)}function zg(a,
c,b,d,e){var f=u[a.st].staffscale;pa("vocal");if(0<e){d>-t.vocalspace&&(d=-t.vocalspace);d*=f;for(e=0;e<c;e++)d-=1.1*b[e],yg(a,e,d);return(d-b[e-1]/6)/f}e=u[a.st].topbar+t.vocalspace;d<e&&(d=e);d*=f;for(e=c;0<=--e;)yg(a,e,d),d+=1.1*b[e];return d/f}function dg(a){function c(){for(var a="";;){b=d[m++];if(0>"1234567890.-".indexOf(b))return parseFloat(a);a+=b}}var b,d,e,f,g,m,q,n,t=lc("annotation"),r=t.size;e=l.line;q=l.bol+e.index;if(1<a.length)d=a.slice(1,-1),n=q+1;else{for(d="";;){b=e.next_char();
if(!b){p(1,"No end of guitar chord");return}if('"'==b)break;"\\"==b&&(d+=b,b=e.next_char());d+=b}n=l.bol+e.index+1}if(k.pos.gch!=h.SL_HIDDEN)for(t.box&&(r+=3),m=0,a="g";;){b=d[m];if(!b)break;e={text:"",istart:q,iend:n,font:t};switch(b){case "@":a=b;m++;f=c();","!=b?(p(1,"',' lacking in annotation '@x,y'"),g=0):(g=c()," "!=b&&m--);e.x=f;e.y=g-r/2;break;case "^":case "_":case "<":case ">":m++;a=b;break;default:switch(a){case "g":e.font=lc("gchord");break;case "@":e.x=f,g-=r,e.y=g-r/2}}for(e.type=a;;){b=
d[m];if(!b)break;switch(b){case "\\":b=d[++m];if(!b||"n"==b)break;e.text+="\\";default:e.text+=b;m++;continue;case "&":for(;;){e.text+=b;b=d[++m];switch(b){default:continue;case ";":case void 0:case "\\":}break}if(";"==b){m++;e.text+=b;continue}case ";":}m++;break}ib||(ib=[]);ib.push(e)}}function Ag(a,c){var b,d,e,f,g;d="CDEFGAB".indexOf(a[0]);if(0>d&&"/"!=a[0])return a;f=1;if(0<=d){for(e=0;"#"==a[f];)e++,f++;for(;"b"==a[f];)e--,f++;d=ge[d]+c+7*e;e=Mb[(d+112)%7];b="CDEFGAB"[e]+Bg[(((d+22)/7|0)+159)%
5]}g=a.indexOf("/",f);if(0>g)return b+a.slice(f);d="CDEFGAB".indexOf(a[++g]);if(0>d)return b+a.slice(f);b+=a.slice(f,g);e=0;"#"==a[++g]?(e++,"#"==a[++g]&&(e++,g++)):"b"==a[g]&&(e--,"b"==a[++g]&&(e--,g++));d=ge[d]+c+7*e;e=Mb[(d+112)%7];return b+"CDEFGAB"[e]+Bg[(((d+22)/7|0)+159)%5]+a.slice(g)}function uh(a){var c,b,d=k.ckey.k_sf-k.okey.k_sf;for(b=0;b<a.a_gch.length;b++)c=a.a_gch[b],"g"==c.type&&(c.text=Ag(c.text,d))}function $g(){function a(a){for(var b=0;b<a.length;b++)a[b](Z)}var c=abc2svg.modules.hooks,
b=abc2svg.modules.g_hooks;Cg?c.length&&(a(c),b.push.apply(b,c),abc2svg.modules.hooks=[]):(c.length&&(b.push.apply(b,c),abc2svg.modules.hooks=[]),a(b),Cg=!0)}var h=abc2svg.C,N={bad_char:"Bad character '$1'",bad_val:"Bad value in $1",bar_grace:"Cannot have a bar in grace notes",ignored:"$1: inside tune - ignored",misplaced:"Misplaced '$1' in %%staves",must_note:"!$1! must be on a note",must_note_rest:"!$1! must be on a note or a rest",nonote_vo:"No note in voice overlay",not_ascii:"Not an ASCII character",
not_enough_n:"Not enough notes/rests for %%repeat",not_enough_m:"Not enough measures for %%repeat",not_in_tune:"Cannot have '$1' inside a tune"},Z=this,za={meter:{type:h.METER,wmeasure:1,a_meter:[]}},O={},mc={},Yc=new Int8Array(128),l={ctx:{},prefix:"%",state:0,ottava:[],line:new qa},rg,sc={},oa,pd={dot:"0 stc 5 1 1",tenuto:"0 emb 5 3 3",slide:"1 sld 3 7 0",arpeggio:"2 arp 12 10 0",roll:"3 roll 7 6 6",fermata:"3 hld 12 7 7",emphasis:"3 accent 7 4 4",lowermordent:"3 lmrd 10 5 5",coda:"3 coda 24 10 10",
uppermordent:"3 umrd 10 5 5",segno:"3 sgno 22 8 8",trill:"3 trl 14 5 5",upbow:"3 upb 10 5 5",downbow:"3 dnb 9 5 5",gmark:"3 grm 6 5 5",wedge:"3 wedge 8 3 3",turnx:"3 turnx 10 0 5",breath:"3 brth 0 1 20",longphrase:"3 lphr 0 1 1",mediumphrase:"3 mphr 0 1 1",shortphrase:"3 sphr 0 1 1",invertedfermata:"3 hld 12 7 7",invertedturn:"3 turn 10 0 5",invertedturnx:"3 turnx 10 0 5",0:"3 fng 8 3 3 0",1:"3 fng 8 3 3 1",2:"3 fng 8 3 3 2",3:"3 fng 8 3 3 3",4:"3 fng 8 3 3 4",5:"3 fng 8 3 3 5",plus:"3 dplus 7 3 3",
"+":"3 dplus 7 3 3",accent:"3 accent 7 4 4",">":"3 accent 7 4 4",marcato:"3 marcato 9 3 3","^":"3 marcato 9 3 3",mordent:"3 lmrd 10 5 5",open:"3 opend 10 3 3",snap:"3 snap 14 3 3",thumb:"3 thumb 14 3 3",dacapo:"3 dacs 16 20 20 Da Capo",dacoda:"3 dacs 16 20 20 Da Coda","D.C.":"3 dcap 16 10 10","D.S.":"3 dsgn 16 10 10","D.C.alcoda":"3 dacs 16 38 38 D.C. al Coda","D.S.alcoda":"3 dacs 16 38 38 D.S. al Coda","D.C.alfine":"3 dacs 16 38 38 D.C. al Fine","D.S.alfine":"3 dacs 16 38 38 D.S. al Fine",fine:"3 dacs 16 10 10 Fine",
turn:"3 turn 10 0 5","trill(":"3 ltr 8 0 0","trill)":"3 ltr 8 0 0",f:"6 f 18 1 7",ff:"6 ff 18 2 10",fff:"6 fff 18 4 13",ffff:"6 ffff 18 6 16",mf:"6 mf 18 6 13",mp:"6 mp 18 6 16",p:"6 p 18 2 8",pp:"6 pp 18 5 14",ppp:"6 ppp 18 8 20",pppp:"6 pppp 18 10 25",pralltriller:"3 umrd 10 5 5",sfz:"6 sfz 18 4 10",ped:"4 ped 18 8 8","ped-up":"4 pedoff 18 8 8","ped(":"4 lped 20 1 1","ped)":"4 lped 20 1 1","crescendo(":"6 cresc 18 0 0","crescendo)":"6 cresc 18 0 0","<(":"6 cresc 18 0 0","<)":"6 cresc 18 0 0","diminuendo(":"6 dim 18 0 0",
"diminuendo)":"6 dim 18 0 0",">(":"6 dim 18 0 0",">)":"6 dim 18 0 0","-(":"8 gliss 0 0 0","-)":"8 gliss 0 0 0","~(":"8 glisq 0 0 0","~)":"8 glisq 0 0 0","8va(":"3 8va 10 0 0","8va)":"3 8va 10 0 0","8vb(":"4 8vb 10 0 0","8vb)":"4 8vb 10 0 0","15ma(":"3 15ma 10 0 0","15ma)":"3 15ma 10 0 0","15mb(":"4 15mb 10 0 0","15mb)":"4 15mb 10 0 0",invisible:"32 0 0 0 0",beamon:"33 0 0 0 0",trem1:"34 0 0 0 0",trem2:"34 0 0 0 0",trem3:"34 0 0 0 0",trem4:"34 0 0 0 0",xstem:"35 0 0 0 0",beambr1:"36 0 0 0 0",beambr2:"36 0 0 0 0",
rbstop:"37 0 0 0 0","/":"38 0 0 6 6","//":"38 0 0 6 6","///":"38 0 0 6 6","beam-accel":"39 0 0 0 0","beam-rall":"39 0 0 0 0",stemless:"40 0 0 0 0",rbend:"41 0 0 0 0"},Og=[!0,!0,!0],vh=[!1,!1,!1,!0,!0,!0,!1,!1,!0],od=[!1,!1,!1,!1,!1,!1,!0,!0],hf=[function(a){var c,b,d=a.s,e=a.dd;e.str||(c=(b=d.multi?0<d.multi:0>d.stem)?d.ymx|0:d.ymn-e.h|0,-6<c&&24>c&&(b&&(c+=3),c=6*((c+6)/6|0)-6),b?d.ymx=c+e.h:d.ymn=c,a.y=c,d.type==h.NOTE&&(a.x+=d.notes[0<=d.stem?0:d.nhd].shhd),"d"==e.name[0]&&-1<=d.nflags&&(b?0<d.stem&&
(a.x+=3.5):0>d.stem&&(a.x-=3.5)))},function(a){var c,b,d=a.s,e=d.notes[0].pit,f=5;for(c=0;c<=d.nhd;c++){if(d.notes[c].acc)b=4+d.notes[c].shac;else switch(b=5-d.notes[c].shhd,d.head){case h.SQUARE:b+=3.5;break;case h.OVALBARS:case h.OVAL:b+=2}d.notes[c].pit<=e+3&&b>f&&(f=b)}a.x-=f;a.y=3*(e-18)},function(a){var c,b,d=a.s,e=a.dd,f=5;if(d.type==h.NOTE)for(c=0;c<=d.nhd;c++){if(d.notes[c].acc)b=5+d.notes[c].shac;else switch(b=6-d.notes[c].shhd,d.head){case h.SQUARE:b+=3.5;break;case h.OVALBARS:case h.OVAL:b+=
2}b>f&&(f=b)}b=3*(d.notes[d.nhd].pit-d.notes[0].pit)+4;c=e.h;b<c&&(b=c);a.has_val=!0;a.val=b;a.x-=f;a.y=3*(d.notes[0].pit-18)-3},Ie,Ie,Gc,function(a){var c,b,d,e=a.s,f=a.dd,g;if(!a.ldst)if(a.start)Uc(a);else{a.val=f.wl+f.wr;if(d=nd(e,e.pos.vol))a.up=!0;b=e.x-f.wl;0<a.ix&&(g=oa[a.ix-1],g.s==e&&(a.up&&!g.up||!a.up&&g.up)&&(c=g.dd,od[c.func]&&(c=g.x+g.val+4,c>b&&(b=c))));a.x=b;a.y=T(e.st,d,b,a.val);d||(a.y-=f.h)}},Uc],Wc=2.3,Ic,wh=[[16,16,14,12,10,10],[14,14,10,9,9,9]],Dg=new Int8Array([24,9,15,21,6,
12,18]),Eg=new Int8Array([12,18,24,9,15,21,6]),Fg=new Int8Array([-9,12,-9,-9,12,-9]),Gg=new Int8Array([12,-9,12,-9,12,-9]),Hg=new Int8Array([9,-12,9,-12,9,-12]),Ig=new Int8Array([-12,9,-12,9,-12,9]),xh="r128 r64 r32 r16 r8 r4 r2 r1 r0 r00".split(" "),Nb='url("data:application/octet-stream;base64,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LjAgOiBhYmMyc3ZnIDogOC0zLTIwMTkAAGEAYgBjADIAcwB2AGcAAGFiYzJzdmcAAFYAZQByAHMAaQBvAG4AIAAgAABWZXJzaW9uICAAAGEAYgBjADIAcwB2AGcAAGFiYzJzdmcAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACDAAAAAQACAQIAAwEDAQQBBQEGAQcBCAEJAQoBCwEMAQ0BDgEPARABEQESARMBFAEVARYBFwEYARkBGgEbARwBHQEeAR8BIAEhASIBIwEkASUBJgEnASgBKQEqASsBLAEtAS4BLwEwATEBMgEzATQBNQE2ATcBOAE5AToBOwE8AT0BPgE/AUABQQFCAUMBRAFFAUYBRwFIAUkBSgFLAUwBTQFOAU8BUAFRAVIBUwFUAVUBVgFXAVgBWQFaAVsBXAFdAV4BXwFgAWEBYgFjAWQBZQFmAWcBaAFpAWoBawFsAW0BbgFvAXABcQFyAXMBdAF1AXYBdwF4AXkBegF7AXwBfQF+AX8BgAYubm9kZWYHdW5pRTAwMAd1bmlFMDIyB3VuaUUwMjMHdW5pRTAyNAd1bmlFMDMwB3VuaUUwMzgHdW5pRTAzOQd1bmlFMDQzB3VuaUUwNDUHdW5pRTA0Ngd1bmlFMDQ3B3VuaUUwNDgHdW5pRTA1MAd1bmlFMDVDB3VuaUUwNjIHdW5pRTA2OQd1bmlFMDdBB3VuaUUwN0IHdW5pRTA3Qwd1bmlFMDdEB3VuaUUwODAHdW5pRTA4MQd1bmlFMDgyB3VuaUUwODMHdW5pRTA4NAd1bmlFMDg1B3VuaUUwODYHdW5pRTA4Nwd1bmlFMDg4B3VuaUUwODkHdW5pRTA4QQd1bmlFMDhCB3VuaUUwOEMHdW5pRTA5NAd1bmlFMDk1B3VuaUUwQTAHdW5pRTBBMQd1bmlFMEEyB3VuaUUwQTMHdW5pRTBBNAd1bmlFMEE5B3VuaUUwQjMHdW5pRTEwMQd1bmlFMUI5B3VuaUUxQkIHdW5pRTFFNwd1bmlFMjQwB3VuaUUyNDEHdW5pRTI0Mgd1bmlFMjQzB3VuaUUyNDQHdW5pRTI0NQd1bmlFMjQ2B3VuaUUyNDcHdW5pRTI0OAd1bmlFMjQ5B3VuaUUyNjAHdW5pRTI2MQd1bmlFMjYyB3VuaUUyNjMHdW5pRTI2NAd1bmlFMjgwB3VuaUUyODEHdW5pRTI4Mgd1bmlFMjgzB3VuaUU0QTAHdW5pRTRBMgd1bmlFNEE0B3VuaUU0QTgHdW5pRTRBQwd1bmlFNEMwB3VuaUU0Q0UHdW5pRTRFMQd1bmlFNEUyB3VuaUU0RTMHdW5pRTRFNAd1bmlFNEU1B3VuaUU0RTYHdW5pRTRFNwd1bmlFNEU4B3VuaUU0RTkHdW5pRTRFQQd1bmlFNEVFB3VuaUU1MDAHdW5pRTUwMQd1bmlFNTIwB3VuaUU1MjEHdW5pRTUyMgd1bmlFNTI0B3VuaUU1MjUHdW5pRTUyOQd1bmlFNTJBB3VuaUU1MkIHdW5pRTUyQwd1bmlFNTJEB3VuaUU1MkYHdW5pRTUzMAd1bmlFNTMxB3VuaUU1MzkHdW5pRTU2Ngd1bmlFNTY3B3VuaUU1NjkHdW5pRTU2Qwd1bmlFNTZEB3VuaUU1ODIHdW5pRTVEMAd1bmlFNUUyB3VuaUU2MTAHdW5pRTYxMgd1bmlFNjE0B3VuaUU2MTgHdW5pRTYyNAd1bmlFNjMwB3VuaUU2NTAHdW5pRTY1NQd1bmlFOTEwB3VuaUU5MTEHdW5pRTkxMgd1bmlFOTE0B3VuaUU5MTUHdW5pRTkxOAd1bmlFOTIwB3VuaUU5MjUHdW5pRTk1RAd1bmlFQTAyB3VuaUVBQTQAAAAAAf//AAIAAQAAAAAAAAAMABQABAAAAAIAAAABAAAAAQAAAAAAAQAAAADYcJpYAAAAANGXIhcAAAAA2CMtUg==") format("truetype")',
Kc=[],Gf={serif:1,serifBold:1,"sans-serif":1,"sans-serifBold":1,Palatino:1.1,monospace:1.35},Jg={},t={annotationfont:{name:"sans-serif",size:12},aligncomposer:1,breaklimit:.7,breakoneoln:!0,cancelkey:!0,composerfont:{name:"serifItalic",size:14},composerspace:6,dblrepbar:":][:",decoerr:!0,dynalign:!0,footerfont:{name:"serif",size:16},fullsvg:"",gchordfont:{name:"sans-serif",size:12},gracespace:new Float32Array([4,8,11]),graceslurs:!0,headerfont:{name:"serif",size:16},historyfont:{name:"serif",size:16},
hyphencont:!0,indent:0,infofont:{name:"serifItalic",size:14},infoname:'R "Rhythm: "\nB "Book: "\nS "Source: "\nD "Discography: "\nN "Notes: "\nZ "Transcription: "\nH "History: "',infospace:0,keywarn:!0,leftmargin:1.4*37.8,lineskipfac:1.1,linewarn:!0,maxshrink:.65,maxstaffsep:2E3,maxsysstaffsep:2E3,measurefirst:1,measurefont:{name:"serifItalic",size:10},measurenb:-1,musicspace:6,partsfont:{name:"serif",size:15},parskipfac:.4,partsspace:8,pagewidth:793.8,printmargin:0,rightmargin:1.4*37.8,rbdbstop:!0,
rbmax:4,rbmin:2,repeatfont:{name:"serif",size:13},scale:1,slurheight:1,staffsep:46,stemheight:21,stretchlast:.25,stretchstaff:!0,subtitlefont:{name:"serif",size:16},subtitlespace:3,sysstaffsep:34,tempofont:{name:"serifBold",size:12},textfont:{name:"serif",size:16},textspace:14,titlefont:{name:"serif",size:20},titlespace:6,titletrim:!0,topspace:22,tuplets:[0,0,0,0],vocalfont:{name:"serifBold",size:13},vocalspace:10,voicefont:{name:"serifBold",size:13},writefields:"CMOPQsTWw",wordsfont:{name:"serif",
size:16},wordsspace:5},Kg={align:"j",center:"c",fill:"f",justify:"j",ragged:"f",right:"r",skip:"s"},he={above:h.SL_ABOVE,auto:0,below:h.SL_BELOW,down:h.SL_BELOW,hidden:h.SL_HIDDEN,opposite:h.SL_HIDDEN,under:h.SL_BELOW,up:h.SL_ABOVE};Abc.prototype.style_font=sd;var Ua={},Xg={"=D":"\u0110","=H":"\u0126","=T":"\u0166","=d":"\u0111","=h":"\u0127","=t":"\u0167","/O":"\u00d8","/o":"\u00f8","/L":"\u0141","/l":"\u0142",vL:"\u013d",vl:"\u013e",vd:"\u010f",".i":"\u0131",AA:"\u00c5",aa:"\u00e5",AE:"\u00c6",
ae:"\u00e6",DH:"\u00d0",dh:"\u00f0",OE:"\u0152",oe:"\u0153",ss:"\u00df",TH:"\u00de",th:"\u00fe"},Wg={1:"\u266f",2:"\u266d",3:"\u266e",4:"&#x1d12a;",5:"&#x1d12b;"},Hb=0;Abc.prototype.tosvg=Xc;var D,u,R,Sb,Aa,ce,we,hb=new Float32Array([7,10,14.15,20,28.3,40,56.6,80,100,120]),be,Lf=new Float32Array([10,10,11,13,13]),ch=new Float32Array([4.5,5,6,7,8]),Oe=new Float32Array([3.5,3.7,5,6,7]),Kd={t:-4,c:0,b:4,p:-6},Lg=[[18,18],[12,18],[12,12],[0,12],[6,8],[10,10],[6,4],[10,0],[10,4],[10,10]],Pe=[],ib,sa,Na,
Jb={},mh=new Int8Array([0,1,3,2,3,0,2,0,3,0]),Cd="CDEFGABcdefgab",kh=new Int8Array([0,2,4,5,7,9,11]),Bd=/(\d*)(\/*)(\d*)/g,ge=new Int8Array([0,2,4,-1,1,3,5]),Mb=new Int8Array([0,4,1,5,2,6,3]),yh=new Int8Array([-2,-1,3,1,2]),I=["0"],Za=[I,I,I,I,I,I,I,I,I," ","\n",I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I," ","!",'"',"i","\n",I,"&",I,"(",")","i",I,I,"-","!dot!",I,I,I,I,I,I,I,I,I,I,I,"|","i","<","n","<","i","i","n","n","n","n","n","n","n","!fermata!","d","d","d","!emphasis!","!lowermordent!","d","!coda!",
"!uppermordent!","d","d","!segno!","!trill!","d","d","d","n","d","n","[","\\","|","n","n","i","n","n","n","n","n","n","n","d","d","d","d","d","d","d","d","d","d","d","d","d","!upbow!","!downbow!","d","n","n","n","{","|","}","!gmark!",I],cg={"8va(":1,"8va)":0,"15ma(":2,"15ma)":0,"8vb(":-1,"8vb)":0,"15mb(":-2,"15mb)":0},fg=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.25,.333,.408,.5,.5,.833,.778,.333,.333,.333,.5,.564,.25,.564,.25,.278,.5,.5,.5,.5,.5,.5,.5,.5,.5,
.5,.278,.278,.564,.564,.564,.444,.921,.722,.667,.667,.722,.611,.556,.722,.722,.333,.389,.722,.611,.889,.722,.722,.556,.722,.667,.556,.611,.722,.722,.944,.722,.722,.611,.333,.278,.333,.469,.5,.333,.444,.5,.444,.5,.444,.333,.5,.5,.278,.278,.5,.278,.778,.5,.5,.5,.5,.333,.389,.278,.5,.5,.722,.5,.5,.444,.48,.2,.48,.541,.5]),nh=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.278,.278,.355,.556,.556,.889,.667,.191,.333,.333,.389,.584,.278,.333,.278,.278,.556,.556,.556,
.556,.556,.556,.556,.556,.556,.556,.278,.278,.584,.584,.584,.556,1.015,.667,.667,.722,.722,.667,.611,.778,.722,.278,.5,.667,.556,.833,.722,.778,.667,.778,.722,.667,.611,.722,.667,.944,.667,.667,.611,.278,.278,.278,.469,.556,.333,.556,.556,.5,.556,.556,.278,.556,.556,.222,.222,.5,.222,.833,.556,.556,.556,.556,.333,.5,.278,.556,.5,.722,.5,.5,.5,.334,.26,.334,.584,.512]),eg=fg,Pa="undefined"!=typeof document?function(a){a.style.position="absolute";a.style.top="-1000px";a.style.padding="0";document.body.appendChild(a);
return function(c){var b,d=D.curfont,e=d.size,f=0,g=0,h=0;a.style.font=sd(d).slice(5);for(c=c.replace(/<|>|&[^&]*?;|&|  /g,function(a){switch(a){case "<":return"&lt;";case ">":return"&gt;";case "&":return"&amp;";case "  ":return" \u00a0"}return a});;){h=c.indexOf("$",h);if(0>h)break;b=c[h+1];if("0"==b)d=D.deffont;else if("1"<=b&&"9">=b)d=lc("u"+b);else{h++;continue}a.innerHTML=c.slice(g,h);f+=a.clientWidth;d.size>e&&(e=d.size);a.style.font=sd(d).slice(5);g=h+=2}a.innerHTML=c.slice(g);f+=a.clientWidth;
D.curfont=d;return[f,e]}}(document.createElement("div")):function(a){var c=D.curfont,b=c.swfac,d=c.size,e=0,f,g,h,k=a.length;for(f=0;f<k;f++){h=a[f];switch(h){case "$":h=a[f+1];if("0"==h)c=D.deffont;else if("1"<=h&&"9">=h)c=lc("u"+h);else{h="$";break}f++;b=c.swfac;c.size>d&&(d=c.size);continue;case "&":g=a.indexOf(";",f),0<g&&10>g-f&&(f=g,h="a")}e+=$c(h)*b}D.curfont=c;return[e,d]},th={A:"info",C:"composer",O:"composer",P:"parts",Q:"tempo",R:"info",T:"title",X:"title"},z="",Oc="\ntext, tspan{fill:currentColor}\n.stroke{stroke:currentColor;fill:none}\n.bW{stroke:currentColor;fill:none;stroke-width:1}\n.bthW{stroke:currentColor;fill:none;stroke-width:3}\n.slW{stroke:currentColor;fill:none;stroke-width:.7}\n.slthW{stroke:currentColor;fill:none;stroke-width:1.5}\n.sW{stroke:currentColor;fill:none;stroke-width:.7}",
vc="",ic=t.leftmargin/t.scale,ra=0,ga={width:t.pagewidth,lm:t.leftmargin,rm:t.rightmargin},Fd={},ad="",fe="",C={scale:1,dy:0,st:-1,v:0,g:0},Va={},te={"mtr ":{x:0,y:0,c:" "},brace:{x:0,y:0,c:"\ue000"},hl:{x:-4,y:0,c:"\ue022"},hl1:{x:-6,y:0,c:"\ue023"},ghl:{x:-4,y:0,c:"\ue024"},lphr:{x:0,y:24,c:"\ue030"},mphr:{x:0,y:24,c:"\ue038"},sphr:{x:0,y:27,c:"\ue039"},rdots:{x:-1,y:0,c:"\ue043"},dsgn:{x:-4,y:-4,c:"\ue045"},dcap:{x:-4,y:-4,c:"\ue046"},sgno:{x:-6,y:0,c:"\ue047"},coda:{x:-12,y:-6,c:"\ue048"},tclef:{x:-8,
y:0,c:"\ue050"},cclef:{x:-8,y:0,c:"\ue05c"},bclef:{x:-8,y:0,c:"\ue062"},pclef:{x:-6,y:0,c:"\ue069"},spclef:{x:-6,y:0,c:"\ue069"},stclef:{x:-8,y:0,c:"\ue07a"},scclef:{x:-8,y:0,c:"\ue07b"},sbclef:{x:-7,y:0,c:"\ue07c"},oct:{x:0,y:2,c:"\ue07d"},mtr0:{x:0,y:0,c:"\ue080"},mtr1:{x:0,y:0,c:"\ue081"},mtr2:{x:0,y:0,c:"\ue082"},mtr3:{x:0,y:0,c:"\ue083"},mtr4:{x:0,y:0,c:"\ue084"},mtr5:{x:0,y:0,c:"\ue085"},mtr6:{x:0,y:0,c:"\ue086"},mtr7:{x:0,y:0,c:"\ue087"},mtr8:{x:0,y:0,c:"\ue088"},mtr9:{x:0,y:0,c:"\ue089"},
mtrC:{x:0,y:0,c:"\ue08a"},"mtr+":{x:0,y:0,c:"\ue08c"},"mtr(":{x:0,y:0,c:"\ue094"},"mtr)":{x:0,y:0,c:"\ue095"},HDD:{x:-7,y:0,c:"\ue0a0"},breve:{x:-7,y:0,c:"\ue0a1"},HD:{x:-5.2,y:0,c:"\ue0a2"},Hd:{x:-3.8,y:0,c:"\ue0a3"},hd:{x:-3.7,y:0,c:"\ue0a4"},ghd:{x:2,y:0,c:"\ue0a4",sc:.66},pshhd:{x:-3.7,y:0,c:"\ue0a9"},pfthd:{x:-3.7,y:0,c:"\ue0b3"},x:{x:-3.7,y:0,c:"\ue0a9"},"circle-x":{x:-3.7,y:0,c:"\ue0b3"},srep:{x:-5,y:0,c:"\ue101"},diamond:{x:-4,y:0,c:"\ue1b9"},triangle:{x:-4,y:0,c:"\ue1bb"},dot:{x:-2,y:0,c:"\ue1e7"},
flu1:{x:-.3,y:0,c:"\ue240"},fld1:{x:-.3,y:0,c:"\ue241"},flu2:{x:-.3,y:0,c:"\ue242"},fld2:{x:-.3,y:0,c:"\ue243"},flu3:{x:-.3,y:3.5,c:"\ue244"},fld3:{x:-.3,y:-4,c:"\ue245"},flu4:{x:-.3,y:8,c:"\ue246"},fld4:{x:-.3,y:-9,c:"\ue247"},flu5:{x:-.3,y:12.5,c:"\ue248"},fld5:{x:-.3,y:-14,c:"\ue249"},"acc-1":{x:-1,y:0,c:"\ue260"},acc3:{x:-1,y:0,c:"\ue261"},acc1:{x:-2,y:0,c:"\ue262"},acc2:{x:-3,y:0,c:"\ue263"},"acc-2":{x:-3,y:0,c:"\ue264"},"acc-1_1_4":{x:-2,y:0,c:"\ue280"},"acc-1_3_4":{x:-3,y:0,c:"\ue281"},acc1_1_4:{x:-1,
y:0,c:"\ue282"},acc1_3_4:{x:-3,y:0,c:"\ue283"},accent:{x:-3,y:0,c:"\ue4a0"},stc:{x:-1,y:-2,c:"\ue4a2"},emb:{x:-4,y:-2,c:"\ue4a4"},wedge:{x:-1,y:0,c:"\ue4a8"},marcato:{x:-3,y:0,c:"\ue4ac"},hld:{x:-7,y:0,c:"\ue4c0"},brth:{x:0,y:0,c:"\ue4ce"},r00:{x:-1.5,y:0,c:"\ue4e1"},r0:{x:-1.5,y:0,c:"\ue4e2"},r1:{x:-3.5,y:-6,c:"\ue4e3"},r2:{x:-3.2,y:0,c:"\ue4e4"},r4:{x:-3,y:0,c:"\ue4e5"},r8:{x:-3,y:0,c:"\ue4e6"},r16:{x:-4,y:0,c:"\ue4e7"},r32:{x:-4,y:0,c:"\ue4e8"},r64:{x:-4,y:0,c:"\ue4e9"},r128:{x:-4,y:0,c:"\ue4ea"},
mrest:{x:-10,y:0,c:"\ue4ee"},mrep:{x:-6,y:0,c:"\ue500"},mrep2:{x:-9,y:0,c:"\ue501"},p:{x:-4,y:-6,c:"\ue520"},f:{x:-4,y:-6,c:"\ue522"},pppp:{x:-4,y:-6,c:"\ue529"},ppp:{x:-4,y:-6,c:"\ue52a"},pp:{x:-4,y:-6,c:"\ue52b"},mp:{x:-4,y:-6,c:"\ue52c"},mf:{x:-4,y:-6,c:"\ue52d"},ff:{x:-4,y:-6,c:"\ue52f"},fff:{x:-4,y:-6,c:"\ue530"},ffff:{x:-4,y:-6,c:"\ue531"},sfz:{x:-4,y:-6,c:"\ue539"},trl:{x:-4,y:-4,c:"\ue566"},turn:{x:-5,y:-4,c:"\ue567"},turnx:{x:-5,y:-4,c:"\ue569"},umrd:{x:-7,y:-2,c:"\ue56c"},lmrd:{x:-7,y:-2,
c:"\ue56d"},dplus:{x:-4,y:10,c:"\ue582"},sld:{x:-8,y:12,c:"\ue5d0"},grm:{x:-2,y:0,c:"\ue5e2"},dnb:{x:-4,y:0,c:"\ue610"},upb:{x:-3,y:0,c:"\ue612"},opend:{x:-2,y:0,c:"\ue614"},roll:{x:0,y:0,c:"\ue618"},thumb:{x:0,y:0,c:"\ue624"},snap:{x:-2,y:0,c:"\ue630"},ped:{x:-10,y:0,c:"\ue650"},pedoff:{x:-5,y:0,c:"\ue655"},mtro:{x:0,y:0,c:"\ue911"},mtrc:{x:0,y:0,c:"\ue915"},"mtr.":{x:0,y:0,c:"\ue920"},"mtr|":{x:0,y:0,c:"\ue925"},longa:{x:-3.7,y:0,c:"\ue95d"},custos:{x:-4,y:3,c:"\uea02"},ltr:{x:2,y:6,c:"\ueaa4"}},
Gb={},kg="bar clef custos  grace key meter Zrest note part rest yspace staves Break tempo  block remark".split(" "),qb=w.anno_start?oh:lg,zb=w.anno_stop?ph:lg;Abc.prototype.out_svg=function(a){z+=a};Abc.prototype.sx=Gd;Abc.prototype.sy=Hd;Abc.prototype.sh=function(a){return 0>C.st?a/C.scale:a};Abc.prototype.ax=function(a){return a+ic};Abc.prototype.ay=function(a){return 0>C.st?ra-a:ra+(C.dy-a)*C.scale-C.dy};Abc.prototype.ah=function(a){return 0>C.st?a:a*C.scale};Abc.prototype.out_sxsy=kb;Abc.prototype.xypath=
Xd;var qh={crdc:{dx:0,dy:5,style:"font:italic 14px serif"},dacs:{dx:0,dy:3,style:"font:16px serif",anchor:' text-anchor="middle"'},fng:{dx:0,dy:1,style:"font-family:Bookman; font-size:8px",anchor:' text-anchor="middle"'},pf:{dx:0,dy:5,style:"font:italic bold 16px serif"},"@":{dx:0,dy:5,style:"font: 12px sans-serif"}},qg={arp:og,cresc:function(a,c,b,d){a+=b;b=-b;W('<path class="stroke"\n\td="mX YlA ',a,c+5,b);z=d.nost?z+("-2.2m0 -3.6l"+(-b).toFixed(1)+' -2.2"/>\n'):z+("-4l"+(-b).toFixed(1)+' -4"/>\n')},
dim:function(a,c,b,d){W('<path class="stroke"\n\td="mX YlA ',a,c+5,b);z=d.noen?z+("-2.2m0 -3.6l"+(-b).toFixed(1)+' -2.2"/>\n'):z+("-4l"+(-b).toFixed(1)+' -4"/>\n')},ltr:pg,lped:function(a,c,b,d){c+=4;d.nost||ca(a,c,"ped");d.noen||ca(a+b,c,"pedoff")},"8va":function(a,c,b,d){d.nost?b-=5:(W('<text x="X" y="Y" style="font:italic bold 12px serif">8<tspan dy="-4" style="font-size:10px">va</tspan></text>\n',a-8,c),a+=12,b-=12);c+=6;W('<path class="stroke" stroke-dasharray="6,6" d="mX YhF"/>\n',a,c,b);d.noen||
W('<path class="stroke" d="mX Yv6"/>\n',a+b,c)},"8vb":function(a,c,b,d){d.nost?b-=5:(W('<text x="X" y="Y" style="font:italic bold 12px serif">8<tspan dy="-4" style="font-size:10px">vb</tspan></text>\n',a-8,c),a+=4,b-=4);W('<path class="stroke" stroke-dasharray="6,6" d="mX YhF"/>\n',a,c,b);d.noen||W('<path class="stroke" d="mX Yv-6"/>\n',a+b,c)},"15ma":function(a,c,b,d){d.nost?b-=5:(W('<text x="X" y="Y" style="font:italic bold 12px serif">15<tspan dy="-4" style="font-size:10px">ma</tspan></text>\n',
a-10,c),a+=20,b-=20);c+=6;W('<path class="stroke" stroke-dasharray="6,6" d="mX YhF"/>\n',a,c,b);d.noen||W('<path class="stroke" d="mX Yv6"/>\n',a+b,c)},"15mb":function(a,c,b,d){d.nost?b-=5:(W('<text x="X" y="Y" style="font:italic bold 12px serif">15<tspan dy="-4" style="font-size:10px">mb</tspan></text>\n',a-10,c),a+=7,b-=7);W('<path class="stroke" stroke-dasharray="6,6" d="mX YhF"/>\n',a,c,b);d.noen||W('<path class="stroke" d="mX Yv-6"/>\n',a+b,c)}},Mg={glisq:function(a,c,b){b=b.start;var d=b.x,
e=b.y+u[b.st].y;c=Math.atan2(e-c,a-d);a=(a-d)/Math.cos(c);Zd(d,e,c/Math.PI*180);d=b.s.dots?13+b.s.xmx:8;a=(a-d-6)/6|0;for(1>a&&(a=1);0<=--a;)ca(d,0,"ltr"),d+=6;$d()},gliss:function(a,c,b){b=b.start;var d=b.x,e=b.y+u[b.st].y;c=-Math.atan2(c-e,a-d);a=(a-d)/Math.cos(c);Zd(d,e,c/Math.PI*180);d=b.s.dots?13+b.s.xmx:8;a-=d+8;Xd(d,0);z+="h"+a.toFixed(1)+'" stroke-width="1"/>\n';$d()}};Abc.prototype.blk_out=Ib;Abc.prototype.blk_flush=Lc;var G,E,x,k,Wa,va,V,Ab=new Uint8Array([2,1,8,0,3,5,6,9,9,0,9,3,0,7,0,
0,0,0]),Bg=["bb","b","","#","##"];If();Abc.prototype.add_style=function(a){Oc+=a};Abc.prototype.calculate_beam=function(a,c){var b,d,e,f,g,m,k,n,l,r,v,p,x,w,y;c.beam_st||(d=b=yf(c),g=c,d.next=g,d.prev=g.prev,d.prev?d.prev.next=d:d.p_v.sym=d,g.prev=d,Kb(b,c),b.x-=12,b.x>c.prev.x+12&&(b.x=c.prev.x+12),b.beam_st=!0,delete b.beam_end,b.tmp=!0,delete b.slur_start,delete b.slur_end,c=b);f=g=0;k=n=!1;m=c.st;e=c.v;p=c.grace?Wc:3.5;for(d=c;d.type!=h.NOTE||(d.nflags>g&&(g=d.nflags),f++,d.st!=m&&(k=!0),d.stem!=
c.stem&&(n=!0),l||d.invis||d.stemless&&!d.trem2||(l=!0),!d.beam_end);d=d.next)if(!d.next){for(;d.type!=h.NOTE;d=d.prev);b=yf(d);b.next=d.next;b.next&&(b.next.prev=b);d.next=b;b.prev=d;b.ts_next=d.ts_next;b.ts_next&&(b.ts_next.ts_prev=b);d.ts_next=b;b.ts_prev=d;delete b.beam_st;b.beam_end=!0;b.tmp=!0;delete b.slur_start;delete b.slur_end;b.x+=12;b.x<Aa-12&&(b.x=Aa-12);d=b;f++;break}if(!l)return!1;a.s2=d;if(0==u[m].y){if(k)return!1}else if(!k)return a.s1=c,a.a=(c.ys-d.ys)/(c.xs-d.xs),a.b=c.ys-c.xs*
a.a+u[m].y,a.nflags=g,!0;w=c;x=100;v=0;for(b=c;b.type!=h.NOTE||(1==(y=b.p_v.scale)&&(y=u[b.st].staffscale),0<=b.stem?(l=p+b.notes[0].shhd,b.notes[b.nhd].pit>v&&(v=b.notes[b.nhd].pit,w=b)):(l=-p+b.notes[b.nhd].shhd,b.notes[0].pit<x&&(x=b.notes[0].pit,w=b)),b.xs=b.x+l*y,b!=d);b=b.next);t.flatbeams?r=0:!n&&3<=f&&w!=c&&w!=d&&(r=0);l=c.ys+u[m].y;void 0==r&&(r=(d.ys+u[d.st].y-l)/(d.xs-c.xs));0!=r&&(r=0<r?.4*r/(.4+r):.4*r/(.4-r));f=(l+d.ys+u[d.st].y)/2-r*(d.xs+c.xs)/2;p=0;b=c;if(n)l=.5*((c.grace?3.5:5)*
(g-1)+3.2),f=c.stem!=d.stem&&c.nflags<d.nflags?f+l*d.stem:f+l*c.stem;else if(c.grace)for(;l=r*b.xs+f-u[b.st].y,v=13,v=0<b.stem?v-(l-3*(b.notes[b.nhd].pit-18)):v+(l-3*(b.notes[0].pit-18)),v+=3*(b.nflags-1),v>p&&(p=v),b!=d;b=b.next);else{for(x=3.2+5*(g-1);b.ts_prev&&b.ts_prev.type==h.NOTE&&b.ts_prev.time==b.time&&b.ts_prev.x>c.xs;)b=b.ts_prev;for(;b&&b.time<=d.time;b=b.ts_next)if(!(b.type!=h.NOTE||b.invis||b.st!=m&&b.v!=e)){l=b.v==e?b.xs:b.x;l=r*l+f-u[b.st].y;if(b.v==e)v=wh[0==b.nhd?0:1][b.nflags],
0<b.stem?(26<b.notes[b.nhd].pit&&(v-=2,28<b.notes[b.nhd].pit&&(v-=2)),v-=l-3*(b.notes[b.nhd].pit-18)):(18>b.notes[0].pit&&(v-=2,16>b.notes[0].pit&&(v-=2)),v-=3*(b.notes[0].pit-18)-l),v+=3.2+5*(b.nflags-1);else{if(0<c.stem)if(0<b.stem){if(b.ymn>l+4||b.ymx<l-x-2)continue;v=b.v>e?b.ymx-l:b.ymn+8-l}else v=b.ymx-l;else if(0>b.stem){if(b.ymx<l-4||b.ymn>l-x-2)continue;v=b.v<e?l-b.ymn:l-b.ymx+8}else v=l-b.ymn;v+=2+x}v>p&&(p=v)}}0<p&&(f+=c.stem*p);if(!k&&!n)for(b=c.next;;b=b.next){switch(b.type){case h.REST:if(e=
b.ts_next,!e||e.st!=m||e.type!=h.NOTE&&e.type!=h.REST)break;case h.BAR:if(b.invis)break;case h.CLEF:l=r*b.x+f;0<c.stem?(l=b.ymx-l+3.2+5*(g-1)+2,0<l&&(f+=l)):(l=b.ymn-l-3.2-5*(g-1)-2,0>l&&(f+=l));break;case h.GRACE:for(e=b.extra;e;e=e.next)l=r*e.x+f,0<c.stem?(l=e.ymx-l+3.2+5*(g-1)+2,0<l&&(f+=l)):(l=e.ymn-l-3.2-5*(g-1)-2,0>l&&(f+=l))}if(b==d)break}0==r&&(f+=Pg(c.grace,c.stem,g,f-u[m].y));for(b=c;;b=b.next){switch(b.type){case h.NOTE:b.ys=r*b.xs+f-u[b.st].y;0<b.stem?(b.ymx=b.ys+2.5,b.ts_prev&&0<b.ts_prev.stem&&
b.ts_prev.st==b.st&&b.ts_prev.ymn<b.ymx&&b.ts_prev.x==b.x&&0==b.notes[0].shhd&&(b.ts_prev.x-=3,b.ts_prev.xs-=3)):b.ymn=b.ys-2.5;break;case h.REST:l=r*b.x+f-u[b.st].y;e=3.2+5*(g-1)+(b.head!=h.FULL?4:9);if(0<c.stem){if(l-=e,0==c.multi&&12<l&&(l=12),b.y<=l)break}else if(l+=e,0==c.multi&&12>l&&(l=12),b.y>=l)break;b.head!=h.FULL&&(l=6*((l+3+12)/6|0)-12);b.y=l}if(b==d)break}if(0==u[m].y)return!1;a.s1=c;a.a=r;a.b=f;a.nflags=g;return!0};Abc.prototype.cfmt=function(){return t};Abc.prototype.clone=A;Abc.prototype.deco_cnv=
tc;Abc.prototype.do_pscom=function(a){var c,b;if(b=a.match(/(\w|-)+/)){b=b[0];a=a.replace(b,"").trim();if(" lock"==a.slice(-5))Jg[b]=!0,a=a.slice(0,-5).trim();else if(Jg[b])return;switch(b){case "center":if(2<=l.state){b=Ub("text");b.text=nb(a);b.opt="c";return}xd(nb(a),"c");return;case "clef":2<=l.state&&(2==l.state&&$a(),(b=Yf(a))&&xg(b));return;case "deco":b=a.match(/(\S*)\s+(.*)/);pd[b[1]]=b[2];return;case "linebreak":for(b=0;128>b;b++)"\n"==Za[b]&&(Za[b]=I);a=a.split(/\s+/);for(b=0;b<a.length;b++){c=
a[b];switch(c){case "!":case "$":case "*":case ";":case "?":case "@":break;case "<none>":continue;case "<EOL>":c="\n";break;default:p(1,"Bad value '$1' in %%linebreak - ignored",c);continue}Za[c.charCodeAt(0)]="\n"}return;case "map":a:if(a){var d;b=Jc(a);if(3>b.length)p(1,"Not enough parameters in %%map");else{d=b[1];if(0==d.indexOf("octave,")||0==d.indexOf("key,"))d=d.replace(/[,']+$/m,"").toLowerCase(),"k"==d[0]&&(d=d.replace(/[_=^]+/,""));else if("*"==d[0]||0==d.indexOf("all"))d="all";else{d=new qa;
d.buffer=b[1];a=nc(d);if(!a){p(1,"Bad note in %%map");break a}d=bg(a)}(c=Jb[b[0]])||(Jb[b[0]]=c={});(a=c[d])||(c[d]=a=[]);if(b[2]){c=2;if(0>b[2].indexOf("=")){"*"!=b[2][0]&&(d=new qa,d.buffer=b[2],a[1]=nc(d));if(!b[3])break a;c++;0>b[3].indexOf("=")&&(a[0]=b[3].split(","),c++)}for(;c<b.length;c++)switch(b[c]){case "heads=":a[0]=b[++c].split(",");break;case "print=":if("play"==t.sound)break;d=new qa;d.buffer=b[++c];a[1]=nc(d);break;case "color=":a[2]=b[++c]}}}}return;case "maxsysstaffsep":if(3==l.state){G.voices[k.v].maxsep=
mb(a);return}break;case "multicol":Hf();switch(a){case "start":Ib();Na={posy:ra,maxy:ra,lmarg:t.leftmargin,rmarg:t.rightmargin,state:l.state};break;case "new":if(!Na){p(1,"%%multicol new without start");break}ra>Na.maxy&&(Na.maxy=ra);t.leftmargin=Na.lmarg;t.rightmargin=Na.rmarg;ga.chg=!0;rb();ra=Na.posy;break;case "end":if(!Na){p(1,"%%multicol end without start");break}ra<Na.maxy&&(ra=Na.maxy);t.leftmargin=Na.lmarg;t.rightmargin=Na.rmarg;Na=void 0;Lc();ga.chg=!0;rb();break;default:p(1,"Unknown keyword '$1' in %%multicol",
a)}return;case "musicfont":Nb=a;return;case "ottava":if(3!=l.state){if(2!=l.state)return;$a()}b=parseInt(a);if(isNaN(b)||-2>b||2<b){p(1,N.bad_val,"%%ottava");return}za.ottava=!0;l.ottava.push(b);return;case "repbra":2<=l.state&&(2==l.state&&$a(),k.norepbra=!kc(a));return;case "repeat":if(3!=l.state)return;if(!k.last_sym){p(1,"%%repeat cannot start a tune");return}if(a.length){a=a.split(/\s+/);b=parseInt(a[0]);a=parseInt(a[1]);if(isNaN(b)||1>b||k.last_sym.type==h.BAR&&2<b){p(1,"Incorrect 1st value in %%repeat");
return}if(isNaN(a))a=1;else if(1>a){p(1,"Incorrect 2nd value in %%repeat");return}}else a=b=1;l.repeat_n=k.last_sym.type==h.BAR?b:-b;l.repeat_k=a;return;case "sep":var e,f;rb();f=ga.width-ga.lm-ga.rm;c=d=e=0;a&&(a=a.split(/\s+/),c=mb(a[0]),a[1]&&(d=mb(a[1]),a[2]&&(e=mb(a[2]))));1>c&&(c=14);1>d&&(d=c);1>e&&(e=90);if(2<=l.state){b=Ub(b);b.x=(f-e)/2/t.scale;b.l=e/t.scale;b.sk1=c;b.sk2=d;return}Ib();ia(c);z+='<path class="stroke"\n\td="M';kb((f-e)/2/t.scale," ",0);z+="h"+(e/t.scale).toFixed(1)+'"/>\n';
ia(d);Lc();return;case "setbarnb":c=parseInt(a);isNaN(c)||1>c?p(1,"Bad %%setbarnb value"):2<=l.state?za.new_nbar=c:t.measurefirst=c;return;case "staff":if(3!=l.state){if(2!=l.state)return;$a()}c=parseInt(a);if(isNaN(c)){p(1,"Bad %%staff value '$1'",a);return}b="+"==a[0]||"-"==a[0]?k.cst+c:c-1;if(0>b||b>R){p(1,"Bad %%staff number $1 (cur $2, max $3)",b,k.cst,R);return}delete k.floating;k.cst=b;return;case "staffbreak":if(3!=l.state){if(2!=l.state)return;$a()}b={type:h.STBRK,dur:0};"0"<=a[0]&&"9">=
a[0]?(b.xmx=mb(a),"f"==a.slice(-1)&&(b.stbrk_forced=!0)):(b.xmx=14,"f"==a[0]&&(b.stbrk_forced=!0));ba(b);return;case "stafflines":case "staffscale":case "staffnonote":Z.set_v_param(b,a);return;case "staves":case "score":if(0==l.state)return;l.scores&&0<l.scores.length?(a=l.scores.shift(),b=a.match(/([^\s]+)\s*(.*)/),wg(b[1],b[2])):wg(b,a);return;case "sysstaffsep":if(3==l.state){G.voices[k.v].sep=mb(a);return}break;case "text":if(2<=l.state){b=Ub(b);b.text=nb(a);b.opt=t.textoption;return}xd(nb(a),
t.textoption);return;case "transpose":if(t.sound)return;switch(l.state){case 0:t.transp=0;case 1:case 2:t.transp=(t.transp||0)+xc(a);return}for(b=k.last_sym;b;b=b.prev){switch(b.type){case h.NOTE:b=A(k.okey);b.k_old_sf=k.ckey.k_sf;ba(b);break;case h.KEY:break;default:continue}break}ud("V",k.id+" shift="+a);return;case "tune":return;case "user":Zf(a);return;case "voicecolor":if(3!=l.state){if(2!=l.state)return;$a()}k.color=a;return;case "vskip":c=mb(a);if(0>c){p(1,"%%vskip cannot be negative");return}if(2<=
l.state){b=Ub(b);b.sk=c;return}ia(c);return;case "newpage":case "leftmargin":case "rightmargin":case "pagescale":case "pagewidth":case "printmargin":case "scale":case "staffwidth":if(3==l.state){b=Ub(b);b.param=a;return}if("newpage"==b){Lc();Va.newpage=!0;return}}Z.set_format(b,a)}};Abc.prototype.do_begin_end=function(a,c,b){switch(a){case "js":ta(b);break;case "ml":2<=l.state?(a=Ub(a),a.text=b):(wd(),w.img_out&&w.img_out(b));break;case "svg":for(a=0;;){c=b.indexOf('<style type="text/css">\n',a);
if(0>c)break;a=b.indexOf("</style>",c);if(0>a){p(1,"No </style> in %%beginsvg sequence");break}Oc+=b.slice(c+23,a).replace(/\s+$/,"")}for(a=0;;){c=b.indexOf("<defs>\n",a);if(0>c)break;a=b.indexOf("</defs>",c);if(0>a){p(1,"No </defs> in %%beginsvg sequence");break}var d,e,f,g=b.slice(c+6,a);f=0;for(g=g.replace(/\x3c!--.*?--\x3e/g,"");;){c=g.indexOf("<",f);if(0>c)break;d=g.indexOf('id="',c);if(0>d)break;d+=4;f=g.indexOf('"',d);if(0>f)break;e=g.slice(d,f);f=g.indexOf(">",f);if(0>f)break;if("/"==g[f-
1])f++;else{d=g.indexOf(" ",c);if(0>d)break;d=g.slice(c+1,d);f=g.indexOf("</"+d+">",f);if(0>f)break;f+=3+d.length}"<filter"==g.substr(c,7)?fe+="\n"+g.slice(c,f):Gb[e]=g.slice(c,f)}}break;case "text":c=Kg[c],c||(c=t.textoption),2<=l.state?(a=Ub(a),a.text=nb(b),a.opt=c):xd(nb(b),c)}};Abc.prototype.draw_gchord=function(a,c,b){var d,e,f,g,h,k,n,l=0,r=a.dur?3*((a.notes[a.nhd].pit+a.notes[0].pit>>1)-18):12;for(e=0;e<a.a_gch.length;e++)d=a.a_gch[e],d.wh[0]>l&&(l=d.wh[0]);k=T(a.st,1,a.x-2,l);n=T(a.st,0,a.x-
2,l);k<b&&(k=b);n>c&&(n=c);Tb(a.st);for(e=0;e<a.a_gch.length;e++){d=a.a_gch[e];sb(d.font);pa(d.font);h=d.font.size;g=d.font.box?2:0;l=d.wh[0];b=a.x+d.x;c=d.text;switch(d.type){case "_":f=d.y+n;Q(a.st,0,b,l,f-g);break;case "^":f=d.y+k+g;Q(a.st,1,b,l,f+h+g);break;case "<":a.notes[0].acc&&(b-=a.notes[0].shac);f=d.y+r-h/2;break;case ">":a.xmx&&(b+=a.xmx);a.dots&&(b+=1.5+3.5*a.dots);f=d.y+r-h/2;break;default:0<=d.y?(f=d.y+k+g,Q(a.st,!0,b,l,f+h+g)):(f=d.y+n,Q(a.st,!1,b,l,f-g));break;case "@":f=d.y+r,0<
f?(g=f+h,g>u[a.st].ann_top&&(u[a.st].ann_top=g)):f<u[a.st].ann_bot&&(u[a.st].ann_bot=f)}w.anno_start&&w.anno_start("annot",d.istart,d.iend,b-2,f+h+2,l+4,h+4,a);la(b,f,c,null,null,d.wh);w.anno_stop&&w.anno_stop("annot",d.istart,d.iend,b-2,f+h+2,l+4,h+4,a)}};Abc.prototype.draw_note=Hc;Abc.prototype.draw_symbols=function(a){var c={},b,d,e;for(b=a.sym;b;b=b.next){if(b.invis)switch(b.type){case h.KEY:a.key=b;default:continue;case h.NOTE:}e=b.st;d=b.x;uc(b.color);switch(b.type){case h.NOTE:bd(b);b.beam_st&&
!b.beam_end&&Z.calculate_beam(c,b)&&zf(c);b.invis||(qb(b),Hc(b,!c.s2),zb(b));b==c.s2&&(c.s2=null);break;case h.REST:if(b.invis||!u[e].topbar)break;var f=void 0,g,m,k;e=b;var n=u[e.st];if(e.dur_orig==e.p_v.meter.wmeasure||e.rep_nb&&0<=e.rep_nb){e.nflags=e.dur<2*h.BLEN?-2:e.dur<4*h.BLEN?-3:-4;e.dots=0;for(g=e.ts_next;g&&g.time!=e.time+e.dur;)g=g.ts_next;d=g?g.x:Aa;for(g=e;!g.seqst;)g=g.ts_prev;g=g.ts_prev;d=(d+g.x)/2;if(e.a_dd){k=e;var l=d-e.x,r=oa.length;for(m=0;m<r;m++)g=oa[m],g.s==k&&(g.x+=l)}e.x=
d}else d=e.x,e.notes[0].shhd&&(d+=e.notes[0].shhd*C.scale);if(!e.invis){g=n.y;if(e.rep_nb)gb(e.st),qb(e),g="|||||"==n.stafflines?g+12:g+(n.topbar+n.botbar)/2,0>e.rep_nb?ca(d,g,"srep"):(ca(d,g,"mrep"),2<e.rep_nb&&e.v==E.top_voice&&(pa("annotation"),D.curfont.box&&(D.curfont.box=!1,f=!0),la(d,g+n.topbar-9,e.rep_nb.toString(),"c"),f&&(D.curfont.box=!0)));else{bd(e);qb(e);f=e.y;k=5-e.nflags;7==k&&12==f&&2>=n.stafflines.length&&(f-=6);ca(d,f+g,e.notes[0].head||xh[k]);if(6<=k){m=f/6;switch(k){default:switch(n.stafflines[m+
1]){case "|":case "[":break;default:ca(d,f+6+g,"hl1")}9==k&&(f-=6,m--);break;case 7:f+=6,m++;case 6:}switch(n.stafflines[m]){case "|":case "[":break;default:ca(d,f+g,"hl1")}}if(e.dots)for(d+=8,f+=g+3,k=0;k<e.dots;k++)ca(d,f,"dot"),d+=3.5}zb(e)}break;case h.BAR:break;case h.CLEF:b.time>=u[e].clef.time&&(u[e].clef=b);if(b.second||b.invis||!u[e].topbar)break;uc();gb(e);qb(b);e=u[e].y;b.clef_name?ca(d,e+b.y,b.clef_name):b.clef_small?ca(d,e+b.y,"s"+b.clef_type+"clef"):ca(d,e+b.y,b.clef_type+"clef");b.clef_octave&&
(0<b.clef_octave?(e+=b.ymx-10,b.clef_small&&--e):(e+=b.ymn+6,b.clef_small&&(e+=1)),ca(d-2,e,"oct"));zb(b);break;case h.METER:a.meter=b;if(b.second||!u[b.st].topbar)break;uc();gb(b.st);qb(b);d=b;if(d.a_meter)for(n=u[d.st],e=n.y,"|||||"!=n.stafflines&&(e+=(n.topbar+n.botbar)/2-12),f=0;f<d.a_meter.length;f++)n=d.a_meter[f],g=d.x+d.x_meter[f],n.bot?W('<g transform="translate(X,Y)" text-anchor="middle">\n\t<text y="-12">A</text>\n\t<text>B</text>\n</g>\n',g,e+6,Ed(n.top),Ed(n.bot)):W('<text x="X" y="Y" text-anchor="middle">A</text>\n',
g,e+12,Ed(n.top));zb(b);break;case h.KEY:a.key=b;if(b.second||b.invis||!u[b.st].topbar)break;uc();gb(b.st);qb(b);n=d;f=b;if(!f.k_none){k=f.k_old_sf;m=f.st;g=u[m].y;l=f.k_y_clef;l&1&&(l+=7);for(l/=2;0>l;)l+=7;l%=7;if(!f.k_a_acc){if(t.cancelkey||0==f.k_sf)if(0==f.k_sf||0>k*f.k_sf){d=Dg[l];m=9<d?Fg:Gg;for(e=0;e<k;e++)ca(n,g+d,"acc3"),d+=m[e],n+=5.5;d=Eg[l];m=18>d?Hg:Ig;for(e=0;e>k;e--)ca(n,g+d,"acc3"),d+=m[-e],n+=5.5;0!=f.k_sf&&(n+=3)}if(0<f.k_sf){d=Dg[l];m=9<d?Fg:Gg;for(e=0;e<f.k_sf;e++)ca(n,g+d,"acc1"),
d+=m[e],n+=5.5;if(t.cancelkey&&e<k)for(n+=2;e<k;e++)ca(n,g+d,"acc3"),d+=m[e],n+=5.5}if(0>f.k_sf){d=Eg[l];m=18>d?Hg:Ig;for(e=0;e>f.k_sf;e--)ca(n,g+d,"acc-1"),d+=m[-e],n+=5.5;if(t.cancelkey&&e>k)for(n+=2;e>k;e--)ca(n,g+d,"acc3"),d+=m[-e],n+=5.5}}else if(f.k_a_acc.length)for(l=f.k_a_acc[0].acc,r=100,e=0;e<f.k_a_acc.length;e++)k=f.k_a_acc[e],d=3*(f.k_y_clef+k.pit-18),0!=e&&(d>r+18||d<r-18)?n-=5.5:k.acc!=l&&(n+=3),l=k.acc,Bf(n,d,d,m,"hl"),r=d,Yd(n,g+d,k.acc,k.micro_n,k.micro_d),n+=5.5}zb(b);break;case h.MREST:bd(b);
d+=32;qb(b);ca(d,u[b.st].y+12,"mrest");W('<text style="font:bold 15px serif"\n\tx ="X" y="Y" text-anchor="middle">A</text>\n',d,u[b.st].y+28,b.nmes);zb(b);break;case h.GRACE:bd(b);var v;d=b;e={};for(f=d.extra;f&&(f.beam_st&&!f.beam_end&&Z.calculate_beam(e,f)&&zf(e),qb(f),Hc(f,!e.s2),f==e.s2&&(e.s2=null),zb(f),f.next);f=f.next);d.sappo&&(f=d.extra,f.next?(e=.5*(f.next.x-f.x)+4,n=.5*(f.ys+f.next.ys)-f.y,n=0<f.stem?n-1:n+1):(e=9,n=0<f.stem?5:-5),m=f.notes[0>f.stem?0:f.nhd],g=f.x+m.shhd*C.scale,m=u[f.st].y+
3*(m.pit-18),0<f.stem?(--g,m+=4):(g-=5,m-=4),W('<path class="stroke" d="mX YlF G"/>\n',g,m,e,-n));if(!d.p_v.key.k_bagpipe&&t.graceslurs&&!d.slur_start&&d.next&&d.next.type==h.NOTE){e=f;if(0<=e.stem){n=127;for(f=d.extra;f;f=f.next)f.y<n&&(n=f.y,e=f);k=e.x;m=e.y-5;d.extra!=e&&(k-=4,m+=1);d=d.next;g=d.x-1;0>d.stem&&(g-=4);f=3*(d.notes[0].pit-18)-5;n=.4*(g-k);3<n&&(n=3);l=n;v=.2;r=.8;m>f+7?(k=e.x-1,m+=.5,f+=6.5,g=d.x-5.5,n=.8*(m-f),l=.2*(m-f),v=0):f>m+4&&(f=m+4,k=e.x+2,m=e.y-4)}else{n=-127;for(f=d.extra;f;f=
f.next)f.y>n&&(n=f.y,e=f);k=e.x;m=e.y+5;d.extra!=e&&(k-=4,--m);d=d.next;g=d.x-1;0<=d.stem&&(g-=2);f=3*(d.notes[d.nhd].pit-18)+5;n=.4*(k-g);-3>n&&(n=-3);l=n;v=.2;r=.8;m<f-7?(k=e.x-1,m-=.5,f-=6.5,g=d.x-5.5,n=.8*(m-f),l=.2*(m-f),v=0):f<m-4&&(f=m-4,k=e.x+2,m=e.y+4)}e=v*g+(1-v)*k-k;n=v*f+(1-v)*m-n-m;v=r*g+(1-r)*k-k;l=r*f+(1-r)*m-l-m;qb(d,"slur");Xd(k,m+u[d.st].y);z+="c"+e.toFixed(1)+" "+(-n).toFixed(1)+" "+v.toFixed(1)+" "+(-l).toFixed(1)+" "+(g-k).toFixed(1)+" "+(-f+m).toFixed(1)+'"/>\n';zb(d,"slur")}break;
case h.SPACE:case h.STBRK:break;case h.CUSTOS:bd(b);Hc(b,0);break;case h.BLOCK:case h.PART:case h.REMARK:case h.STAVES:case h.TEMPO:break;default:J(2,b,"draw_symbols - Cannot draw symbol "+b.type)}}bd(a.sym);Sg(a);uc()};Abc.prototype.errs=N;Abc.prototype.font_class=td;Abc.prototype.gch_build=function(a){var c,b,d,e,f=k.pos.gch==h.SL_BELOW?-1:1,g=0,m=0,l=0,n=0;a.a_gch=ib;ib=null;k.vtransp&&uh(a);for(e=0;e<a.a_gch.length;e++){c=a.a_gch[e];if("g"==c.type)t.chordnames&&(c.otext=c.text,c.text=c.text.replace(/A|B|C|D|E|F|G/g,
function(a){return t.chordnames[a]}),"H"==t.chordnames.B&&(c.text=c.text.replace(/Hb/g,"Bb"))),c.text=c.text.replace(/##|#|=|bb|b|  /g,function(a){switch(a){case "##":return"&#x1d12a;";case "#":return"\u266f";case "=":return"\u266e";case "b":return"\u266d";case "  ":return" \u00a0"}return"&#x1d12b;"});else if(c.text=nb(c.text),"@"==c.type&&!w.anno_start&&!w.anno_stop){c.wh=[0,0];continue}pa(c.font);b=Pa(c.text);c.wh=b;c.font.box&&(b[1]+=4);switch(c.type){case "@":break;case "^":d=.4*b[0];8<d&&(d=
8);c.x=-d;g-=b[1];c.y=g;break;case "_":d=.4*b[0];8<d&&(d=8);c.x=-d;m-=b[1];c.y=m;break;case "<":c.x=-(b[0]+6);l-=b[1];c.y=l+b[1]/2;break;case ">":c.x=6;n-=b[1];c.y=n+b[1]/2;break;default:d=.4*b[0],8<d&&(d=8),c.x=-d,0>f?(m-=b[1],c.y=m):(g-=b[1],c.y=g)}}l/=2;n/=2;for(e=0;e<a.a_gch.length;e++)switch(c=a.a_gch[e],c.type){case "^":c.y-=g;break;case "<":c.y-=l;break;case ">":c.y-=n;break;case "g":0<f&&(c.y-=g)}};Abc.prototype.gch_tr1=Ag;Abc.prototype.get_a_gch=function(){return ib};Abc.prototype.get_bool=
kc;Abc.prototype.get_cur_sy=function(){return E};Abc.prototype.get_curvoice=function(){return k};Abc.prototype.get_delta_tb=function(){return Kd};Abc.prototype.get_decos=function(){return pd};Abc.prototype.get_fname=function(){return l.fname};Abc.prototype.get_font=lc;Abc.prototype.get_font_style=function(){return vc};Abc.prototype.get_glyphs=function(){return Gb};Abc.prototype.get_img=function(){return ga};Abc.prototype.get_maps=function(){return Jb};Abc.prototype.get_multi=function(){return Na};
Abc.prototype.get_newpage=function(){if(Va.newpage)return Va.newpage=!1,!0};Abc.prototype.get_posy=function(){var a=ra;ra=0;return a};Abc.prototype.get_staff_tb=function(){return u};Abc.prototype.get_top_v=function(){return G.top_voice};Abc.prototype.get_tsfirst=function(){return V};Abc.prototype.get_unit=mb;Abc.prototype.get_voice_tb=function(){return x};Abc.prototype.goto_tune=$a;Abc.prototype.info=function(){return O};Abc.prototype.new_block=Ub;Abc.prototype.new_note=function(a,c){var b,d,e,f,
g;g=0;var m=l.line,q=sa;sa=null;l.stemless=!1;d={type:h.NOTE,fname:l.fname,stem:0,multi:0,nhd:0,xmx:0};d.istart=l.bol+m.index;k.color&&(d.color=k.color);a?d.grace=!0:(ib&&Z.gch_build(d),l.repeat_n&&(d.repeat_n=l.repeat_n,d.repeat_k=l.repeat_k,l.repeat_n=0));f=m["char"]();switch(f){case "X":d.invis=!0;case "Z":d.type=h.MREST;f=m.next_char();d.nmes="0"<f&&"9">=f?m.get_int():1;d.dur=k.wmeasure*d.nmes;if(k.second){k.time+=d.dur;return}1==d.nmes&&(d.type=h.REST,d.dur_orig=d.dur,d.notes=[{pit:18,dur:d.dur}]);
break;case "y":d.type=h.SPACE;d.invis=!0;d.dur=0;f=m.next_char();d.width="0"<=f&&"9">=f?m.get_int():10;break;case "x":d.invis=!0;case "z":d.type=h.REST;m.index++;e=Lb(m);d.dur_orig=(0>k.ulen?h.BLEN:k.ulen)*e[0]/e[1];d.dur=d.dur_orig*k.dur_fact;d.notes=[{pit:18,dur:d.dur_orig}];break;case "[":e=!0,f=m.next_char();default:k.uscale&&(d.uscale=k.uscale);for(d.notes=[];;){if(e)for(;f;){f=f.charCodeAt(0);if(128<=f){p(1,N.not_ascii);return}f=Za[f];switch(f[0]){case "(":g<<=4;g+=Dd();f=m["char"]();continue;
case "!":sa||(sa=[]);if(1<f.length)sa.push(f.slice(1,-1));else{for(b="";;){f=m.next_char();if(!f){p(1,"No end of decoration");return}if("!"==f)break;b+=f}sa.push(b)}f=m.next_char();continue}break}var n;n=m;f=d.grace?h.BLEN/4:0>k.ulen?h.BLEN:k.ulen;(b=nc(n))?("0"==n["char"]()&&(l.stemless=!0,n.index++),n=Lb(n),b.dur=f*n[0]/n[1]):b=void 0;if(!b)return;k.octave&&(b.pit+=7*k.octave);g&&(b.sl1=g,d.sl1?d.sl1++:d.sl1=1,g=0);sa&&(b.a_dcn=sa,sa=null);d.notes.push(b);if(!e)break;for(f=m["char"]();;){switch(f){case ")":b.sl2?
b.sl2++:b.sl2=1;d.sl2?d.sl2++:d.sl2=1;f=m.next_char();continue;case "-":b.ti1=Dd();d.ti1=!0;f=m["char"]();continue;case ".":if(f=m.next_char(),"-"!=f)p(1,"Misplaced dot");else continue}break}if("]"==f){m.index++;e=Lb(m);d.nhd=d.notes.length-1;for(f=0;f<=d.nhd;f++)b=d.notes[f],b.dur=b.dur*e[0]/e[1];break}}d.dur_orig=d.notes[0].dur;d.dur=d.notes[0].dur*k.dur_fact}if(d.grace&&d.type!=h.NOTE)p(1,"Not a note in grace note sequence");else{if(d.notes){if(d.grace){e=k.ckey.k_bagpipe?8:4;for(f=0;f<=d.nhd;f++)d.notes[f].dur/=
e;d.dur/=e;d.dur_orig/=e;a.stem&&(d.stem=a.stem)}else{switch(k.pos.stm){case h.SL_ABOVE:d.stem=1;break;case h.SL_BELOW:d.stem=-1;break;case h.SL_HIDDEN:d.stemless=!0}d.dur*=c;if(b=k.brk_rhythm){k.brk_rhythm=0;g=k.last_note;if(0<b){e=2*b-1;d.dur=d.dur*e/b;d.dur_orig=d.dur_orig*e/b;for(f=0;f<=d.nhd;f++)d.notes[f].dur=d.notes[f].dur*e/b;g.dur/=b;g.dur_orig/=b;for(f=0;f<=g.nhd;f++)g.notes[f].dur/=b}else{b=-b;e=2*b-1;d.dur/=b;d.dur_orig/=b;for(f=0;f<=d.nhd;f++)d.notes[f].dur/=b;g.dur=g.dur*e/b;g.dur_orig=
g.dur_orig*e/b;for(f=0;f<=g.nhd;f++)g.notes[f].dur=g.notes[f].dur*e/b}k.time=g.time+g.dur;for(g=g.next;g;g=g.next)g.time=k.time}}k.last_note=d}ba(d);if(d.type==h.NOTE){if(k.vtransp){var u,r,v,x,w,z;f=d.nhd;e=k.okey.k_sf;g=k.ckey.k_sf-e;b=Mb[(g+28)%7];n=k.vtransp;0>n&&0!=b&&(b-=7);b+=7*(n/3/12|0);for(n=0;n<=f;n++){z=d.notes[n];r=z.pit;z.pit+=b;w=ge[(r+5+112)%7];v=z.acc;if(!v)if(k.okey.a_acc)for(u=0;u<k.okey.a_acc.length;u++){if(x=k.okey.a_acc[u],0==(r+112-x.pit)%7){v=x.acc;break}}else 0<e?w<e-1&&(v=
1):0>e&&w>=e+6&&(v=-1);u=w+g;v&&3!=v&&(u+=7*v);w=(((u+1+21)/7|0)+2-3+160)%5;v=yh[w];if(!z.acc)if(k.ckey.k_none){if(3==v||sh(z.pit))continue}else if(k.ckey.a_acc){w=Mb[(u+112)%7];for(u=0;u<k.ckey.a_acc.length&&0!=(w+112-k.ckey.a_acc[u].pits)%7;u++);if(u<k.ckey.a_acc.length)continue}else continue;w=z.acc;if((u=z.micro_d)&&w!=v)switch(r=z.micro_n,v){case 3:r>u/2?(r-=u/2,z.micro_n=r,v=w):v=-w;break;case 2:r>u/2?(z.pit+=1,r-=u/2):r+=u/2;v=w;z.micro_n=r;break;case -2:r>=u/2?(--z.pit,r-=u/2):r+=u/2,v=w,
z.micro_n=r}z.acc=v}}if(k.map&&Jb[k.map])for(f=0;f<=d.nhd;f++)a:{e=d.notes[f];g=Jb[k.map];b=bg(e);if(!(g[b]||(b="octave,"+b.replace(/[',]/g,""),g[b]||(b="key,"+"abcdefg"[(e.pit+77-k.ckey.k_delta)%7],g[b]||(b="all",g[b])))))break a;e.map=g[b];e.map[1]&&(e.pit=e.map[1].pit,e.acc=e.map[1].acc)}}t.shiftunison&&(d.shiftunison=t.shiftunison);a||(k.lyric_restart||(k.lyric_restart=d),k.sym_restart||(k.sym_restart=d));q&&tc(q,d,d.prev);l.ottava.length&&(d.ottava=l.ottava,l.ottava=[]);l.stemless&&(d.stemless=
!0);d.iend=l.bol+m.index;return d}};Abc.prototype.out_arp=og;Abc.prototype.out_deco_str=ng;Abc.prototype.out_deco_val=qf;Abc.prototype.out_ltr=pg;Abc.prototype.output_music=function(){var a,c,b,d;Xf();if(V){var e,f,g,m,k;k=E;for(f=k.nstaff;;){k=k.next;if(!k)break;k.nstaff>f&&(f=k.nstaff)}R=f;m=x.length;for(g=0;g<m;g++){e=x[g];for(var n=void 0,l=void 0,r=void 0,v=void 0,p=void 0,G=!0,N=127,p=e.sym;p;p=p.next)if(p.type==h.NOTE){N=p.notes[0].pit;break}for(p=e.sym;p;p=p.next){switch(p.type){case h.MREST:G=
!0;break;case h.BAR:p.bar_type=Qg(p.bar_type);p.beam_on||(G=!0);!p.next&&p.prev&&p.prev.head==h.OVALBARS&&(p.prev.head=h.SQUARE);break;case h.NOTE:case h.REST:if(n=Je(p,p.dur_orig),p.head=n[0],p.dots=n[1],p.nflags=n[2],-2>=p.nflags&&(p.stemless=!0),p.xstem&&(p.nflags=0),p.trem1&&(p.nflags=0<p.nflags?p.nflags+p.ntrem:p.ntrem),!p.next||!p.next.trem2)if(p.trem2)p.prev.trem2=!0,p.prev.nflags=--p.nflags,p.prev.head=++p.head,0<p.nflags?p.nflags+=p.ntrem:(-2>=p.nflags&&(p.stemless=!0,p.prev.stemless=!0),
p.nflags=p.ntrem),p.prev.nflags=p.nflags;else{r=p.nflags;p.ntrem&&(r+=p.ntrem);p.type==h.REST&&p.beam_end&&(p.beam_end=!1,G=!0);if(G||0>=r)l&&(l.beam_end=!0,l=null),0>=r?(p.beam_st=!0,p.beam_end=!0):p.type==h.NOTE&&(p.beam_st=!0,G=!1);p.beam_end&&(G=!0);p.type==h.NOTE&&(l=p)}}if(p.type==h.NOTE)for(0!=p.nhd&&pf(p),N=p.notes[0].pit,v=p.prev;v&&v.type==h.REST;v=v.prev)v.notes[0].pit=N;else p.notes||(p.notes=[],p.notes[0]={},p.nhd=0),p.notes[0].pit=N}l&&(l.beam_end=!0);for(var y=void 0,O=void 0,I=e.sym;I;)if(I.type!=
h.BAR||!I.rbstart||I.norepbra)I=I.next;else for(y=0,O=null,I=I.next;I;I=I.next)if(I.type==h.BAR){y++;if(I.rbstop)break;if(!I.next){I.rbstop=2;break}y==t.rbmin&&(O=I);if(y==t.rbmax){O&&(I=O);I.rbstop=1;break}}}var W,qa,fa,nd,ua,ba,va,sa;for(nd=0;nd<x.length;nd++)for(W=x[nd],fa=!1,qa=W.st,ua=W.sym;ua;ua=ua.next){if(!ua.floating){for(;ua&&!ua.floating;)ua=ua.next;if(!ua)break;fa=!1}if(ua.dur)if(19<=ua.notes[0].pit)fa=!1;else if(12>=ua.notes[ua.nhd].pit)fa=!0,ua.st++;else{va=127;for(ba=ua.ts_prev;ba&&
ba.st==qa&&ba.v!=ua.v;ba=ba.ts_prev)ba.type==h.NOTE&&ba.notes[0].pit<va&&(va=ba.notes[0].pit);if(127==va)fa&&ua.st++;else if(ua.notes[ua.nhd].pit>va-3)fa=!1;else{sa=-127;for(ba=ua.ts_next;ba&&ba.st==qa+1&&ba.v!=ua.v;ba=ba.ts_next)ba.type==h.NOTE&&ba.notes[ba.nhd].pit>sa&&(sa=ba.notes[ba.nhd].pit);if(-127==sa)fa&&ua.st++;else{if(ua.notes[0].pit<sa+3)fa=!0;else if(va-=ua.notes[ua.nhd].pit,sa=ua.notes[0].pit-sa,!fa){if(va<sa+3)continue;fa=!0}else if(va<sa-3){fa=!1;continue}ua.st++}}}else fa&&ua.st++}za.ottava&&
"play"!=t.sound&&eh();var Y,ta,P,X,Ha,La,Gc,Na,Ua,ab=Array(R),ea=E,$a=[];u=Array(R);for(P=0;P<=R;P++)ab[P]={autoclef:!0},u[P]={output:"",sc_out:""};for(X=0;X<x.length;X++)Ha=x[X],0>ea.voices[X].range||(P=ea.voices[X].st,ea.voices[X].second||(void 0!=Ha.staffnonote&&(ea.staves[P].staffnonote=Ha.staffnonote),Ha.staffscale&&(ea.staves[P].staffscale=Ha.staffscale),ea.voices[X].sep&&(ea.staves[P].sep=ea.voices[X].sep),ea.voices[X].maxsep&&(ea.staves[P].maxsep=ea.voices[X].maxsep)),ea.voices[X].second||
Ha.clef.clef_auto||(ab[P].autoclef=!1));for(X=0;X<x.length;X++)Ha=x[X],0>ea.voices[X].range||ea.voices[X].second||(P=ea.voices[X].st,Y=Ha.clef,ab[P].autoclef&&(Y.clef_type=lf(P,V,Y.clef_type),Y.clef_line="t"==Y.clef_type?2:4),ab[P].clef=u[P].clef=Y);for(P=0;P<=ea.nstaff;P++)$a[P]=3*(ea.staves[P].stafflines.length-1);for(Y=V;Y;Y=Y.ts_next){Y.repeat_n&&dh(Y);switch(Y.type){case h.STAVES:ea=Y.sy;for(P=0;P<=R;P++)ab[P].autoclef=!0;for(X=0;X<x.length;X++)0>ea.voices[X].range||(Ha=x[X],P=ea.voices[X].st,
ea.voices[X].second||(void 0!=Ha.staffnonote&&(ea.staves[P].staffnonote=Ha.staffnonote),Ha.staffscale&&(ea.staves[P].staffscale=Ha.staffscale),ea.voices[X].sep&&(ea.staves[P].sep=ea.voices[X].sep),ea.voices[X].maxsep&&(ea.staves[P].maxsep=ea.voices[X].maxsep)),ta=Ha.clef,ta.clef_auto||(ab[P].autoclef=!1));for(P=0;P<=ea.nstaff;P++)$a[P]=3*(ea.staves[P].stafflines.length-1);for(X=0;X<x.length;X++)if(!(0>ea.voices[X].range||ea.voices[X].second))if(Ha=x[X],P=ea.voices[X].st,ta=Ha.clef,ta.clef_auto?(Gc=
lf(P,Y,ab[P].clef?ab[P].clef.clef_type:"a"),Na="t"==Gc?2:4):(Gc=ta.clef_type,Na=ta.clef_line),!ab[P].clef)ta.clef_auto&&("a"!=ta.type&&(Ha.clef=A(Ha.clef)),Ha.clef.clef_type=Gc,Ha.clef.clef_line=Na),u[P].clef=ab[P].clef=Ha.clef;else if(Gc!=ab[P].clef.clef_type||Na!=ab[P].clef.clef_line){for(La=Y.ts_prev;La&&La.time==Y.time&&(La.v!=X||La.st!=P);)La=La.ts_prev;if(!La||La.time!=Y.time){for(La=Y.ts_next;La&&(La.v!=X||La.st!=P);)La=La.ts_next;La&&La.time==Y.time||(La=Y)}La.type!=h.CLEF&&(La=Nf(La,Gc,Na),
ta.clef_auto&&(La.clef_auto=!0));ab[P].clef=Ha.clef=La}continue;default:Y.mid=$a[Y.st];continue;case h.CLEF:}"a"==Y.clef_type&&(Y.clef_type=lf(Y.st,Y.ts_next,ab[Y.st].clef.clef_type),Y.clef_line="t"==Y.clef_type?2:4);Ha=Y.p_v;Ha.clef=Y;if(Y.second)lb(Y);else{P=Y.st;if(ab[P].clef){if(Y.clef_type==ab[P].clef.clef_type&&Y.clef_line==ab[P].clef.clef_line)continue}else u[P].clef=Y;ab[P].clef=Y}}ea=E;for(X=0;X<x.length;X++)if(!(0>ea.voices[X].range)&&(ta=x[X].sym)&&127==ta.notes[0].pit){P=ea.voices[X].st;
switch(u[P].clef.clef_type){default:Ua=22;break;case "c":Ua=16;break;case "b":Ua=10}for(Y=ta;Y;Y=Y.next)Y.notes[0].pit=Ua}Z.set_pitch(null);1<x.length&&Z.set_stem_dir();for(a=0;a<x.length;a++){var Uc,Za,Va,mb,Wa,kb=void 0,rb=void 0,wa,aa,ib=-1;for(aa=x[a].sym;aa;aa=aa.next)if(aa.type!=h.NOTE){if(aa.type==h.GRACE)if(wa=aa.extra,2==wa.stem)kb=aa;else for(aa.stem||0!=(aa.stem=aa.multi)||(aa.stem=1);wa;wa=wa.next)wa.stem=aa.stem,wa.multi=aa.multi}else{if(aa.stem||0!=(aa.stem=aa.multi))aa.beam_st&&!aa.beam_end&&
(rb=!0);else if(Va=aa.mid/3+18,rb)aa.stem=ib;else if(aa.beam_st&&!aa.beam_end){rb=!0;Za=aa.notes[aa.nhd].pit;Uc=aa.notes[0].pit;for(wa=aa.next;wa;wa=wa.next)if(wa.type==h.NOTE){if(wa.stem||wa.multi){aa.stem=wa.stem||wa.multi;break}wa.notes[wa.nhd].pit>Za&&(Za=wa.notes[wa.nhd].pit);wa.notes[0].pit<Uc&&(Uc=wa.notes[0].pit);if(wa.beam_end)break}wa.beam_end&&((Za+Uc)/2<Va?aa.stem=1:(Za+Uc)/2>Va?aa.stem=-1:t.bstemdown&&(aa.stem=-1));aa.stem||(aa.stem=ib)}else{Wa=(aa.notes[aa.nhd].pit+aa.notes[0].pit)/
2;if(Wa==Va){for(mb=Wa=0;mb<=aa.nhd;mb++)Wa+=aa.notes[mb].pit;Wa/=aa.nhd+1}aa.stem=Wa<Va?1:Wa>Va?-1:t.bstemdown?-1:ib}aa.beam_end&&(rb=!1);ib=aa.stem;if(kb){for(wa=kb.extra;wa;wa=wa.next)wa.stem=-ib;kb.stem=-ib;kb=null}}}Z.set_stems();if(1<x.length){var H,ha,nb,Ub,Ab,Vb,Wb,Xb,Ia,hb,sb,Ib=[],Jb=E;for(H=V;H;H=H.ts_next)if(!H.invis&&(H.type==h.STAVES&&(Jb=H.sy),H.dur&&(Vb=Ib[H.v],Vb||(Vb={},Ib[H.v]=Vb),Vb.s=H,Vb.st=H.st,Vb.end_time=H.time+H.dur,H.type==h.REST))){Xb=-127;Wb=127;Ab=hb=!1;for(nb=0;nb<=
Ib.length;nb++)!(Vb=Ib[nb])||!Vb.s||Vb.st!=H.st||nb==H.v||Vb.end_time<=H.time||(Ab=!0,ha=Vb.s,Jb.voices[nb].range<Jb.voices[H.v].range?ha.time==H.time?ha.ymn<Wb&&(Wb=ha.ymn,ha.dots&&(hb=!0)):ha.y<Wb&&(Wb=ha.y):ha.time==H.time?ha.ymx>Xb&&(Xb=ha.ymx,ha.dots&&(hb=!0)):ha.y>Xb&&(Xb=ha.y));Ub=H.time+H.dur;for(ha=H.ts_next;ha&&!(ha.time>=Ub);ha=ha.ts_next)ha.st==H.st&&ha.dur&&!ha.invis&&(Ab=!0,Jb.voices[ha.v].range<Jb.voices[H.v].range?ha.time==H.time?ha.ymn<Wb&&(Wb=ha.ymn,ha.dots&&(hb=!0)):ha.y<Wb&&(Wb=
ha.y):ha.time==H.time?ha.ymx>Xb&&(Xb=ha.ymx,ha.dots&&(hb=!0)):ha.y>Xb&&(Xb=ha.y));Ab?(127==Wb&&12>H.y&&(Ia=12-H.y,H.y+=Ia,H.ymx+=Ia,H.ymn+=Ia),-127==Xb&&12<H.y&&(Ia=H.y-12,H.y-=Ia,H.ymx-=Ia,H.ymn-=Ia),Ia=Wb-H.ymx,0>Ia?(Ia=6*Math.ceil(-Ia/6),H.ymn-Ia>=Xb?(H.y-=Ia,H.ymx-=Ia,H.ymn-=Ia):(sb=hb?15:10,H.notes[0].shhd=sb,H.xmx=sb)):(Ia=Xb-H.ymn,0<Ia&&(Ia=6*Math.ceil(Ia/6),H.ymx+Ia<=Wb?(H.y+=Ia,H.ymx+=Ia,H.ymn+=Ia):(sb=hb?15:10,H.notes[0].shhd=sb,H.xmx=sb)))):(H.y=12,H.ymx=24,H.ymn=0)}var Xa,S,K,zc,L,ob,
Pc,Qa,Nb,Gb,kc,bb,Ca,Hb,Ld,mc,Kb,cd,nc,Lb,Mb,dd,ed;for(Xa=V;Xa;Xa=Xa.ts_next)if(Xa.type==h.NOTE&&!Xa.invis){if(Xa.xstem&&0>Xa.ts_prev.stem)for(Qa=0;Qa<=Xa.nhd;Qa++)Xa.notes[Qa].shhd-=7,Xa.notes[Qa].shac+=16;for(K=Xa;;){K=K.ts_next;if(!K)break;if(K.time!=Xa.time){K=null;break}if(K.type==h.NOTE&&!K.invis&&K.st==Xa.st)break}if(K&&(S=Xa,E.voices[S.v].range<E.voices[K.v].range?K.dot_low=!0:S.dot_low=!0,!(S.ymn>K.ymx||S.ymx<K.ymn||gh(S,K))))if(0<S.stem&&0>K.stem&&S.notes[0].pit==K.notes[K.nhd].pit+1||0>
S.stem&&0<K.stem&&S.notes[S.nhd].pit+1==K.notes[0].pit){0>S.stem&&(S=K,K=Xa);for(Qa=0;Qa<=K.nhd;Qa++)K.notes[Qa].shhd+=7;K.xmx+=7;S.xmx=K.xmx}else{cd=of(S);nc=nf(K);if((zc=S.ts_prev)&&zc.time==S.time&&zc.st==S.st&&zc.type==h.NOTE&&!zc.invis)for(Mb=of(zc),L=0;96>L;L++)Mb[L]>cd[L]&&(cd[L]=Mb[L]);else zc=null;bb=-10;for(L=0;96>L;L++)nc[L]+cd[L]>bb&&(bb=nc[L]+cd[L]);if(!(-3>bb&&(!S.dots||!K.dots||!K.dot_low||0<S.stem||0>K.stem||S.notes[S.nhd].pit+2!=K.notes[0].pit||K.notes[0].pit&1))){Lb=of(K);Kb=nf(S);
if(zc)for(Mb=nf(zc),L=0;96>L;L++)Mb[L]>Kb[L]&&(Kb[L]=Mb[L]);Ca=Hb=Ld=-100;for(L=0;96>L;L++)Kb[L]+Lb[L]>Ca&&(Ca=Kb[L]+Lb[L]),Lb[L]>Ld&&(Ld=Lb[L]),cd[L]>Hb&&(Hb=cd[L]);Gb=0;ob=S.nhd;for(Pc=K.nhd;;){kc=S.notes[ob].pit-K.notes[Pc].pit;switch(kc){case 0:if(S.notes[ob].acc!=K.notes[Pc].acc){Gb=-1;break}K.notes[Pc].acc&&(K.notes[Pc].acc=0);S.dots&&K.dots&&S.notes[ob].pit&1&&(Gb=1);break;case -1:S.dots&&K.dots&&(S.notes[ob].pit&1?(S.dot_low=!1,K.dot_low=!1):(S.dot_low=!0,K.dot_low=!0));break;case -2:!S.dots||
!K.dots||S.notes[ob].pit&1||(S.dot_low=!1,K.dot_low=!1)}if(0>Gb)break;if(0<=kc&&0>--ob)break;if(0>=kc&&0>--Pc)break}if(0>Gb){var Yb=void 0,Bb=void 0,Zb=S,Ob=K,Oc=ob;if(Ob.notes[Pc].acc){Yb=2*Oe[Zb.head]+Zb.xmx+Ob.notes[Pc].shac+2;Ob.notes[Pc].micro&&(Yb+=2);Zb.dots&&(Yb+=6);for(Bb=0;Bb<=Ob.nhd;Bb++)Ob.notes[Bb].shhd+=Yb,Ob.notes[Bb].shac-=Yb;Ob.xmx+=Yb}else{Yb=2*Oe[Ob.head]+Ob.xmx+Zb.notes[Oc].shac+2;Zb.notes[Oc].micro&&(Yb+=2);Ob.dots&&(Yb+=6);for(Bb=0;Bb<=Zb.nhd;Bb++)Zb.notes[Bb].shhd+=Yb,Zb.notes[Bb].shac-=
Yb;Zb.xmx+=Yb}}else{Nb=0;S.dots?K.dots&&(Gb||(Nb=1)):K.dots&&Ca+Hb<bb+Ld&&(Nb=1);dd=nc;ed=Lb;!zc&&Ca+Hb<bb+Ld&&(S=K,K=Xa,bb=Ca,dd=Kb,ed=cd,Ld=Hb);bb+=3;0>bb&&(bb=0);Qa=0<=S.stem?0:S.nhd;bb+=S.notes[Qa].shhd;Qa=0<=K.stem?0:K.nhd;bb-=K.notes[Qa].shhd;if(S.dots)if(mc=7.7+S.xmx+3.5*S.dots-3.5+3,!Nb){Ca=-100;for(ob=0;ob<=S.nhd;ob++)L=S.notes[ob].pit,L&1||(S.dot_low?L--:L++),L*=2,1>L?L=1:95<=L&&(L=94),dd[L]>Ca&&(Ca=dd[L]),dd[L-1]+1>Ca&&(Ca=dd[L-1]+1),dd[L+1]+1>Ca&&(Ca=dd[L+1]+1);mc+Ca+2>bb&&(bb=mc+Ca+2)}else if(mc<
bb+Ld+K.xmx){for(ob=Ca=0;ob<=S.nhd;ob++)L=S.notes[ob].pit,L&1||(S.dot_low?L--:L++),L*=2,1>L?L=1:95<=L&&(L=94),ed[L]>Ca&&(Ca=ed[L]),ed[L-1]+1>Ca&&(Ca=ed[L-1]=1),ed[L+1]+1>Ca&&(Ca=ed[L+1]+1);4.5<Ca&&7.7+S.xmx+2<bb+Ca+K.xmx&&(K.xmx=Ca+3-7.7)}for(Qa=K.nhd;0<=Qa;Qa--)K.notes[Qa].shhd+=bb;K.xmx+=bb;Nb&&(S.xmx=K.xmx)}}}}}var tb,oc,ie,sc,tc,Vc,Wc;for(tb=V;tb;)if(tb.type!=h.NOTE||tb.invis)tb=tb.ts_next;else{ie=tb.st;Vc=tb.time;tc=!1;for(oc=tb;oc&&oc.time==Vc&&oc.type==h.NOTE&&oc.st==ie;oc=oc.ts_next)if(!tc)for(sc=
0;sc<=oc.nhd;sc++)if(oc.notes[sc].acc){tc=!0;break}if(tc){Wc=Lf[tb.head];for(ie={notes:[]};tb!=oc;tb=tb.ts_next)Array.prototype.push.apply(ie.notes,tb.notes);pf(ie);Mf(ie.notes,Wc)}else tb=oc}for(var jc,Ic,Jc,ub,vc,Ma=V,Ra=Ma,wc=0,xc=[],Md=[],Nd=0;;){jc=wc;do Ma.a_gch&&!vc&&(vc=Ma),Z.set_width(Ma),ub=Ma.st,void 0==xc[ub]&&(xc[ub]=0),void 0==Md[ub]&&(Md[ub]=0),Ic=xc[ub]+Md[ub]+Ma.wl,Ic>jc&&(jc=Ic),Ma=Ma.ts_next;while(Ma&&!Ma.seqst);Ra.shrink=jc-wc;Nd||(Ra.space=Ra.ts_prev?Mc(Ra):0);0==Ra.shrink&&0==
Ra.space&&Ra.type==h.CLEF&&(delete Ra.seqst,Ra.time=Ra.ts_prev.time);if(!Ma)break;for(ub=0;ub<Md.length;ub++)Md[ub]=0;wc=jc;do ub=Ra.st,xc[ub]=wc,Ra.wr>Md[ub]&&(Md[ub]=Ra.wr),Ra.tp0&&1==++Nd&&!Jc&&(Jc=Ra),Ra.te0&&Nd--,Ra=Ra.ts_next;while(!Ra.seqst)}if(vc)for(var Ac=vc,yc,je,Hc,Od,sd,Kc=0,Xc=0;Ac;Ac=Ac.ts_next)if(Ac.shrink&&(Kc+=Ac.shrink,Xc++),Ac.a_gch)for(yc=0;yc<Ac.a_gch.length;yc++)if(je=Ac.a_gch[yc],!("g"!=je.type||0>je.y)){if(Hc&&Hc>Kc+je.x)for(sd=(Hc-Kc-je.x)/Xc;Od=Od.ts_next,Od.shrink&&(Od.shrink+=
sd),Od!=Ac;);Od=Ac;Hc=je.wh[0];Kc=Xc=0;break}if(Ma=Jc){do{Ra=Ma;Nd=1;do Ma=Ma.ts_next,Ma.tp0&&Nd++,Ma.te0&&Nd--;while(0!=Nd);var Bc=void 0,vb=Ra,Cc=Ma,Yc=vb.time,ud=Cc.time+Cc.dur-Yc,Zc=Rf(vb,ud/vb.tq0)*vb.tq0/ud;do vb=vb.ts_next;while(!vb.seqst);do Cc=Cc.ts_next?Cc.ts_next:Bc=Sf(Cc);while(!Cc.seqst);for(Bc=vb;;){Bc.dur&&Bc.dur*Zc<Bc.shrink&&(Zc=Bc.shrink/Bc.dur);if(Bc==Cc)break;Bc=Bc.ts_next}for(;;){vb.seqst&&(vb.space=(vb.time-Yc)*Zc,Yc=vb.time);if(vb==Cc)break;vb=vb.ts_next}do Ma=Ma.ts_next;while(Ma&&
!Ma.tp0)}while(Ma)}b=mf(!0);if(t.singleline)a=Tf(),c=b+a[0]+a[1]+Uf(V,null),ga.width=c*t.scale+ga.lm+ga.rm+2;else{var xe=c=rd(),ke=b,Sa,Ya,le,Qc,Nc,xd;Sa=V;0!=ke&&(Qc=mf(),xe-=Qc,ke-=Qc);Qc=Tf();xe-=Qc[0];ke+=Qc[1];t.custos&&1==x.length&&(xe-=12);if(t.barsperstaff)for(Qc=t.barsperstaff,Ya=Sa;Ya;Ya=Ya.ts_next)Ya.type!=h.BAR||!Ya.bar_num||0<--Qc||(Ya.eoln=!0,Qc=t.barsperstaff);Nc=ke;xd=xe*t.maxshrink;for(Ya=Sa;Sa;Sa=Sa.ts_next)if(Sa.seqst||Sa.eoln){Nc+=Sa.shrink;if(Nc>xd)a:{for(var ye=void 0,me=void 0,
ze=void 0,Ae=void 0,$b=void 0,Be=void 0,Pd=void 0,Oa=void 0,Ce=void 0,Cd=void 0,M=Ya,Ta=Sa,Dd=xe,ad=ke;Ta&&!Ta.eoln;Ta=Ta.ts_next);for(ze=Uf(M,Ta)+ad;;){me=Math.ceil(ze/Dd);if(1>=me){Ta&&(Ta=Ne(Ta));Ya=Ta;break a}Ce=Cd=M;Be=M.x-M.shrink-ad;Ae=Be+Dd;$b=Be+ze/me;Be+=ze/me*t.breaklimit;for(M=M.ts_next;M!=Ta&&!(M.x&&(M.type==h.BAR&&(Ce=M),M.x>=Be));M=M.ts_next);if(M==Ta){Ta&&(Ta=Ne(Ta));Ya=Ta;break a}ye=!1;for(Oa=null;M!=Ta;M=M.ts_next)if(Pd=M.x){if(Pd>Ae)break;if(M.type==h.BAR)if(Pd<$b)Oa=M;else{if(!Oa||
Pd-$b<$b-Oa.x)Oa=M;break}}Oa&&(M=Oa,ye=!0);if(!ye){for(var Qe=0,re=Ce.time,Ae=Ae-8,M=Ce,Oa=null;M!=Ta;M=M.ts_next)if(M.beam_st&&Qe++,M.beam_end&&0<Qe&&Qe--,Pd=M.x){if(Pd+M.wr>=Ae)break;if(!Qe&&!M.in_tuplet)if(0==(M.time-re)%(h.BLEN/4))Oa=M;else if(!Oa||M.x<$b)Oa=M;else{if(Oa>$b)break;if($b-Oa.x<M.x-$b)break;Oa=M;break}}Oa&&(M=Oa,ye=!0)}if(!ye){for(Oa=M=Ce;M!=Ta;M=M.ts_next)if(Pd=M.x)if(M.x<$b)Oa=M;else{if(Oa>$b)break;if($b-Oa.x<M.x-$b)break;Oa=M;break}M=Oa}if(M.nl)for(J(0,M,"Line split problem - adjust maxshrink and/or breaklimit"),
me=2,M=M.ts_next;M!=Ta&&!(M.x&&0>=--me);M=M.ts_next);M=Ne(M);if(!M||Ta&&M.time>=Ta.time)break;ze-=M.x-Cd.x;ad=0}Ya=M}else{if(!Sa.eoln)continue;delete Sa.eoln;if(Sa.dur)for(le=Sa.ts_next;le&&!le.seqst;le=le.ts_next)if(le.dur<Sa.dur){Sa=Sa.next?Sa.next.ts_prev:Ya=null;break}Sa&&(Ya=Ne(Sa,!0))}if(!Ya)break;Ya.ts_prev?(Nc=Ya.shrink,Sa=Ya.ts_prev,ke=0):delete Ya.nl}}for(we=1.2;;){jh();Z.set_sym_glue(c-b);if(0!=Aa){0!=b&&(ic+=b);var pd,qd,Rc,ac,fd,wb,pc,gd,bc,F,Pb,hd,te=z;z="";for(bc=0;bc<x.length;bc++){var Yd=
{},ae=!0;hd=x[bc];for(F=hd.sym;F;F=F.next)switch(F.type){case h.GRACE:for(wb=F.extra;wb;wb=wb.next)wb.beam_st&&!wb.beam_end&&Z.calculate_beam(Yd,wb);break;case h.NOTE:if(F.beam_st&&!F.beam_end||ae&&!F.beam_st)ae=!1,Z.calculate_beam(Yd,F)}}for(gd=0;gd<=R;gd++)for(Pb=u[gd],Pb.top||(Pb.top=new Float32Array(256),Pb.bot=new Float32Array(256)),ac=0;256>ac;ac++)Pb.top[ac]=0,Pb.bot[ac]=24;for(var td=void 0,cc=void 0,ne=void 0,Re=void 0,Cb=void 0,ma=void 0,be=void 0,Re=0;Re<x.length;Re++)if(be=x[Re],ma=be.sym)if(ma=
ma.next){var cb,id,vd,Db,dc,da,na;for(na=ma;na;na=na.next)if(na.ti1)if(0!=na.multi)for(Db=0<na.multi?h.SL_ABOVE:h.SL_BELOW,da=0;da<=na.nhd;da++)cb=na.notes[da].ti1,(cb&7)==h.SL_AUTO&&(na.notes[da].ti1=cb&h.SL_DOTTED|Db);else{vd=dc=0;id=128;for(da=0;da<=na.nhd;da++)na.notes[da].ti1&&(dc++,128>id&&na.notes[da].pit<=id+1&&vd++,id=na.notes[da].pit);if(1>=dc)for(Db=0>na.stem?h.SL_ABOVE:h.SL_BELOW,da=0;da<=na.nhd;da++){if(cb=na.notes[da].ti1){(cb&7)==h.SL_AUTO&&(na.notes[da].ti1=cb&h.SL_DOTTED|Db);break}}else if(0==
vd)if(dc&1)for(dc=(dc-1)/2,Db=h.SL_BELOW,da=0;da<=na.nhd;da++)cb=na.notes[da].ti1,0!=cb&&(0==dc&&22<=na.notes[da].pit&&(Db=h.SL_ABOVE),(cb&7)==h.SL_AUTO&&(na.notes[da].ti1=cb&h.SL_DOTTED|Db),0==dc--&&(Db=h.SL_ABOVE));else for(dc/=2,Db=h.SL_BELOW,da=0;da<=na.nhd;da++)cb=na.notes[da].ti1,0!=cb&&((cb&7)==h.SL_AUTO&&(na.notes[da].ti1=cb&h.SL_DOTTED|Db),0==--dc&&(Db=h.SL_ABOVE));else{id=128;for(da=0;da<=na.nhd;da++)if(na.notes[da].ti1){if(128>id&&na.notes[da].pit<=id+1){dc=da;break}id=na.notes[da].pit}Db=
h.SL_BELOW;for(da=0;da<=na.nhd;da++)cb=na.notes[da].ti1,0!=cb&&(dc==da&&(Db=h.SL_ABOVE),(cb&7)==h.SL_AUTO&&(na.notes[da].ti1=cb&h.SL_DOTTED|Db))}}for(;ma;ma=ma.next)if(ma.ti1&&(20>ma.notes[0].pit&&(ma.notes[0].ti1&7)==h.SL_BELOW||24<ma.notes[ma.nhd].pit&&(ma.notes[ma.nhd].ti1&7)==h.SL_ABOVE)){for(Cb=ma.next;Cb&&Cb.type!=h.NOTE;)Cb=Cb.next;if(Cb){if(Cb.st!=ma.st)continue;ne=Cb.x-ma.x-10}else ne=Aa-ma.x-10;td=100>ne?9:300>ne?12:16;24<ma.notes[ma.nhd].pit&&(cc=3*(ma.notes[ma.nhd].pit-18)+td,ma.ymx<cc&&
(ma.ymx=cc),Cb&&Cb.ymx<cc&&(Cb.ymx=cc),Q(ma.st,!0,ma.x+5,ne,cc));20>ma.notes[0].pit&&(cc=3*(ma.notes[0].pit-18)-td,ma.ymn>cc&&(ma.ymn=cc),Cb&&Cb.ymn>cc&&(Cb.ymn=cc),Q(ma.st,!1,ma.x+5,ne,cc))}}Ng();for(F=V;F;F=F.ts_next)if(!F.invis){switch(F.type){case h.GRACE:for(wb=F.extra;wb;wb=wb.next)Q(F.st,!0,wb.x-2,4,wb.ymx+1),Q(F.st,!1,wb.x-2,4,wb.ymn-1);continue;case h.MREST:Q(F.st,!0,F.x+16,32,F.ymx+2);continue;default:Q(F.st,!0,F.x-F.wl,F.wl+F.wr,F.ymx+2);Q(F.st,!1,F.x-F.wl,F.wl+F.wr,F.ymn-2);continue;case h.NOTE:}0<
F.stem?(F.stemless?(Rc=-5,fd=10):F.beam_st?(Rc=3,fd=F.beam_end?4:10):(Rc=-8,fd=F.beam_end?11:16),Q(F.st,!0,F.x+Rc,fd,F.ymx),Q(F.st,!1,F.x-F.wl,F.wl+F.wr,F.ymn)):(Q(F.st,!0,F.x-F.wl,F.wl+F.wr,F.ymx),F.stemless?(Rc=-5,fd=10):F.beam_st?(Rc=-6,fd=F.beam_end?4:10):(Rc=-8,fd=F.beam_end?5:16),Rc+=F.notes[0].shhd,Q(F.st,!1,F.x+Rc,fd,F.ymn));F.notes[F.nhd].acc&&(pc=F.y+8,F.ymx<pc&&(F.ymx=pc),Q(F.st,!0,F.x,0,pc));F.notes[0].acc&&(pc=F.y,pc=1==F.notes[0].acc||3==F.notes[0].acc?pc-7:pc-5,F.ymn>pc&&(F.ymn=pc),
Q(F.st,!1,F.x,0,pc))}for(bc=0;bc<x.length;bc++)if(hd=x[bc],F=hd.sym){for(uc(F.color);F;F=F.next)F.tp0&&kf(F,0);var Qd=void 0,pb=void 0,Dc=hd,db=Dc.sym,Sc=Dc.slur_start,Rd=0;if(db){if(Sc)for(Dc.slur_start=0;0!=Sc;)Rd<<=4,Rd|=Sc&15,Sc>>=4;for(jf(db,void 0);db;db=db.next)for(;db.slur_end||db.sl2;){if(db.slur_end)db.slur_end--,Qd=-1;else{for(Qd=0;Qd<=db.nhd&&!db.notes[Qd].sl2;Qd++);db.notes[Qd].sl2--;db.sl2--}Sc=Rd&15;pb=uf(db);Le(pb,db,-1,Qd,Sc);pb.type==h.BAR&&(":"==pb.bar_type[0]||"|]"==pb.bar_type||
"[|"==pb.bar_type||pb.text&&"1"!=pb.text[0])||(Rd>>=4)}for(db=Dc.sym;0!=Rd;)Sc=Rd&15,Rd>>=4,pb=Cf(db),Le(db,pb,-1,-1,Sc),pb.type==h.BAR&&(":"==pb.bar_type[0]||"|]"==pb.bar_type||"[|"==pb.bar_type||pb.text&&"1"!=pb.text[0])||(Dc.slur_start||(Dc.slur_start=0),Dc.slur_start<<=4,Dc.slur_start+=Sc)}for(F=hd.sym;F;F=F.next)F.tp0&&kf(F,0)}for(gd=0;gd<=R;gd++)for(Pb=u[gd],qd=Pb.topbar+2,pd=Pb.botbar-2,ac=0;256>ac;ac++)qd>Pb.top[ac]&&(Pb.top[ac]=qd),pd<Pb.bot[ac]&&(Pb.bot[ac]=pd);uc();for(var yd=void 0,de=
void 0,Se=void 0,Te=void 0,ue=oa.length,Te=0;Te<ue;Te++)if(Se=oa[Te],de=Se.dd,yd=de.func,vh[yd]&&void 0==Se.m)hf[yd](Se);if(0<=t.measurenb){for(var zd=void 0,Ue=void 0,Ve=void 0,ec=void 0,ya=void 0,jd=void 0,Qb=void 0,Da=void 0,xa=void 0,Ad=E,Da=0;Da<=R&&!Ad.st_print[Da];Da++);if(!(Da>R)){Tb(Da);1!=u[Da].staffscale&&(Ue=lc("measure").size,Me("measurefont","* "+(Ue/u[Da].staffscale).toString()));pa("measure");zd=$c("0")*D.curfont.swfac;xa=V;Qb=D.nbar;if(1<Qb)if(0==t.measurenb)Ve=!0,ya=T(Da,!0,0,20),
ya<u[Da].topbar+14&&(ya=u[Da].topbar+14),la(0,ya,Qb.toString()),Q(Da,!0,0,20,ya+D.curfont.size+2);else if(0==Qb%t.measurenb){for(;;xa=xa.ts_next){switch(xa.type){case h.TIMESIG:case h.CLEF:case h.KEYSIG:case h.FMTCHG:case h.STBRK:continue}break}xa.type==h.BAR&&xa.bar_num||(xa.prev&&(xa=xa.prev),jd=xa.x+xa.wr,Ve=!0,ec=zd,10<=Qb&&(ec*=100<=Qb?3:2),D.curfont.box&&(ec+=4),ya=T(Da,!0,jd,ec),ya<u[Da].topbar+6&&(ya=u[Da].topbar+6),ya+=2,la(jd,ya,Qb.toString()),D.curfont.box&&(ya+=2,ec+=3),ya+=D.curfont.size,
Q(Da,!0,jd,ec,ya),xa.ymx=ya)}for(;xa;xa=xa.ts_next){switch(xa.type){case h.STAVES:Ad=xa.sy;for(Da=0;Da<R&&!Ad.st_print[Da];Da++);Tb(Da);continue;default:continue;case h.BAR:if(!xa.bar_num)continue}Qb=xa.bar_num;0!=t.measurenb&&0==Qb%t.measurenb&&xa.next&&!xa.bar_mrep&&(Ve||(Ve=!0),ec=zd,10<=Qb&&(ec*=100<=Qb?3:2),jd=xa.x-.4*ec,ya=T(Da,!0,jd,ec),ya<u[Da].topbar+3&&(ya=u[Da].topbar+3),xa.next.type==h.NOTE&&(0<xa.next.stem?ya<xa.next.ys-D.curfont.size&&(ya=xa.next.ys-D.curfont.size):ya<xa.next.y&&(ya=
xa.next.y)),ya+=2,D.curfont.box&&(ya+=2,ec+=3),la(jd,ya,Qb.toString()),ya+=D.curfont.size,D.curfont.box&&(ya+=2),Q(Da,!0,jd,ec,ya),xa.ymx=ya)}D.nbar=Qb;Ue&&Me("measurefont","* "+Ue.toString())}}for(var Bd=void 0,Ed=void 0,We=void 0,De=void 0,Xe=void 0,kd=void 0,Ea=void 0,Ye=void 0,Fa=void 0,Fd=void 0,qc=void 0,Ee=void 0,Ze=void 0,$e=void 0,Ja=void 0,eb=Array(R),ee=oa.length,Fa=0;Fa<=R;Fa++)eb[Fa]={ymin:0,ymax:0};for(Fa=0;Fa<ee;Fa++)Ea=oa[Fa],(kd=Ea.dd)&&od[kd.func]&&void 0==Ea.m&&(hf[kd.func](Ea),
!kd.dd_en&&t.dynalign&&(Ea.up?Ea.y>eb[Ea.st].ymax&&(eb[Ea.st].ymax=Ea.y):Ea.y<eb[Ea.st].ymin&&(eb[Ea.st].ymin=Ea.y)));for(Fa=0;Fa<ee;Fa++)Ea=oa[Fa],(kd=Ea.dd)&&!kd.dd_en&&od[kd.func]&&(t.dynalign?(qc=Ea.up?eb[Ea.st].ymax:eb[Ea.st].ymin,Ea.y=qc):qc=Ea.y,Ea.up&&(qc+=kd.h),Q(Ea.st,Ea.up,Ea.x,Ea.val,qc));for(Fa=0;Fa<=R;Fa++)eb[Fa]={ymin:0,ymax:24};for(Ja=V;Ja;Ja=Ja.ts_next)if(Ja.a_gch){$e||($e=Ja);De=null;for(We=0;We<Ja.a_gch.length&&!(Xe=Ja.a_gch[We],"g"==Xe.type&&(De=Xe,0>Xe.y));We++);De&&(Fd=De.wh[0],
0<=De.y?(qc=T(Ja.st,!0,Ja.x,Fd),qc>eb[Ja.st].ymax&&(eb[Ja.st].ymax=qc)):(qc=T(Ja.st,!1,Ja.x,Fd),qc<eb[Ja.st].ymin&&(eb[Ja.st].ymin=qc)))}if($e){for(Fa=0;Fa<=R;Fa++)Bd=u[Fa].botbar,eb[Fa].ymin>Bd-4&&(eb[Fa].ymin=Bd-4),Ed=u[Fa].topbar,eb[Fa].ymax<Ed+4&&(eb[Fa].ymax=Ed+4);Tb(-1);for(Ja=$e;Ja;Ja=Ja.ts_next)Ja.a_gch&&Z.draw_gchord(Ja,eb[Ja.st].ymin,eb[Ja.st].ymax)}for(Ye=0;Ye<x.length;Ye++)if(Ze=x[Ye],!Ze.second&&Ze.sym){var Gd=void 0,Hd,Fe,Ec,Sd,xb,U,Rb=Ze;Sd=u[Rb.st].topbar+25;for(U=Rb.sym;U;U=U.next)if(U.type==
h.BAR&&U.rbstart&&!U.norepbra){if(!U.next)break;Gd||(Gd=U,pa("repeat"));for(xb=U;U.next&&(U=U.next,!U.rbstop););Ec=T(Rb.st,!0,xb.x,U.x-xb.x);Sd<Ec&&(Sd=Ec);xb.text&&(Hd=Pa(xb.text),Ec=T(Rb.st,!0,xb.x+4,Hd[0]),Ec+=Hd[1],Sd<Ec&&(Sd=Ec));U.rbstart&&(U=U.prev)}if(U=Gd)for(Tb(Rb.st,!0),Ec=Sd*u[Rb.st].staffscale;U;U=U.next)if(U.rbstart&&!U.norepbra){for(xb=U;U.next&&(U=U.next,!U.rbstop););if(xb==U)break;Ee=xb.x;Fe=U.type!=h.BAR?U.rbstop?0:U.x-Aa+4:1<U.bar_type.length&&"[]"!=U.bar_type||"]"==U.bar_type?
0<xb.st&&!(E.staves[xb.st-1].flags&64)?U.wl:":"==U.bar_type.slice(-1)?12:":"!=U.bar_type[0]?0:8:U.rbstop?0:8;Fe=U.x-Ee-Fe;U.next||U.rbstop||Rb.bar_start||(Rb.bar_start=A(U),Rb.bar_start.type=h.BAR,Rb.bar_start.bar_type="",delete Rb.bar_start.text,Rb.bar_start.rbstart=1,delete Rb.bar_start.a_gch);xb.text&&la(Ee+4,Ec-D.curfont.size-3,xb.text);Xd(Ee,Ec);2==xb.rbstart&&(z+="m0 20v-20");z+="h"+Fe.toFixed(1);2==U.rbstop&&(z+="v20");z+='"/>\n';Q(xb.st,!0,Ee,Fe,Sd+2);U.rbstart&&(U=U.prev)}}Tb(-1);for(bc=
0;bc<x.length;bc++)if(hd=x[bc],hd.have_ly){for(var oe=void 0,pe=void 0,af=void 0,fc=void 0,bf=void 0,yb=void 0,Ge=void 0,ja=void 0,fb=void 0,Ba=void 0,Eb=Array(R),Td=x.length,ld=Array(Td),He=Array(Td),Id=Array(Td),fe=Array(Td),md=0,Tc=0,Ga=-1,ja=0;ja<Td;ja++)if(Ba=x[ja],Ba.sym){Ba.st!=Ga&&(Tc=md=0,Ga=Ba.st);Ge=0;if(Ba.have_ly)for(ld[ja]||(ld[ja]=[]),fb=Ba.sym;fb;fb=fb.next){if(pe=fb.a_ly){bf=fb.x;af=10;for(yb=0;yb<pe.length;yb++)if(oe=pe[yb]){bf-=oe.shift;af=oe.wh[0];break}fc=T(Ba.st,1,bf,af);md<
fc&&(md=fc);fc=T(Ba.st,0,bf,af);for(Tc>fc&&(Tc=fc);Ge<pe.length;)ld[ja][Ge++]=0;for(yb=0;yb<pe.length;yb++)(oe=pe[yb])&&(!ld[ja][yb]||oe.font.size>ld[ja][yb])&&(ld[ja][yb]=oe.font.size)}}else fc=T(Ba.st,1,0,Aa),md<fc&&(md=fc),fc=T(Ba.st,0,0,Aa),Tc>fc&&(Tc=fc);Eb[Ga]||(Eb[Ga]={});Eb[Ga].top=md;Eb[Ga].bot=Tc;He[ja]=Ge;0!=Ge&&(Id[ja]=Ba.pos.voc?Ba.pos.voc==h.SL_ABOVE:x[ja+1]&&x[ja+1].st==Ga&&x[ja+1].have_ly?!0:!1,Id[ja]?Eb[Ga].a=!0:Eb[Ga].b=!0)}for(ja=yb=0;ja<Td;ja++)Ba=x[ja],Ba.sym&&Ba.have_ly&&(Id[ja]?
fe[yb++]=ja:(Ga=Ba.st,Tb(Ga,!0),0<He[ja]&&(Eb[Ga].bot=zg(Ba,He[ja],ld[ja],Eb[Ga].bot,1))));for(;0<=--yb;)ja=fe[yb],Ba=x[ja],Ga=Ba.st,Tb(Ga,!0),Eb[Ga].top=zg(Ba,He[ja],ld[ja],Eb[Ga].top,-1);for(ja=0;ja<Td;ja++)if(Ba=x[ja],Ba.sym){Ga=Ba.st;if(Eb[Ga].a)for(md=Eb[Ga].top+2,fb=Ba.sym.next;fb;fb=fb.next)fb.a_ly&&Q(Ga,1,fb.x-2,10,md);if(Eb[Ga].b)if(Tc=Eb[Ga].bot-2,0<He[Ba.v])for(fb=Ba.sym.next;fb;fb=fb.next)fb.a_ly&&Q(Ga,0,fb.x-2,10,Tc);else Q(Ga,0,0,Aa,Tc)}break}Tb(-1);z=te;d=Ug();Vg(b);var cf,df,ve=x.length;
for(cf=0;cf<ve;cf++)df=x[cf],df.sym&&void 0!=df.sym.x&&Z.draw_symbols(df);var ef=void 0,qe=void 0,ff=void 0,Jd=void 0,Ud=void 0,Vd=void 0,jb=void 0,gc=void 0,Fb=void 0,rc=void 0,ge=void 0,Wd=void 0,Fc=void 0,ka=void 0;if(0!=oa.length){var he=[],Kd=[];if(!t.dynalign)for(Fb=R,jb=u[Fb].y;0<=--Fb;)Vd=u[Fb].y,Kd[Fb]=.5*(jb+24+Vd),jb=Vd;for(;;){ka=oa.shift();if(!ka)break;if((Fc=ka.dd)&&!Fc.dd_en&&(Wd=ka.s,rc=Fc.glyph,ff=rc.indexOf("/"),0<ff&&(rc=0<=Wd.stem?rc.slice(0,ff):rc.slice(ff+1)),od[Fc.func]?gb(Wd.st):
bd(Wd),Fb=ka.st,u[Fb].topbar))if(gc=ka.x,jb=ka.y+u[Fb].y,void 0!=ka.m?(ge=Wd.notes[ka.m],gc+=ge.shhd*C.scale):od[Fc.func]&&!t.dynalign&&(ka.up&&0<Fb||!ka.up&&Fb<R)&&(Ud=ka.up?Kd[--Fb]:Kd[Fb++],Ud-=.5*Fc.h,ka.up&&jb<Ud||!ka.up&&jb>Ud)&&(Vd=T(Fb,!ka.up,ka.x,ka.val)+u[Fb].y,ka.up&&(Vd-=Fc.h),ka.up&&Vd>Ud||!ka.up&&Vd<Ud)&&(jb=Ud),(Jd=w[rc])&&"function"==typeof Jd)Jd(gc,jb,ka);else if(!Z.psdeco(rc,gc,jb,ka)){qb(Wd,"deco");ka.inv&&(Zd(gc,jb,0,1,-1),gc=jb=0);if(ka.has_val)2!=Fc.func||0>C.st?qf(gc,jb,rc,
ka.val/C.scale,ka.defl):qf(gc,jb,rc,ka.val,ka.defl),ka.defl.noen&&he.push(ka.start);else if(void 0!=Fc.str)qe=Fc.str,"@"==qe[0]&&(ef=qe.match(/^@([0-9.-]+),([0-9.-]+);?/),gc+=Number(ef[1]),jb+=Number(ef[2]),qe=qe.replace(ef[0],"")),ng(gc,jb,rc,qe);else if(ka.lden){var rf=ka.dd.glyph;if(Mg[rf])Mg[rf](gc,jb,ka);else J(1,null,"No function for decoration '$1'",rf)}else ca(gc,jb,rc);C.g&&$d();zb(Wd,"deco")}}oa=he}gb(-1);var hc;for(hc=0;hc<=R;hc++)u[hc].sc_out&&(z+='<g transform="translate(0,'+(ra-u[hc].y).toFixed(1)+
") scale("+u[hc].staffscale.toFixed(2)+')">\n'+u[hc].sc_out+"</g>\n",u[hc].sc_out=""),u[hc].output&&(z+='<g transform="translate(0,'+(-u[hc].y).toFixed(1)+')">\n'+u[hc].output+"</g>\n",u[hc].output="");ia(d);0!=b&&(ic-=b,ce&=-3);for(;0!=Pe.length;)Wf(Pe.shift())}V=Sb;t.splittune?Lc():wd();if(!Sb)break;Xf();if(!V)break;V.ts_prev=null;var gf,sf,tf,Ie=x.length;for(gf=0;gf<Ie;gf++)if(tf=x[gf],sf=tf.s_next,tf.sym=sf)sf.prev=null;c=rd();b=mf()}}};Abc.prototype.param_set_font=Me;Abc.prototype.parse=l;Abc.prototype.psdeco=
function(){return!1};Abc.prototype.psxygl=function(){return!1};Abc.prototype.set_bar_num=function(){var a,c,b,d,e,f=x[E.top_voice].meter.wmeasure,g=D.nbar;for(a=V;;a=a.ts_next){if(!a)return;switch(a.type){case h.METER:f=a.wmeasure;case h.CLEF:case h.KEY:case h.STBRK:continue;case h.BAR:a.bar_num?D.nbar=a.bar_num:a.text&&!t.contbarnb&&("1"==a.text[0]?g=D.nbar:(D.nbar=g,a.bar_num=D.nbar))}break}b=a.time+f;if(0==a.time)for(c=a.ts_next;c;c=c.ts_next)if(c.type==h.BAR&&c.time){c.time<b&&(a=c,b=a.time+f);
break}for(d=D.nbar;a;a=a.ts_next)switch(a.type){case h.METER:f=a.wmeasure;a.time<b&&(b=a.time+f);break;case h.MREST:for(d+=a.nmes-1;a.ts_next&&a.ts_next.type!=h.BAR;)a=a.ts_next;break;case h.BAR:if(a.bar_num&&(d=a.bar_num),a.time<b)a.text&&"1"==a.text[0]&&(g=d,e=b-a.time);else{b=a.time;c=a;do{if(c.dur)break;if(c.type==h.BAR&&c.text)break;c=c.next}while(c&&c.time==b);d++;if(c&&c.type==h.BAR&&c.text)if("1"==c.text[0])e=0,g=d;else if(t.contbarnb||(d=g),e){t.contbarnb&&d--;b+=e;break}a.bar_num=d;for(b+=
f;a.ts_next&&!a.ts_next.seqst;)a=a.ts_next}}0>t.measurenb&&(D.nbar=d)};Abc.prototype.set_cur_sy=function(a){E=a};Abc.prototype.set_dscale=Tb;Abc.prototype.set_font=pa;Abc.prototype.set_format=function(a,c){var b,d,e;if(/.+font(-[\d])?$/.test(a))Me(a,c);else switch(a){case "aligncomposer":case "barsperstaff":case "infoline":case "measurefirst":case "measurenb":case "rbmax":case "rbmin":case "shiftunison":b=parseInt(c);if(isNaN(b)){p(1,"Bad integer value");break}t[a]=b;break;case "microscale":b=parseInt(c);
if(isNaN(b)||4>b||256<b||b%1){p(1,N.bad_val,"%%"+a);break}Z.set_v_param("uscale",b);break;case "bgcolor":case "dblrepbar":case "titleformat":t[a]=c;break;case "breaklimit":case "lineskipfac":case "maxshrink":case "pagescale":case "parskipfac":case "scale":case "slurheight":case "stemheight":case "stretchlast":b=parseFloat(c);if(isNaN(b)){p(1,N.bad_val,"%%"+a);break}switch(a){case "scale":b/=.75;case "pagescale":a="scale",ga.chg=!0}t[a]=b;break;case "annotationbox":case "gchordbox":case "measurebox":case "partsbox":t[a.replace("box",
"font")].box=kc(c);break;case "bstemdown":case "breakoneoln":case "cancelkey":case "contbarnb":case "custos":case "decoerr":case "dynalign":case "flatbeams":case "graceslurs":case "graceword":case "hyphencont":case "keywarn":case "linewarn":case "rbdbstop":case "singleline":case "squarebreve":case "splittune":case "straightflags":case "stretchstaff":case "timewarn":case "titlecaps":case "titleleft":t[a]=kc(c);break;case "chordnames":b=c.split(",");t.chordnames={};for(e=0;e<b.length;e++)t.chordnames["CDEFGAB"[e]]=
b[e];break;case "composerspace":case "indent":case "infospace":case "maxstaffsep":case "maxsysstaffsep":case "musicspace":case "partsspace":case "staffsep":case "subtitlespace":case "sysstaffsep":case "textspace":case "titlespace":case "topspace":case "vocalspace":case "wordsspace":b=mb(c);isNaN(b)?p(1,N.bad_val,"%%"+a):t[a]=b;break;case "print-leftmargin":p(0,"$1 is deprecated - use %%printmargin instead","%%"+a),a="printmargin";case "printmargin":case "leftmargin":case "pagewidth":case "rightmargin":b=
mb(c);if(isNaN(b)){p(1,N.bad_val,"%%"+a);break}t[a]=b;ga.chg=!0;break;case "concert-score":"play"!=t.sound&&(t.sound="concert");break;case "writefields":d=c.split(/\s+/);if(kc(d[1]))for(b=0;b<d[0].length;b++)e=d[0][b],0>t.writefields.indexOf(e)&&(t.writefields+=e);else for(b=0;b<d[0].length;b++)e=d[0][b],0<=t.writefields.indexOf(e)&&(t.writefields=t.writefields.replace(e,""));break;case "dynamic":case "gchord":case "gstemdir":case "ornament":case "stemdir":case "vocal":case "volume":Ff(a,c);break;
case "font":e=Jc(c);1>=e.length||(b=parseFloat(e[e.length-1]),isNaN(b)||.5>=b?p(1,"Bad scale value in %%font"):Gf[e[0]]=b);break;case "fullsvg":if(0!=l.state){p(1,N.not_in_tune,"%%fullsvg");break}t[a]=c;break;case "gracespace":b=c.split(/\s+/);for(e=0;3>e;e++)if(isNaN(Number(b[e]))){p(1,N.bad_val,"%%gracespace");break}for(e=0;3>e;e++)t[a][e]=Number(b[e]);break;case "tuplets":t[a]=c.split(/\s+/);(b=t[a][3])&&he[b]&&(t[a][3]=he[b]);break;case "infoname":a:{e=t.infoname.split("\n");b=c[0];for(d=0;d<
e.length;d++)if(e[d][0]==b){1==c.length?e.splice(d,1):e[d]=c;t.infoname=e.join("\n");break a}t.infoname+="\n"+c}break;case "notespacingfactor":b=parseFloat(c);if(isNaN(b)||1>b||2<b){p(1,N.bad_val,"%%"+a);break}e=5;for(d=hb[e];0<=--e;)d/=b,hb[e]=d;e=5;for(d=hb[e];++e<hb.length;)d*=b,hb[e]=d;break;case "play":t.sound="play";break;case "pos":a=c.split(/\s+/);Ff(a[0],a[1]);break;case "sounding-score":"play"!=t.sound&&(t.sound="sounding");break;case "staffwidth":b=mb(c);if(isNaN(b)){p(1,N.bad_val,"%%"+
a);break}if(100>b){p(1,"%%staffwidth too small");break}b=t.pagewidth-b-t.leftmargin;if(2>b){p(1,"%%staffwidth too big");break}t.rightmargin=b;ga.chg=!0;break;case "textoption":t[a]=Kg[c];break;case "titletrim":b=Number(c);isNaN(b)?t[a]=kc(c):t[a]=b;break;case "combinevoices":p(1,"%%combinevoices is deprecated - use %%voicecombine instead");break;case "voicemap":Z.set_v_param("map",c);break;case "voicescale":Z.set_v_param("scale",c);break;default:0==l.state&&(t[a]=c)}};Abc.prototype.set_pitch=function(a){var c,
b,d,e,f=h.BLEN,g=R+1,k=new Int16Array(Array(2*g));for(b=0;b<=R;b++)c=u[b].clef,k[b]=Kd[c.clef_type]+2*c.clef_line,c.clefpit&&(k[b]+=c.clefpit),t.sound?c.clef_octave&&!c.clef_oct_transp&&(k[b]+=c.clef_octave):c.clef_oct_transp&&(k[b]-=c.clef_octave);for(c=V;c!=a;c=c.ts_next)switch(b=c.st,c.type){case h.CLEF:k[b]=Kd[c.clef_type]+2*c.clef_line;c.clefpit&&(k[b]+=c.clefpit);t.sound?c.clef_octave&&!c.clef_oct_transp&&(k[b]+=c.clef_octave):c.clef_oct_transp&&(k[b]-=c.clef_octave);vd(c);break;case h.GRACE:for(b=
c.extra;b;b=b.next){d=k[b.st];if(0!=d&&!c.p_v.key.k_drum)for(g=0;g<=b.nhd;g++)e=b.notes[g],e.pit+=d;b.ymn=3*(b.notes[0].pit-18)-2;b.ymx=3*(b.notes[b.nhd].pit-18)+2}vd(c);break;case h.KEY:c.k_y_clef=k[b];default:vd(c);break;case h.MREST:if(c.invis)break;c.y=12;c.ymx=39;c.ymn=-2;break;case h.REST:if(1==x.length){c.y=12;c.ymx=24;c.ymn=0;break}case h.NOTE:d=k[b];if(0!=d&&!c.p_v.key.k_drum)for(g=c.nhd;0<=g;g--)c.notes[g].opit=c.notes[g].pit,c.notes[g].pit+=d;c.type==h.NOTE?(c.ymx=3*(c.notes[c.nhd].pit-
18)+4,c.ymn=3*(c.notes[0].pit-18)-4):(c.y=6*((c.notes[0].pit-18)/2|0),c.ymx=c.y+Lg[5-c.nflags][0],c.ymn=c.y-Lg[5-c.nflags][1]);c.dur<f&&(f=c.dur)}a||(be=f)};Abc.prototype.set_scale=bd;Abc.prototype.set_stem_dir=function(){for(var a,c,b,d,e,f,g,k=[],l=V,n=E,p=n.nstaff;l;){for(a=0;a<=p;a++)k[a]=[];g=[];for(c=l;c&&c.type!=h.BAR;c=c.ts_next)if(c.type==h.STAVES){if(c!=l)break;n=l.sy;for(a=p;a<=n.nstaff;a++)k[a]=[];p=n.nstaff}else if(!(c.type!=h.NOTE&&c.type!=h.REST||c.invis)){a=c.st;if(a>p)throw c="*** fatal set_stem_dir(): bad staff number "+
a+" max "+p,J(2,null,c),Error(c);b=c.v;d=g[b];d||(d={st1:-1,st2:-1},g[b]=d);0>d.st1?d.st1=a:d.st1!=a&&(a>d.st1?a>d.st2&&(d.st2=a):(d.st1>d.st2&&(d.st2=d.st1),d.st1=a));e=k[a];d=n.voices[b].range;for(b=e.length;0<=--b&&(f=e[b],f.v!=d););if(0>b){f={v:d,ymx:0,ymn:24};for(b=0;b<e.length;b++)if(d<e[b].v){e.splice(b,0,f);break}b==e.length&&e.push(f)}c.type==h.NOTE&&(c.ymx>f.ymx&&(f.ymx=c.ymx),c.ymn<f.ymn&&(f.ymn=c.ymn),c.xstem&&(c.ts_prev.st!=a-1||c.ts_prev.type!=h.NOTE?(J(1,l,"Bad !xstem!"),c.xstem=!1):
(c.ts_prev.multi=1,c.multi=1,c.stemless=!0)))}for(;l!=c;l=l.ts_next)if(!l.multi){switch(l.type){default:continue;case h.REST:if(void 0!=l.combine&&0>l.combine||!l.ts_next||l.ts_next.type!=h.REST||l.ts_next.st!=l.st||l.time!=l.ts_next.time||l.dur!=l.ts_next.dur||l.a_gch&&l.ts_next.a_gch||l.invis)break;l.ts_next.a_gch&&(l.a_gch=l.ts_next.a_gch);lb(l.ts_next);case h.NOTE:case h.GRACE:}a=l.st;b=l.v;d=g[b];e=k[a];if(d&&0<=d.st2)a==d.st1?l.multi=-1:a==d.st2&&(l.multi=1);else if(1>=e.length)l.floating&&
(l.multi=a==x[b].st?-1:1);else{d=n.voices[b].range;for(b=e.length;0<=--b&&e[b].v!=d;);0>b||(b==e.length-1?l.multi=-1:(l.multi=1,0!=b&&b+2==e.length&&(e[b].ymn-t.stemheight>e[b+1].ymx&&(l.multi=-1),a=l.ts_next,l.ts_prev&&l.ts_prev.time==l.time&&l.ts_prev.st==l.st&&l.notes[l.nhd].pit==l.ts_prev.notes[0].pit&&l.beam_st&&l.beam_end&&(!a||a.st!=l.st||a.time!=l.time)&&(l.multi=-1))))}}for(;l&&l.type==h.BAR;)l=l.ts_next}};Abc.prototype.set_stems=function(){var a,c,b,d,e,f,g,k;for(a=V;a;a=a.ts_next)if(a.type!=
h.NOTE){if(a.type==h.GRACE){g=k=a.mid;for(b=a.extra;b;b=b.next)c=Je(a,b.dur),b.head=c[0],b.dots=c[1],b.nflags=c[2],c=15,1<b.nflags&&(c+=1.2*(b.nflags-1)),e=3*(b.notes[0].pit-18),f=3*(b.notes[b.nhd].pit-18),0<=a.stem?(b.y=e,b.ys=f+c,f=Math.round(b.ys)):(b.y=f,b.ys=e-c,e=Math.round(b.ys)),f+=2,e-=2,e<g?g=e:f>k&&(k=f),b.ymx=f,b.ymn=e;a.ymx=k;a.ymn=g}}else{Kf(a);b=a.nflags;if(a.beam_st&&!a.beam_end){a.feathered_beam&&(b=++a.nflags);for(c=a.next;c.type!=h.NOTE||(a.feathered_beam&&c.nflags++,!c.beam_end);c=
c.next);c.nflags>b&&(b=c.nflags)}else if(!a.beam_st&&a.beam_end){for(c=a.prev;!c.beam_st;c=c.prev);c.nflags>b&&(b=c.nflags)}c=t.stemheight;switch(b){case 2:c+=0;break;case 3:c+=4;break;case 4:c+=8;break;case 5:c+=12}1!=(d=a.p_v.scale)&&(c*=.5*(d+1));e=3*(a.notes[0].pit-18);0<a.nhd?(c-=2,f=3*(a.notes[a.nhd].pit-18)):f=e;a.ntrem&&(c+=2*a.ntrem);a.stemless?(0<=a.stem?(a.y=e,a.ys=f):(a.ys=e,a.y=f),-4==b&&(e-=6),a.ymx=f+4,a.ymn=e-4):0<=a.stem?(26<a.notes[a.nhd].pit&&(0>=b||!a.beam_st||!a.beam_end)&&(c-=
2,28<a.notes[a.nhd].pit&&(c-=2)),a.y=e,a.notes[0].ti1&&(e-=3),a.ymn=e-4,a.ys=f+c,a.ys<a.mid&&(a.ys=a.mid),a.ymx=a.ys+2.5|0):(18>a.notes[0].pit&&(0>=b||!a.beam_st||!a.beam_end)&&(c-=2,16>a.notes[0].pit&&(c-=2)),a.ys=e-c,a.ys>a.mid&&(a.ys=a.mid),a.ymn=a.ys-2.5|0,a.y=f,a.notes[a.nhd].ti1&&(f+=3),a.ymx=f+4)}};Abc.prototype.set_sym_glue=function(a){var c,b,d,e,f=0,g=0,k=0,l=0,n=0;for(c=V;c;c=c.ts_next)c.type!=h.GRACE||d||(d=c),c.seqst&&(f+=c.shrink,c.space?c.space<c.shrink?(n+=c.shrink,g+=c.shrink):g+=
c.space:l+=c.shrink);if(0==g)Aa=0;else{b=!Sb||Sb.type==h.BLOCK||Pe.length;if(f>=a){f>a&&J(1,c,"Line too much shrunk $1 $2 $3",f.toFixed(1),g.toFixed(1),a.toFixed(1));k=0;for(c=V;c;c=c.ts_next)c.seqst&&(k+=c.shrink),c.x=k;we=0}else if(b&&g+l>a*(1-t.stretchlast)||!b&&(g+l>a||t.stretchstaff)){g==n&&(g+=5);for(b=4;0<=--b;){e=(a-l-n)/(g-n);k=n=g=0;for(c=V;c;c=c.ts_next)c.seqst&&(c.space?c.space*e<=c.shrink?(n+=c.shrink,g+=c.shrink,k+=c.shrink):(g+=c.space,k+=c.space*e):k+=c.shrink),c.x=k;if(.1>Math.abs(k-
a))break}we=e}else for(e=(a-l-n)/g,we<e&&(e=we),c=V;c;c=c.ts_next)c.seqst&&(k+=c.space*e<=c.shrink?c.shrink:c.space*e),c.x=k;Aa=k;for(c=d;c;c=c.ts_next)if(c.type==h.GRACE)for(k=c.gr_shift?c.prev.x+c.prev.wr:c.x-c.wl,a=c.extra;a;a=a.next)a.x+=k}};Abc.prototype.set_tsfirst=function(a){V=a};Abc.prototype.set_vp=function(a){for(var c,b,d,e,f;;){b=a.shift();if(!b)break;if("="==b[b.length-1]&&0==a.length){p(1,N.bad_val,b);break}switch(b){case "clef=":c=a.shift();break;case "clefpitch=":if(b=a.shift())if(e=
Cd.indexOf(b[0]),0<=e){switch(b[1]){case "'":e+=7;break;case ",":e-=7,","==b[2]&&(e-=7)}f=4-e;break}p(1,N.bad_val,b);break;case "octave=":case "uscale=":e=parseInt(a.shift());isNaN(e)?p(1,N.bad_val,b):k[b.slice(0,-1)]=e;break;case "cue=":k.scale="on"==a.shift()?.7:1;break;case "instrument=":k.transp=xc(a.shift(),"instr");break;case "map=":k.map=a.shift();break;case "name=":case "nm=":k.nm=a.shift();'"'==k.nm[0]&&(k.nm=k.nm.slice(1,-1));k.new_name=!0;break;case "stem=":case "pos=":b="pos="==b?a.shift().split(" "):
["stm",a.shift()];e=he[b[1]];if(void 0==e){p(1,N.bad_val,b[0]);break}d||(d={});d[b[0]]=e;break;case "scale=":e=parseFloat(a.shift());isNaN(e)||.6>e||1.5<e?p(1,N.bad_val,"%%voicescale"):k.scale=e;break;case "score=":if(t.sound)break;b=a.shift();0>b.indexOf("/")&&(b+="/c");k.transp=xc(b);break;case "shift=":k.shift=xc(a.shift());break;case "sound=":case "transpose=":if(!t.sound)break;k.transp=xc(a.shift());break;case "subname=":case "sname=":case "snm=":k.snm=a.shift();'"'==k.snm[0]&&(k.snm=k.snm.slice(1,
-1));break;case "stafflines=":e=lh(a.shift());void 0==e?p(1,"Bad %%stafflines value"):void 0!=k.st?G.staves[k.st].stafflines=e:k.stafflines=e;break;case "staffnonote=":e=parseInt(a.shift());isNaN(e)?p(1,"Bad %%staffnonote value"):k.staffnonote=e;break;case "staffscale=":e=parseFloat(a.shift());isNaN(e)||.3>e||2<e?p(1,"Bad %%staffscale value"):k.staffscale=e;break;default:switch(b.slice(0,4)){case "treb":case "bass":case "alto":case "teno":case "perc":c=b;break;default:0<="GFC".indexOf(b[0])?c=b:"="==
b.slice(-1)&&a.shift()}}}if(d)for(b in k.pos=A(k.pos),d)d.hasOwnProperty(b)&&(k.pos[b]=d[b]);c&&(c=Yf(c))&&(f&&(c.clefpit=f),xg(c))};Abc.prototype.set_v_param=function(a,c){k?Z.set_vp([a+"=",c]):(a=[a+"=",c],O.V||(O.V={}),O.V["*"]?Array.prototype.push.apply(O.V["*"],a):O.V["*"]=a)};Abc.prototype.set_width=Pf;Abc.prototype.sort_pitch=pf;Abc.prototype.strwh=Pa;Abc.prototype.stv_g=function(){return C};Abc.prototype.svg_flush=wd;Abc.prototype.syntax=p;Abc.prototype.unlksym=lb;Abc.prototype.use_font=sb;
Abc.prototype.xy_str=la;Abc.prototype.xygl=ca;var Cg}},Abc=abc2svg.Abc;"object"==typeof module&&"object"==typeof exports&&(exports.abc2svg=abc2svg,exports.Abc=Abc);abc2svg.loadjs=function(w,A,fa){fa&&fa()};
abc2svg.modules={ambitus:{fn:"ambitus-1.js"},beginps:{fn:"psvg-1.js"},"break":{fn:"break-1.js"},capo:{fn:"capo-1.js"},clip:{fn:"clip-1.js"},voicecombine:{fn:"combine-1.js"},diagram:{fn:"diag-1.js"},equalbars:{fn:"equalbars-1.js"},grid:{fn:"grid-1.js"},grid2:{fn:"grid2-1.js"},MIDI:{fn:"MIDI-1.js"},pageheight:{fn:"page-1.js"},percmap:{fn:"perc-1.js"},soloffs:{fn:"soloffs-1.js"},sth:{fn:"sth-1.js"},temperament:{fn:"temper-1.js"},nreq:0,hooks:[],g_hooks:[],load:function(w,A,fa){function J(){return"object"==
typeof user&&user.errmsg?user.errmsg:"function"==typeof printErr?printErr:"function"==typeof alert?function(p){alert(p)}:"object"==typeof console?console.log:function(){}}var qa,p=this.nreq;w=w.match(/(^|\n)(%%|I:).+?\b/g);if(!w)return!0;this.cbf=A||function(){};this.errmsg=fa||J();for(A=0;A<w.length;A++)(qa=abc2svg.modules[w[A].replace(/\n?(%%|I:)/,"")])&&!qa.loaded&&(qa.loaded=!0,this.nreq++,abc2svg.loadjs(qa.fn,function(){0==--abc2svg.modules.nreq&&abc2svg.modules.cbf()},function(){abc2svg.modules.errmsg("error loading "+
qa.fn);0==--abc2svg.modules.nreq&&abc2svg.modules.cbf()}));return this.nreq==p}};abc2svg.version="1.19.4";abc2svg.vdate="2019-05-20";
abc2svg.MIDI={do_midi:function(w){function A(p){var w=Number(p);if(!isNaN(w))return p=7*(w/12|0)-19,w%=12,p+=J[w],note={pit:p},qa[w]&&(note.acc=qa[w]),note}function fa(p){if(p.match(/^([_^=]*)([A-Ga-g])([,']*)$/))return p.match(/[A-Z]/)&&(p=p.toLowerCase(),p=0<p.indexOf("'")?p.replace("'",""):p+","),p}var J=new Int8Array([0,0,1,2,2,3,3,4,5,5,6,6]),qa=new Int8Array([0,1,0,-1,0,0,1,0,-1,0,-1,0]),p,ta;ta=this.get_maps();var T=w.split(/\s+/);switch(T[1]){case "channel":if("10"!=T[2])break;this.set_v_param("midictl",
"0 1");break;case "drummap":if("play"!=this.cfmt().sound)break;w=fa(T[2]);p=A(T[3]);if(!w||!p){this.syntax(1,this.errs.bad_val,"%%MIDI drummap");break}ta.MIDIdrum||(ta.MIDIdrum={});ta.MIDIdrum[w]=[null,p];this.set_v_param("mididrum","MIDIdrum");break;case "program":p=void 0!=T[3]?T[3]:T[2];p=parseInt(p);if(isNaN(p)||0>p||127<p){this.syntax(1,"Bad program in %%MIDI");break}this.set_v_param("instr",p);break;case "control":w=parseInt(T[2]),isNaN(w)||0>w||127<w?this.syntax(1,"Bad controller number in %%MIDI"):
(p=parseInt(T[3]),isNaN(p)||0>p||127<p?this.syntax(1,"Bad controller value in %%MIDI"):2<=this.parse.state?"play"==this.cfmt().sound&&(ta=this.new_block("midictl"),ta.ctrl=w,ta.val=p):this.set_v_param("midictl",T[2]+" "+T[3]))}},set_midi:function(w){var A,fa,J=this.get_curvoice();for(A=0;A<w.length;A++)switch(w[A]){case "instr=":J.instr=w[A+1];break;case "midictl=":J.midictl||(J.midictl=[]);fa=w[A+1].split(" ");J.midictl[fa[0]]=Number(fa[1]);break;case "mididrum=":J.map||(J.map={}),J.map=w[A+1]}},
do_pscom:function(w,A){"MIDI "==A.slice(0,5)?abc2svg.MIDI.do_midi.call(this,A):w(A)},set_vp:function(w,A){abc2svg.MIDI.set_midi.call(this,A);w(A)},set_hooks:function(w){w.do_pscom=abc2svg.MIDI.do_pscom.bind(w,w.do_pscom);w.set_vp=abc2svg.MIDI.set_vp.bind(w,w.set_vp)}};abc2svg.modules.hooks.push(abc2svg.MIDI.set_hooks);abc2svg.modules.MIDI.loaded=!0;
abc2svg.perc={do_perc:function(w){function A(p){var w,A,Q=Number(p);if(isNaN(Q)){if(A=p.match(/^([_^=]*)([A-Ga-g])([,']*)$/)){w="CDEFGABcdefgab".indexOf(A[2])+16;switch(A[3]){case "'":w+=7*A[3].length;break;case ",":w-=7*A[3].length}note={pit:w};switch(A[1]){case "^":note.acc=1;break;case "_":note.acc=-1}return note}p=p.toLowerCase(p);A=p[0];for(w=0;;){w=p.indexOf("-",w);if(0>w)break;w+=1;A+="-"+p[w]}Q=qa[A];if(!Q)switch(p[0]){case "c":switch(p[1]){case "a":Q=qa.ca;break;case "l":Q=qa.cl;break;case "o":Q=
qa.co}break;case "h":case "l":if(w=p.indexOf("-"),"t"==p[w+1])switch(p[1]){case "i":case "o":Q=qa[A+p[1]]}}}if(Q)return p=7*(Q/12|0)-19,Q%=12,p+=fa[Q],note={pit:p},J[Q]&&(note.acc=J[Q]),note}var fa=new Int8Array([0,0,1,2,2,3,3,4,5,5,6,6]),J=new Int8Array([0,1,0,-1,0,0,1,0,-1,0,-1,0]),qa={"a-b-d":35,"a-s":38,"b-d-1":36,ca:69,cl:75,co:56,"c-c":52,"c-c-1":49,"c-c-2":57,"c-h-h":42,"e-s":40,"h-a":67,"h-b":60,"h-c":39,"h-f-t":43,"h-m-t":48,"h-ti":65,"h-to":50,"h-w-b":76,"l-a":68,"l-b":61,"l-c":64,"l-f-t":41,
"l-g":74,"l-m-t":47,"l-ti":66,"l-to":45,"l-w":72,"l-w-b":77,m:70,"m-c":78,"m-h-c":62,"m-t":80,"o-c":79,"o-h-c":63,"o-h-h":46,"o-t":81,"p-h-h":44,"r-b":53,"r-c-1":51,"r-c-2":59,"s-c":55,"s-g":73,"s-s":37,"s-w":71,t:54,v:58},p,ta=this.get_maps(),T=w.split(/\s+/);if(w=function(p){if(p.match(/^([_^]*)([A-Ga-g])([,']*)$/))return p.match(/[A-Z]/)&&(p=p.toLowerCase(),p=0<p.indexOf("'")?p.replace("'",""):p+","),p}(T[1])){if("play"!=this.cfmt().sound){if(!T[3])return;ta.MIDIdrum||(ta.MIDIdrum={});p=A(w);if(!p){this.syntax(1,
this.errs.bad_val,"%%percmap");return}delete p.acc;ta.MIDIdrum[w]=[[T[3]],p]}else{p=A(T[2]);if(!p){this.syntax(1,this.errs.bad_val,"%%percmap");return}ta.MIDIdrum||(ta.MIDIdrum={});ta.MIDIdrum[w]=[null,p]}this.set_v_param("perc","MIDIdrum")}else this.syntax(1,this.errs.bad_val,"%%percmap")},set_perc:function(w){var A,fa=this.get_curvoice();for(A=0;A<w.length;A++)switch(w[A]){case "perc=":fa.map||(fa.map={}),fa.map=w[A+1],fa.midictl||(fa.midictl={}),fa.midictl[0]=1}},do_pscom:function(w,A){"percmap "==
A.slice(0,8)?abc2svg.perc.do_perc.call(this,A):w(A)},set_vp:function(w,A){abc2svg.perc.set_perc.call(this,A);w(A)},set_hooks:function(w){w.do_pscom=abc2svg.perc.do_pscom.bind(w,w.do_pscom);w.set_vp=abc2svg.perc.set_vp.bind(w,w.set_vp)}};abc2svg.modules.hooks.push(abc2svg.perc.set_hooks);abc2svg.modules.percmap.loaded=!0;
